(function(){'use strict';let WPAI_Chat=function(){};let Aicb=new WPAI_Chat();WPAI_Chat.prototype.common=(function(){"use strict";function mrSearch(searchWords,text){let match=!1;let m0=!0;let m1=!0;let m2=!0;let m3=!0;if(text&&searchWords){let filteredText=text.match(/[^_\W]+/g);if(filteredText!==null){let lowerCaseText=filteredText.map(function(word){return word.toLowerCase()});Object.keys(searchWords).forEach(function(i){match=!1;if(searchWords[i]instanceof Array){Object.keys(searchWords[i]).forEach(function(j){if(!match&&lowerCaseText.indexOf(searchWords[i][j].toLowerCase())!==-1){match=!0}})}else{if(lowerCaseText.indexOf(searchWords[i].toLowerCase())!==-1){match=!0}}
if(i==0){m0=match}else if(i==1){m1=match}else if(i==2){m2=match}else if(i==3){m3=match}});return!!(m0&&m1&&m2&&m3)}
return!1}
return!1}
function sanitize(string,slash=!1){let str=(string.split(" ").filter(n=>n).join(" "));let map={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"/",};if(slash){map["/"]="&#x2F;"}
const reg=/[&<>"'/]/ig;return str.replace(reg,(match)=>(map[match]))}
function whiteSpaces(str){return sanitize(str)}
function split(val){let key_word;let query_string;let split=val.split(new RegExp(": | -- | -","g"));if(split.length>=2){key_word=split[0];query_string=val.replace(key_word,"").trim()}else{key_word=val.replace(/ .*/,"").trim()||"";query_string=val.replace(key_word,"").trim()}
return[key_word,query_string]}
function getUrlPath(link="",type="path"){let url=(new URL((link!=="")?link:document.location.href));if(type==="domain"){return url.origin}
if(type==="path"){return url.pathname}}
function timeAgo(ti,cursor=""){const d=new Date(ti);const t=new Date();const diffMs=(t-d);const diffDays=Math.floor(diffMs/86400000);const diffHrs=Math.floor((diffMs%86400000)/3600000);const minutes=Math.round(((diffMs%86400000)%3600000)/60000);if(cursor==="min"){return minutes}
if(diffDays>0){return(diffDays>1?diffDays+" days ago":diffDays+" day ago")}else if(diffHrs>0){return(diffHrs>1?diffHrs+" hours ago ":diffHrs+" hour ago")}else if(minutes>0){return(minutes>1?minutes+" mins ago ":minutes+" min ago")}else{return d.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0})}}
function timeDiffSeconds(start,end=Date.now()){start=parseInt(start);end=parseInt(end);if(start&&end){let diff=((end>start)?(end-start):(start-end));return(diff/1000)}
return 0}
function generateGUID(){return"xxxsxxxxxhxxxxayxpxxxxxxoxxxyyxxnxxx".replace(/[xy]/g,function(c){const r=(Math.random()*16|0);let v=((c=="x")?r:(r&0x3|0x8));return v.toString(16)})}
function getBrowser(){const test=function(regexp){return regexp.test(window.navigator.userAgent)};switch(!0){case test(/edge/i):return"Microsoft Edge";case test(/opr/i)&&(!!window.opr||!!window.opera):return"Opera";case test(/chrome/i)&&!!window.chrome:return"Google Chrome";case test(/trident/i):return"Internet Explorer";case test(/firefox/i):return"Mozilla Firefox";case test(/safari/i):return"Safari";default:return"unknown"}}
function setCookie(name,value,config={expires:1,path:"/",domain:window.location.hostname,secure:!0}){return Cookies.set(name,value,{expires:config.exp,path:config.path,domain:config.domain,secure:config.secure})}
function getCookie(name,config={expires:1,path:"/",domain:window.location.hostname,secure:!0}){return Cookies.get(name,{expires:config.exp,path:config.path,domain:config.domain,secure:config.secure})}
function getCookieObj(name){return jsonParse(getCookie(name))}
function getDateTime(time){let t=new Date(time),monthsList=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];let h=function(h){if(t.getHours()>12)return(h?t.getHours()-12:" PM");else return(h?t.getHours():" AM")};return t.getDate()+" "+monthsList[(t.getMonth()+1)]+" AT "+h(!0)+":"+t.getMinutes()+h(!1)}
function isValidURL(str){var pattern=new RegExp('^(https?:\\/\\/)?'+'((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|'+'((\\d{1,3}\\.){3}\\d{1,3}))'+'(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+'(\\?[;&a-z\\d%_.~+=-]*)?'+'(\\#[-a-z\\d_]*)?$','i');return!!pattern.test(str)}
function jsonParse(str){try{if(typeof str!=="undefined"){return JSON.parse(str)}}catch(e){return!1}
return!1}
function getObject(target){const group=document.querySelectorAll(target);let result={};for(let i=0;i<group.length;i++){const type=group[i].dataset.action;const key=group[i].dataset.key;if(type==="text"){result[key]=group[i].value}
if(type==="checkbox"){result[key]=group[i].checked==!0?1:0}
if(type==="select"){result[key]=group[i].options[group[i].selectedIndex].value}
if(type==="radio"){const radio=group[i].querySelector("input[name="+key+"]:checked");result[key]=radio?radio.value:"1"}}
return result}
function loaderText(){return `<div class="single-item mr-spinner-full"><div class="mr-spinner"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div></div>`}
function mrLoader(type=!1){const loader=document.querySelectorAll(".mr-spinner");if(loader){loader.forEach((ele)=>ele.remove())}
const spinner=document.createElement("DIV");spinner.setAttribute("class","mr-spinner");spinner.innerHTML=`<div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div>`;let target=document.getElementById("cbMessages");if(!!type&&target){target.appendChild(spinner);target.scrollIntoView({behavior:"smooth",block:"end"})}}
function typeLoader(type=!1){const loader=document.querySelectorAll(".tp-wrapper");if(loader){loader.forEach(ele=>ele.remove())}
let def=mrAssistantObj.plugin_url+"assets/images/mr-assistant.svg";let avatar=((mrAssistantObj.hasOwnProperty("avatar")&&isValidURL(mrAssistantObj.avatar))?mrAssistantObj.avatar:def);const spinner=document.createElement("DIV");spinner.setAttribute("class","tp-wrapper fade");let imgId=Math.floor((Math.random()*92992343)+1);spinner.innerHTML=`<img id="mrImg-${imgId}" src="${avatar}" class="avatar"/><div class="tp-container"><div class="tp-balls"><span></span><span></span><span></span></div></div>`;const target=document.getElementById("cbMessages");if(!!type&&target){playSound("au-typing");target.appendChild(spinner);image(imgId,avatar,def,"imgSrc",25)}
if(target){target.scrollIntoView({behavior:"smooth",block:"end"})}}
function playSound(name){try{let sound=localStorage.getItem("mrAssistantSounds");if(sound&&sound==="mute"){return}
let audio=document.getElementById(name);if(audio){let promise=audio.play();if(promise!==undefined){promise.catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}}}catch(e){}}
function localDB(key,type,data={},cursor=!1){let arr=[];try{let obj=JSON.parse(localStorage.getItem(key));if(obj&&obj.length>0){obj.forEach((ele)=>arr.push(ele))}}catch(e){if(mrAssistantObj.dev==="on"){console.info(e)}}
if(type==="get"){return arr}else if(type==="set"){if(cursor){arr=[]}
arr.push(data);return localStorage.setItem(key,JSON.stringify(arr))}}
function getRandomInt(min,max){min=Math.ceil(min);max=Math.floor(max);return Math.floor(Math.random()*(max-min))+min}
async function image(key,path,fallback,type="bg",width=""){await new Promise(resolve=>{const img=new Image();img.src=path;img.onload=()=>resolve(path);img.onerror=()=>resolve(fallback)}).then(function(img){if(img===path){return}
let imgId=document.getElementById("mrImg-"+key);if(imgId){if(type==="img"){imgId.innerHTML='<img width="'+width+'" src="'+img+'"/>'}else if(type==="imgSrc"){imgId.src=img}else{imgId.style.backgroundImage='url('+img+')'}}})}
function isset(accessor){try{return typeof accessor!=='undefined'}catch(e){return!1}}
return{timeAgo:timeAgo,timeDiffSeconds:timeDiffSeconds,mrSearch:mrSearch,generateGUID:generateGUID,getBrowser:getBrowser,whiteSpaces:whiteSpaces,sanitize:sanitize,getUrlPath:getUrlPath,playSound:playSound,split:split,getObject:getObject,setCookie:setCookie,getCookie:getCookie,getCookieObj:getCookieObj,getDateTime:getDateTime,loaderText:loaderText,mrLoader:mrLoader,typeLoader:typeLoader,localDB:localDB,getRandomInt:getRandomInt,jsonParse:jsonParse,isValidURL:isValidURL,image:image,isset:isset}})();WPAI_Chat.prototype.conn=(function(){"use strict";let settings;let appearance;let userConfig;let lastMessage="";let botConfig={};let currentStatus="";let chatUsers={};let timeout2=null;function _checkAuthState(user){if(user){firebase.database().ref("clients").child(user.uid).child("settings").on("value",function(snap){try{let config=snap.val();if(config){userConfig=Object.assign({},config)}
if(config&&config.hasOwnProperty("block")){localStorage.setItem("mrAssistantBlock",config.block)}
if(config&&config.hasOwnProperty("mrSupport")){localStorage.setItem("mrAssistantSupport",config.mrSupport)}}catch(e){if(mrAssistantObj.dev==="on"){console.info(e)}}});firebase.database().ref("clients").child(user.uid).child("actions").on("child_added",function(snap){Aicb.common.typeLoader(!1);let key=snap.key;let val=snap.val();if(val){let type=val.actionType;let action=val.actionName;let status=val.status;let time=val.time;if(status!=="pending"){return}
if(Aicb.common.timeDiffSeconds(time)<=10){firebase.database().ref("clients").child(user.uid).child("actions").child(key).update({"status":"Executed"}).then(function(){let chatFrame=localStorage.getItem("mrAssistantDom");if(chatFrame!=="expend"){Aicb.init.chat_start()}}).then(function(){Aicb.common.setCookie("mrRobotAutoAction",0,5);Aicb.common.setCookie("mrRobotSession",Aicb.common.generateGUID(),5);if(type==="survey"&&action==="signUp"){Aicb.form.surveyForm(action)}else if("search"===type&&""!==val.subAction){if("redirect"===val.subAction){try{let url=new URL(action);Aicb.init.popMessage({"title":Aicb.translate.get("Suggestion","_txcwpm21"),"content":Aicb.translate.get("Admin has suggested for this page. Click on view now button to open this.","_txcwpm22"),"type":"redirect","button":Aicb.translate.get("View Now","_txcwpm23"),"action":action});notification(Aicb.translate.get("Admin has suggested for this page.","_txcwpm12"))}catch(e){firebase.database().ref("clients").child(user.uid).child("actions").child(key).update({"status":"Dropped"})}}else if(val.subAction==="search"){Aicb.controller.bot(action,{"cuAction":1,"kbAction":1,"sbAction":1})}else if(val.subAction==="kb"){Aicb.controller.bot(action,{"cuAction":0,"kbAction":1})}}else if(type==="help"&&action==="HelpMenu"){Aicb.init.mrHelpMenuExecute(null)}else if(type==="feedback"&&action==="Feedback"){Aicb.form.feedbackForm(action)}else if(type==="menuAction"&&action==="menuAction"){const mr_menus=document.querySelector(".mr_menus");if(mr_menus){mr_menus.click()}}else if(action==="botStatus"){let cb_bot=document.querySelector(".cb_bot");if(cb_bot){cb_bot.click()}}else if(action==="endChat"){signOut()}else{firebase.database().ref("clients").child(user.uid).child("actions").child(key).update({"status":"Dropped"})}
Aicb.common.typeLoader(!1)})}else{firebase.database().ref("clients").child(user.uid).child("actions").child(key).update({"status":"Dropped"})}}})}}
function menuActionController(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let action=e.target.parentNode;const btns=document.querySelectorAll(".mr_action_btn");if(action.classList.contains("mr_action_btn")){let key=action.dataset.action;if(key==="signin"){chooseForm()}else if(key==="signout"){signOut()}else if(key==="rateChat"){Aicb.form.feedbackForm("feedback")}else if(key==="pausedBot"){const cb_bot=document.querySelector(".cb_bot");if(cb_bot){const menuBotStatus=document.getElementById("menuBotStatus");cb_bot.click()}}else if(key==="muteSounds"){localStorage.setItem("mrAssistantSounds","mute");if(btns){btns.forEach(function(ele){let ac=ele.dataset.action;if(ac&&ac==="playSounds"){ele.style.display="flex"}
if(ac&&ac==="muteSounds"){ele.style.display="none"}})}}else if(key==="playSounds"){localStorage.setItem("mrAssistantSounds","play");if(btns){btns.forEach(function(ele){let ac=ele.dataset.action;if(ac&&ac==="playSounds"){ele.style.display="none"}
if(ac&&ac==="muteSounds"){ele.style.display="flex"}})}}}}
function signOut(){const user=firebase.auth().currentUser;if(user){user.delete().then(function(){window.frames.location.reload()}).catch(function(error){if(mrAssistantObj.dev==="on"){console.info(error)}
notification(Aicb.translate.get(error.message,"_txcwsi201"))})}else{notification(Aicb.translate.get("Please introduce yourself","_txcwsi1"))}}
function sessionInfo(user,mes){if(!user){return}
const rootRef=firebase.database().ref();const clients=rootRef.child("clients").child(user.uid);clients.child("/info/lastMessage").set(mes);clients.child("/info/lastSeen").set(Date.now());clients.child("/info/unread").transaction(function(currentClicks){return(currentClicks||0)+1})}
function chooseForm(){return Aicb.form.surveyForm("signUp")}
function addUserToScript(userObj){const sc=document.getElementById("mr_user_config");let obj=[];if(sc&&userObj){Object.keys(userObj).forEach(function(uid){let user=userObj[uid];obj[uid]={"name":user.name||"Anonymous","avatar":user.avatar||""}});window.mrUsers=Object.assign({},obj);sc.innerHTML="let mrUsers ="+JSON.stringify(Object.assign({},obj))}}
function _conversationInit(){firebase.auth().onAuthStateChanged(function(user){if(!user){return}
let mr=firebase.database().ref("clients").child(user.uid);mr.child("info").on("value",function(snap){let val=snap.val();if(val.name){chatUsers=Object.assign(chatUsers,{"clientName":val.name})}
if(!val||!val.marge){const user2=firebase.auth().currentUser;let info={"isNewUser":!0,"marge":!0,"domain":window.location.hostname,"lastSeen":Date.now(),"join":Date.now()};mr.child("info").update(info);mr.child("settings").update({"archive":"unarchived","block":"unblock","mrSupport":"on","kbSupport":"on","scSupport":"on","sbSupport":"on","status":"active","uEndChat":"start"});let avatar="";mr.child("conversation").child("mr-assistant").update({"name":(mrAssistantObj.name?mrAssistantObj.name:"MR. Assistant"),"avatar":((mrAssistantObj.avatar!=="")?mrAssistantObj.avatar:avatar),"join":Date.now(),"type":"bot","status":((!!mrAssistantObj.status)?"active":"pulse")}).then(function(){firebase.database().ref("actions").child("visitorSignUp").child(user2.uid).remove()})}});let conversation=mr.child("conversation");conversation.on("value",function(snap){let val=snap.val();if(val){try{addUserToScript(val);Aicb.common.setCookie("mrUserAssets",JSON.stringify(val));let template=Aicb.template.setAvatar(snap.key,val);let imgBox=document.querySelector(".mr-left-header");if(imgBox){imgBox.innerHTML=template}
if(val.hasOwnProperty("mr-assistant")){const line=document.querySelector(".bot-line");const cb_bot=document.querySelector(".cb_bot");if(line&&cb_bot){let mrInstant=val["mr-assistant"];if(mrInstant.status==="active"){line.style.display="none";cb_bot.dataset.action="running";cb_bot.classList.remove("bot-pulse");notification(Aicb.translate.get("Support bot is activated. Now you can search & chat..","_txcwbs1"))}else{line.style.display="inline";cb_bot.dataset.action="pulse";cb_bot.classList.add("bot-pulse");notification(Aicb.translate.get("Support bot is deactivated. Sending to Live Agent.","_txcwbs2"))}}}}catch(e){if(mrAssistantObj.dev==="on"){console.info(e)}}}});if(user.email){firebase.database().ref("users").once("value",function(snap){let admins=snap.val();if(admins){Object.keys(admins).forEach(function(key){if(admins.hasOwnProperty(key)){let admin=admins[key];if(user.email===admin.email){let name=(admin.name!==""?(admin.name+" (Admin)"):"You (Admin)");mr.child("info").update({"join":Date.now(),"isAdminUser":!0,"marge":!0,"name":name,"email":admin.email});firebase.database().ref('livechat/').child(user.uid).set("");firebase.database().ref('browses/').child(user.uid).set("");firebase.database().ref('clients').child(user.uid).child('actions').set("");notification(`${Aicb.translate.get("Hello ", "_txcwkw_hello")} ${name},  ${Aicb.translate.get("You are chatting itself.", "_txcwis1")}`)}}})}})}
firebase.database().ref("mr-assistant").child("name").on("value",function(snap){if(snap.val()){chatUsers=Object.assign(chatUsers,{"mrAssistant":snap.val()})}})})}
function notification(message){setStatus(message,!0,!0)}
function loadMoreMessages(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();if(firebase.auth().currentUser!==null){const mId=firebase.auth().currentUser.uid;firebase.database().ref("livechat").child(mId).once("value",function(snap){let data=snap.val();if(!data){return}
let sort=Object.entries(data);let length=sort.length||0;let step=parseInt(e.target.dataset.step);let inset=parseInt(e.target.dataset.inset);let counter=parseInt(e.target.dataset.counter);let limit=inset+step;let end=(length-inset);let start=((end-step)>0?(end-step):0);let list=sort.slice(start,end);let i;for(i=list.length;i>=0;i--){if(list[i]){let key=list[i][0];if(data.hasOwnProperty(key)){Aicb.template.templateDark(key,data[key],settings,"prepend")}}}
e.target.dataset.inset=limit;e.target.style.display=((length>limit)?"block":"none")})}}
function loadMessages(user){const cbMessages=document.querySelector(".cbMessages");if(cbMessages){cbMessages.innerHTML=""}
if(user){Aicb.common.mrLoader(!0);const loadMegFunction=function(snap){let data2=snap.val();if(Date.now()-data2.time<2000){Aicb.common.playSound("au-message")}
Aicb.template.templateDark(snap.key,data2,settings);botControllerInit(data2.text)};firebase.database().ref("livechat").child(user.uid).limitToLast(20).on("child_added",loadMegFunction);firebase.database().ref("livechat/").child(user.uid).once("value",function(snap){let count=snap.numChildren();let loadMore=document.querySelector(".loadMore");if(count>20){loadMore.dataset.inset=20;loadMore.dataset.step=10;loadMore.dataset.counter=count;loadMore.style.display="block";loadMore.addEventListener("click",loadMoreMessages,!0)}});Aicb.common.mrLoader(!1)}else{try{let offlineData=Aicb.common.localDB("mrAssistantOfflineChat","get");if(offlineData&&offlineData.length>0){offlineData.forEach(function(ele){return Aicb.template.templateDark("offline-"+Math.floor(Math.random()*Math.floor(Date.now())),ele,settings)})}}catch(e){if(mrAssistantObj.dev==="on"){console.info(e)}}}}
function setMessages(str,user,type2){let obj={type:type2,name:(user?user.displayName:"Anonymous"),text:str,time:Date.now()};if(user){if(chatUsers){if(type2==="client"){obj.name=chatUsers.clientName||"Anonymous"}else if(type2==="bot"){obj.name=chatUsers.mrAssistant||"Mr. Assistant"}}
firebase.database().ref("livechat").child(user.uid).push(obj).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}});firebase.database().ref("clients").child(user.uid).child("info").update({"lastMessage":str.substring(0,20),"lastSeen":Date.now()})}else{Aicb.common.localDB("mrAssistantOfflineChat","set",obj);return Aicb.template.templateDark("offline-"+Date.now(),obj,"message-visitor")}}
function chatting(user,type){const messageFormBtn=document.getElementById("mr_sender");const messageInputBox=document.getElementById("message");let timeout=null;let mpTimeout=null;if(messageFormBtn&&messageInputBox){messageInputBox.addEventListener("keyup",function(e){if(e.keyCode===13){messageFormBtn.click()}})}
if(messageFormBtn){messageFormBtn.addEventListener("click",function(e){if((settings.configuration&&settings.configuration.chatWay!=="chatOffline")&&(userConfig&&userConfig.block==="block")){return setStatus("Oops!! Something happen wrong. Contact to Admin.",!0,!0)}
e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let str=Aicb.common.whiteSpaces(messageInputBox.value);if(timeout){clearTimeout(timeout)}
timeout=setTimeout(function(){if(str!==""){messageInputBox.value="";(async()=>{try{let mrAssistantBlock=localStorage.getItem("mrAssistantBlock");if(mrAssistantBlock&&mrAssistantBlock==="block"){return""}
Aicb.common.playSound("au-message");if(mrAssistantObj.hasOwnProperty("cmd")&&mrAssistantObj.cmd==="on"&&str.toLowerCase().replace(/ .*/,'')==="-mr"){lastMessage=str;return Aicb.controller.mrCommandLine(str)}
if(user){sessionInfo(user,str);lastMessage=str;return setMessages(str,user,"client")}else{if("chatOffline"===settings.configuration.chatWay){lastMessage=str;setMessages(str,user,"client");return await botControllerInit(str)}else if("chatAnonymously"===settings.configuration.chatWay){Aicb.form.signUp({"signUp":"Anonymously"},"",!0)}else{chooseForm()}}}catch(e){setStatus("Oops!! Wrong Configuration!!",!0,!0);if(mrAssistantObj.dev==="on"){console.info(e)}}})()}},100)})}}
const botControllerInit=async function(str){if(lastMessage!==str){return}
if(timeout2)clearTimeout(timeout2);timeout2=setTimeout(async function(){if(mrAssistantObj.mrAssistantBot!=="off"&&!!settings.assistantSupport){if(userConfig.sbSupport==="on"&&userConfig.status==="active"){Aicb.common.typeLoader(!0);botConfig.cuAction=!!(userConfig.scSupport==="on"&&!!settings.actionBot);botConfig.kbAction=!!(userConfig.kbSupport==="on"&&!!settings.kbBot);botConfig.sbAction=!!(userConfig.sbSupport==="on"&&!!settings.siteBot);botConfig.wooBot=settings.wooBot;botConfig.wooCart=settings.wooCart;botConfig.wooCurrency=settings.woo_currency;let botConfig2=Object.assign({},botConfig,settings);Aicb.common.setCookie("mrRobotAutoAction",0,5);Aicb.common.setCookie("mrRobotSession",Aicb.common.generateGUID(),5);let mrAssistantSupport=localStorage.getItem("mrAssistantSupport");if(mrAssistantSupport&&"off"===mrAssistantSupport){return Aicb.common.typeLoader(!1)}
return await Aicb.controller.bot(str,botConfig2)}}else if(settings.configuration&&settings.configuration.mrAssistant){Aicb.common.typeLoader(!0);botConfig.cuAction=!!settings.configuration.actionBot;botConfig.kbAction=!!settings.configuration.kbBot;botConfig.sbAction=!!settings.configuration.siteBot;botConfig.wooBot=settings.configuration.wooBot;botConfig.wooCart=settings.configuration.wooCart;botConfig.wooCurrency=settings.configuration.woo_currency;let botConfig2=Object.assign({},botConfig,settings.configuration);Aicb.common.setCookie("mrRobotAutoAction",0,5);Aicb.common.setCookie("mrRobotSession",Aicb.common.generateGUID(),5);return await Aicb.controller.bot(str,botConfig2)}else{Aicb.common.typeLoader(!1)}},100)};function setStatus(text,type,cursor=!1){let mr_status_box=document.querySelector(".mr_status_box");if(!mr_status_box)return;let span=document.createElement("DIV");span.setAttribute("class","mr_status theme");span.innerHTML=text;mr_status_box.style.display=!type?"none":"flex";mr_status_box.innerHTML="";mr_status_box.append(span);if(cursor){setTimeout(function(e){span.innerHTML=currentStatus;mr_status_box.innerHTML="";mr_status_box.append(span)},5000)}}
function clear(){_checkAuthState(null);_conversationInit(null);loadMessages(null);chatting(null,"go");return""}
function __settingsInit(){currentStatus=mrAssistantObj.offline_text||" ";setStatus(currentStatus,!0,!1);firebase.database().ref("actions").child("online").on("value",function(snap){let val=snap.val();if(val.hasOwnProperty("lastSeen")&&val.hasOwnProperty("status")){let seconds=Aicb.common.timeDiffSeconds(val.lastSeen);if(val.status==="online"&&seconds<600){if(mrAssistantObj.hasOwnProperty("online_text")){currentStatus=mrAssistantObj.online_text}}else{if(mrAssistantObj.hasOwnProperty("offline_text")){currentStatus=mrAssistantObj.offline_text}}
setStatus(currentStatus,!0,!1)}});firebase.auth().onAuthStateChanged(function(user){const mr_dropdown=document.querySelector(".mr-dropdown");if(mr_dropdown){mr_dropdown.innerHTML="";let createBtn=function(text,type,imgSrc,id="",display="flex"){let p=document.createElement("P");p.setAttribute("class","mr_action_btn");p.setAttribute("style","display: "+display);p.setAttribute("data-action",type);p.addEventListener("click",menuActionController,!0);let img=(imgSrc!=="")?imgSrc:"bpmn:start-event-parallel-multiple";p.innerHTML=`<span class="iconify mr-svg" data-icon="${img}" data-inline="true"></span><span id="${id}">${text}</span>`;if(mr_dropdown)mr_dropdown.appendChild(p)};createBtn("Chat Bot","pausedBot","ant-design:robot-filled","menuBotStatus");let sound=localStorage.getItem("mrAssistantSounds"),soundBtn1=(!!sound&&sound==="mute")?"flex":"none",soundBtn2=(!!sound&&sound==="mute")?"none":"flex";createBtn("Enable Sounds","playSounds","si-glyph:sound-mute","playSounds",soundBtn1);createBtn("Mute Sounds","muteSounds","subway:sound","muteSounds",soundBtn2);if(user){createBtn("Rate for this chat","rateChat","vaadin:star-half-left-o");createBtn("End Chat","signout","mdi-light:logout")}else{createBtn("Start Chat","signin","ant-design:login-outlined")}}})}
function signInAnonymously(unique=!0){let key=Aicb.common.getRandomInt(1000,9999);let ann="Anonymous "+unique?key:"";let info={"name":ann,"email":"","isNewUser":!1,"marge":!1,"lastSeen":Date.now(),"method":"signInAnonymously","type":"liveChat","chatWay":"signInAnonymously","join":Date.now(),"status":"active","currentPage":window.location.href,"browser":Aicb.common.getBrowser(),"language":navigator.languages.join(","),"platform":navigator.platform,};let chatItSelf=localStorage.getItem("mrAssistantChatItself");if(!chatItSelf){firebase.auth().signInAnonymously().then(snap=>{var user=snap.user;if(user){info.uid=user.uid;info.method="signInAnonymously";firebase.database().ref("clients").child(user.uid).child("info").update(info);setStatus(Aicb.translate.get("Welcome!! Now You can search or chat..","_txcwsc1"),!0,!0)}}).catch(function(e){setStatus(Aicb.translate.get("Oops!! Something went wrong. Try again!!","_txcwsc2"),!0,!0);if(mrAssistantObj.dev==="on"){console.info(e)}})}}
function execute(){firebase.auth().onAuthStateChanged(function(user){lastMessage="";if(user){firebase.database().ref("settings").once("value",function(snap){let val=snap.val();if(val){settings=Object.assign({},val.configuration)}}).then(function(){chatting(user,"go");_checkAuthState(user);_conversationInit(user);Aicb.translate.execute()}).then(function(){setTimeout(function(){loadMessages(user)},1000)})}else{firebase.database().ref("settings").once("value",function(snap){try{settings=Object.assign({},snap.val());let config=Object.assign({},settings.configuration?settings.configuration:{});if(config.chatWay){switch(config.chatWay){case "chatWithVisitor":Aicb.form.surveyForm("signUp");break;case "chatAnonymously":signInAnonymously(config.uniqueAnonymous);break;case "chatWithEmail":Aicb.form.surveyForm("signUp");break;case "chatOffline":chatting(user,"offline");break;default:Aicb.form.surveyForm("signUp");break}}
Aicb.translate.execute()}catch(e){setStatus(Aicb.translate.get("Oops!! Something went wrong. Try again!!","_txcwsc2"),!0,!0);if(mrAssistantObj.dev==="on"){console.info(e)}}})}
__settingsInit()})}
return{execute:execute,clear:clear,_conversationInit:_conversationInit,notification:notification,setMessages:setMessages,chatUsers:chatUsers}})();WPAI_Chat.prototype.init=(function(){"use strict";let settings={};let tempMeg=0;function flyMessage(){const alc_chatbot=document.querySelector(".alc_chatbot");if(!alc_chatbot){return}
let ls=localStorage.getItem("mrAssistantFlyMeg");let dom=localStorage.getItem("mrAssistantDom");if(dom==="expend"){chat_start()}else if(!ls||ls!=="seen"){if(mrAssistantObj.hasOwnProperty("intro")){let val=mrAssistantObj.intro;let mr=((settings&&settings.hasOwnProperty("name"))?settings.name:"Mr. Assistant");let avatar=((settings&&settings.hasOwnProperty("avatar"))?settings.avatar:"");let defAvatar=((mrAssistantObj&&mrAssistantObj.hasOwnProperty("plugin_url"))?mrAssistantObj.plugin_url+"assets/images/mr-assistant.svg":"");let avatar2=((avatar!==""&&Aicb.common.isValidURL(avatar))?avatar:defAvatar);let box_width=mrAssistantObj.hasOwnProperty("intro_box_width")?mrAssistantObj.intro_box_width:360;if(val!==""){const node=document.createElement("DIV");node.setAttribute("class","introMessage");node.setAttribute("style","width: "+box_width+"px");node.innerHTML=Aicb.template.flyTemplate(val,mr,avatar2);alc_chatbot.appendChild(node);const iframe=window.frameElement;iframe.style.width="430px";if(iframe.style.height!=="100vh"){iframe.style.height="296px"}
const box=document.querySelector(".message-container");if(box){box.addEventListener("click",chat_start)}
let close_fly=document.querySelector(".close-introMessage");if(close_fly){close_fly.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const intro=document.querySelector(".introMessage");if(intro){intro.remove()}
iframe.style.width="112px";iframe.style.height="140px";localStorage.setItem("mrAssistantFlyMeg","seen")})}
let iStart=document.querySelector(".intro-start-btn");if(iStart){iStart.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();chat_start()})}
Aicb.translate.execute()}}}}
function menu_expend(){const ex=document.querySelector(".cb_expend");const cb_attach=document.querySelector(".cb_attach");const cb_specker=document.querySelector(".cb_specker");const cb_cart=document.querySelector(".cb_cart");const cart_count=document.querySelector(".mr-cart-count");const cb_info=document.querySelector(".cb_info");const message_form=document.querySelector("#message-form");const cb_message_info=document.querySelector(".cb_message_info");const cbMessages=document.querySelector("#cbMessages");const mr_microphone=document.querySelector(".mr_microphone");const mr_menus=document.querySelector(".mr_menus");let woo=parseInt(mrAssistantObj.woo);let speech=!1;if(!woo&&cb_cart){cb_cart.style.display="none"}
if(!speech&&mr_microphone){mr_microphone.style.display="none"}
if(ex){ex.addEventListener("click",function(e){e.preventDefault();if(!!woo&&cb_cart){cb_cart.style.display="block"}
if(cb_info){cb_info.style.display="block"}
if(!!speech&&mr_microphone){mr_microphone.style.display="block"}
if(mr_menus){mr_menus.style.display="block"}
if(ex){ex.style.display="none"}})}
if(message_form){message_form.addEventListener("click",function(e){if(cb_cart){cb_cart.style.display="none"}
if(cb_info){cb_info.style.display="none"}
if(ex){ex.style.display="block"}
if(cb_message_info){cb_message_info.style.display="none"}
if(mr_microphone){mr_microphone.style.display="none"}
if(mr_menus){mr_menus.style.display="none"}
if(cbMessages){cbMessages.style.display="block"}})}}
function mrBotMenuEvent(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let key=e.target.parentNode.dataset.key;const popup=document.querySelector(".alc_pop_box");const iframe=window.frameElement;if(key){firebase.database().ref().child("/menus/").child(key).once("value").then(function(snap){let val=snap.val();let introMessage=document.querySelector(".introMessage");if(introMessage){introMessage.remove()}
iframe.style.width="100%";iframe.style.height="100vh";popup.innerHTML=Aicb.common.loaderText();popup.innerHTML=Aicb.template.menuView("menu",val)}).then(function(){let close_btn=document.querySelector(".close_btn");if(close_btn){close_btn.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();popup.innerHTML="";iframe.style.width="430px";iframe.style.height="100vh"},!0)}})}}
function mrMenuExecute(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();Aicb.common.mrLoader(!0);let aisNode=document.createElement("DIV");const mr_count=document.querySelectorAll(".mr-cart-count");const mr_target=document.querySelector("#cbBotMessages");const defMenu=mrAssistantObj.plugin_url+"assets/images/menu.svg";let getMenuIcon=function(icon){if(Aicb.common.isValidURL(icon)){return `<img src="${icon}"/>`}else{let span=icon.match(/<span[^>]*>[^>]*<\/span>/g);if(span&&span[0]){return span[0]}
return `<img src="${defMenu}"/>`}}
firebase.database().ref().child("/menus/").once("value").then(function(snap){aisNode.setAttribute("class","viewCart");let body="";let val=snap.val();let header=`<div class="cart-header theme"><div class="cart-title">${Aicb.translate.get("My Menu", "_txcwMenu1")}</div>`+`<span class="close-cart-view">X</span></div>`;body+=header;if(val){let cartBody="";let count=1;let key;for(key in val){if(val.hasOwnProperty(key)){let menuIcon=val[key].menuUrl||defMenu;cartBody+=`<li class="mr-menu-item" data-key="${val[key].menuID}">${getMenuIcon(val[key].menuUrl)}<h4 class="menu-title">${val[key].menuName}</h4></li>`}}
body+=`<ul class="menu-list">`;body+=cartBody;body+=`</ul>`}else{body+=`<div>${Aicb.translate.get("No Menu", "_txcwMenu1")}</div>`}
aisNode.innerHTML=body}).then(function(){const viewBox=document.querySelectorAll(".viewCart");if(viewBox){viewBox.forEach(function(ele){ele.remove()})}
const box=document.querySelector("#cbMessages");box.append(aisNode);mr_target.querySelectorAll(".mr-loader").forEach(function(ele){ele.style.display="none"});let scroll=document.getElementById("cbMessages");if(scroll&&scroll.childNodes.length>2){scroll.scrollIntoView({behavior:"smooth",block:"end"})}
let close=document.querySelector(".viewCart .close-cart-view");if(close){close.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const viewBox2=document.querySelectorAll(".viewCart");if(viewBox2){viewBox2.forEach((ele)=>ele.remove())}},!0)}}).then(function(){let menus=document.querySelectorAll(".menu-list .mr-menu-item");if(menus){menus.forEach((ele)=>ele.addEventListener("click",mrBotMenuEvent,!0))}});Aicb.common.mrLoader(!1);Aicb.common.typeLoader(!1)}
function notificationExecution(e){let type=e.target.dataset.type;let action=e.target.dataset.action;if(type==="redirect"){let url=new URL(action);let win=window.open(action,"_blank");if(!win||win.closed||typeof win.closed=="undefined"){Aicb.conn.notification(Aicb.translate.get("Pop-up Blocked.","_txcwrn2"))}else{return win.focus()}}}
function popMessage(data={}){Aicb.common.mrLoader(!0);let aisNode=document.createElement("DIV");const mr_count=document.querySelectorAll(".mr-cart-count");const mr_target=document.querySelector("#cbBotMessages");new Promise(function(resolve,reject){aisNode.setAttribute("class","viewCart");let body="";let val=data;if(val&&val.hasOwnProperty("content")){let header=`<div class="cart-header theme"><div class="cart-title">${((val.title && val.title !== "") ? val.title : "Message")}</div>
                    <span class="close-cart-view">X</span></div>`;body+=header;body+=`<div class="help-content"><p>`;body+=((val.content&&val.content!=="")?val.content:"");body+=`</p>`;let buttonText=((val.button&&val.button!=="")?val.button:"");let buttonAction=((val.action&&val.action!=="")?val.action:"");let buttonType=((val.type&&val.type!=="")?val.type:"");if(buttonText!==""){body+=`<div class="ex_button theme" data-type="${buttonType}" data-action="${buttonAction}">${buttonText || "Click here"}</div>`}
body+=`</div>`}else{body+=`<div></div>`}
aisNode.innerHTML=body;resolve(1)}).then(function(){const viewBox=document.querySelectorAll(".viewCart");if(viewBox){viewBox.forEach((ele)=>ele.remove())}
const box=document.querySelector("#cbMessages");box.append(aisNode);mr_target.querySelectorAll(".mr-loader").forEach((ele)=>ele.style.display="none");let scroll=document.getElementById("cbMessages");if(scroll){scroll.scrollIntoView({behavior:"smooth",block:"end"})}
let close=document.querySelector(".viewCart .close-cart-view");let ex_button=document.querySelector(".viewCart .ex_button");if(ex_button){ex_button.addEventListener("click",notificationExecution,!0)}
if(close){close.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const viewBox2=document.querySelectorAll(".viewCart");if(viewBox2){viewBox2.forEach((ele)=>ele.remove())}},!0)}}).then(function(){let menus=document.querySelectorAll(".menu-list .mr-menu-item");if(menus){menus.forEach((ele)=>ele.addEventListener("click",mrBotMenuEvent,!0))}
Aicb.common.mrLoader(!1);Aicb.common.typeLoader(!1)})}
function mrHelpMenuExecute(e){if(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation()}
Aicb.common.mrLoader(!0);let aisNode=document.createElement("DIV");const mr_count=document.querySelectorAll(".mr-cart-count");const mr_target=document.querySelector("#cbBotMessages");firebase.database().ref().child("/help/").once("value").then(function(snap){aisNode.setAttribute("class","viewCart");let body="";let val=snap.val();if(val&&val.hasOwnProperty("helpContent")){let header=`<div class="cart-header theme"><div class="cart-title">${((val.helpTitle && val.helpTitle !== "") ? val.helpTitle : "Help")}</div><span class="close-cart-view">X</span></div>`;body+=header;body+=`<div class="help-content">`;body+=((val.helpContent&&val.helpContent!=="")?val.helpContent:"");body+=`</div>`}else{body+=`<div></div>`}
aisNode.innerHTML=body}).then(function(){const viewBox3=document.querySelectorAll(".viewCart");if(viewBox3){viewBox3.forEach((ele)=>ele.remove())}
const box=document.querySelector("#cbMessages");box.append(aisNode);mr_target.querySelectorAll(".mr-loader").forEach((ele)=>ele.style.display="none");let scroll=document.getElementById("cbMessages");if(scroll){scroll.scrollIntoView({behavior:"smooth",block:"end"})}
let close=document.querySelector(".viewCart .close-cart-view");if(close){close.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const viewBox=document.querySelectorAll(".viewCart");if(viewBox){viewBox.forEach((ele)=>ele.remove())}},!0)}}).then(function(){let menus=document.querySelectorAll(".menu-list .mr-menu-item");if(menus){menus.forEach((ele)=>ele.addEventListener("click",mrBotMenuEvent,!0))}});Aicb.common.mrLoader(!1);Aicb.common.typeLoader(!1)}
function menu_event(){firebase.auth().onAuthStateChanged(function(user){const mr_menus=document.querySelector(".mr_menus");const cb_bot=document.querySelector(".cb_bot");const cb_specker=document.querySelector(".cb_specker");const cb_cart=document.querySelector(".cb_cart");const cart_count=document.querySelector(".mr-cart-count");const cb_info=document.querySelector(".cb_info");if(cb_info){cb_info.addEventListener("click",mrHelpMenuExecute,!0)}
if(mr_menus){mr_menus.addEventListener("click",mrMenuExecute,!0)}
if(cb_bot){cb_bot.addEventListener("click",function(e){let action=cb_bot.dataset.action;let bot={};const line=document.querySelector(".bot-line");if(action==="pulse"){cb_bot.dataset.action="running";cb_bot.classList.remove("bot-pulse");bot.status="active";if(line){line.style.display="none"}}else{cb_bot.dataset.action="pulse";cb_bot.classList.add("bot-pulse");bot.status="pulse";if(line){line.style.display="inline"}}
if(user!=null){let ref=firebase.database().ref("clients").child(user.uid);ref.child("conversation").child("mr-assistant").update(bot);ref.child("settings").update(bot)}})}
if(cb_info){cb_info.addEventListener("click",function(e){Aicb.searchEngine.run({api:"master",ks:"all",qs:"help",type:"kb",att:{}})})}
if(cb_cart){cb_cart.addEventListener("click",function(e){Aicb.eCommerce.viewCart()})}})}
function detectMobile(){let bot=document.body;let mobile=["Android","webOS","iPhone","iPad","iPod","BlackBerry","Windows Phone"];if(mobile.some((mob)=>navigator.userAgent.match(new RegExp(mob,"i")))){bot.classList.remove("desktop");bot.classList.add("mobile");let iframe=window.frameElement;iframe.style.width="100%";return!0}else{bot.classList.remove("mobile");bot.classList.add("desktop");return!1}}
function setEvent(){const alc_chatbot=document.querySelector(".alc_chatbot");let close_chat=document.querySelector(".close-chat");let iframe=window.frameElement;iframe.style.width="430px";iframe.style.height="100vh";let introMessage=document.querySelectorAll(".tempBox");if(introMessage){introMessage.forEach((ele)=>ele.remove())}
if(close_chat){close_chat.addEventListener("click",function(e){let alc_chat=document.querySelector("#alc_chat");if(alc_chatbot&&alc_chat){alc_chat.remove();iframe.style.width="112px";iframe.style.height="140px"}
let introMessage2=document.querySelector(".introMessage");if(introMessage2){introMessage2.remove()}
const popup=document.querySelector(".alc_pop_box");if(popup){popup.innerHTML=""}
localStorage.setItem("mrAssistantDom","close");Aicb.common.setCookie("mrAssistantDom","close",{"path":document.location.pathname});Aicb.conn.clear()})}}
function initializedChat(){setEvent();menu_expend();menu_event();optionsDropdown()}
function optionsDropdown(){const mr_dropdown_btn=document.querySelector(".mr-dropdown-btn");mr_dropdown_btn.addEventListener("click",function(e){let mr_dropdown=document.querySelector(".mr-dropdown");mr_dropdown.style.display=(mr_dropdown.style.display==="none"?"":"none")})}
function setTempChat(data){if(data.type!=="admin"){return}
if(Date.now()-data.time<2000){let tempBox=document.querySelector(".tempBox");let introMessage=document.querySelector(".introMessage");if(introMessage){introMessage.remove()}
if(tempBox){tempBox.style.display="inline-flex";let mBox=document.createElement("DIV");let mBox2=document.createElement("DIV");mBox.setAttribute("class","tempMessages");mBox2.setAttribute("class","tempMessage theme");if(!!settings.appearance&&!!settings.appearance.theme){mBox2.setAttribute("style","background: "+settings.appearance.theme||"")}
mBox2.innerHTML=data.text;mBox.appendChild(mBox2);tempBox.prepend(mBox);let scroll=document.querySelector(".tempBox");if(scroll){scroll.scrollIntoView({behavior:"smooth",block:"end"})}}}}
function browsesHistory(user){if(!user){return}
let path=Aicb.common.getUrlPath();let previousPath=localStorage.getItem("mrCurrentPage");let data={};if(previousPath!==path){firebase.database().ref("browses").child(user.uid).push({"page":path,"time":Date.now()});data.currentPage=path;localStorage.setItem("mrCurrentPage",path)}
data.lastSeen=Date.now();firebase.database().ref("clients").child(user.uid).child("info").update(data)}
function chatWithVisitor(){firebase.auth().onAuthStateChanged(function(user){if(!user){firebase.database().ref("settings").child("configuration").on("value",function(snap){let config=snap.val();if(config.chatWay==="chatWithVisitors"&&!!config.chatWithVisitor){firebase.database().ref("actions").child("onlineVisitors").once("value",function(online){let timeOut=online.val();let lastSync=Aicb.common.timeAgo(timeOut.lastSync,"min");let method=config.chatWithVisitorWay;if(!!config.offlineTracking||lastSync<=30){let ann="Visitor "+Aicb.common.getRandomInt(1000,9999);let info={"name":ann,"email":"","isNewUser":!1,"marge":!1,"lastSeen":Date.now(),"method":method,"type":"visitorChat","chatWay":"chatWithVisitor","join":Date.now(),"status":"active","currentPage":window.location.href,"browser":Aicb.common.getBrowser(),"language":navigator.language,"platform":navigator.platform};if(method==="anonymousAuth"){if(lastSync<=30){firebase.auth().signInAnonymously().then((snap)=>{let user=snap.user;if(user){info.guid="";info.uid=user.uid;info.vChat="initialized";firebase.database().ref("visitors").child(user.uid).update(info);firebase.database().ref("clients").child(user.uid).child("info").update(info);firebase.database().ref("actions/onlineVisitors/unSeen").transaction(function(visitor){return(visitor||0)+1})}}).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}}else if(method==="anonymousGuidAuth"){let getGUID=Aicb.common.localDB("mrAssistantGUID","get");let visitor=Aicb.common.jsonParse(getGUID[0]);if(!getGUID[0]||!getGUID[0].guid){let guid=Aicb.common.generateGUID();let name="Visitor "+Aicb.common.getRandomInt(1000,9999);Aicb.common.localDB("mrAssistantGUID","set",{"guid":guid,"visitor":name,"join":Date.now()},!0);info.name=name;info.join=Date.now();info.guid=guid;info.uid="";info.status="justJoin";firebase.database().ref("visitors").child(guid).once("value",function(snap){if(!snap.key){firebase.database().ref("actions/onlineVisitors/unSeen").transaction(function(visitor){return(visitor||0)+1})}});firebase.database().ref("visitors").child(guid).update(info)}
let getGUID2=Aicb.common.localDB("mrAssistantGUID","get");if(getGUID2[0]&&getGUID2[0].guid){info.name=getGUID2[0].visitor;firebase.database().ref("visitors").child(getGUID2[0].guid).update(info);firebase.database().ref("actions").child("visitorSignUp").child(getGUID2[0].guid).on("value",function(snap){let data=snap.val();if(data){let lastSync=Aicb.common.timeAgo(data.lastSync,"min");if(data.guid===getGUID2[0].guid&&lastSync<=2){firebase.auth().signInAnonymously().then((snap)=>{let user=snap.user;if(user){info.guid=getGUID2[0].guid;info.uid=user.uid;info.join=getGUID2[0].join||Date.now();info.method=method;firebase.database().ref("clients").child(user.uid).child("info").update(info).then(function(){Aicb.conn._conversationInit(user)})}}).then(function(){info.vChat="initialized";firebase.database().ref("visitors").child(getGUID2[0].guid).update(info)}).then(function(){firebase.database().ref("actions").child("visitorSignUp").child(getGUID2[0].guid).remove()}).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}}})}}}})}})}else if(user&&user.uid){browsesHistory(user);firebase.database().ref("livechat").child(user.uid).limitToLast(1).on("child_added",function(snap){let data=snap.val();let chatFrame=localStorage.getItem("mrAssistantDom");let frame=Aicb.common.getCookie("mrAssistantDom",{"path":document.location.pathname});if(frame!=="expend"){let container=document.querySelector(".alc_chatbot");if(container){let iframe=window.frameElement;iframe.style.width="430px";iframe.style.height="60vh";let tempBox=document.querySelector(".tempBox");if(!tempBox){let box=document.createElement("DIV");box.setAttribute("class","chat tempBox");container.appendChild(box)}
setTempChat(data);tempMeg=1}}})}})}
function chat_start(){return new Promise(function(res,rej){const alc_chatbot=document.querySelector(".alc_chatbot");if(!alc_chatbot){return}
let close_chat=document.querySelector(".close-chat");if(!close_chat){const node=document.createElement("DIV");node.setAttribute("class","chat");node.setAttribute("id","alc_chat");node.innerHTML=Aicb.template.chatTemplate();alc_chatbot.appendChild(node)}
res(initializedChat())}).then(function(){let chat=new WPAI_Chat();if(chat.conn){chat.conn.execute()}
if(parseInt(mrAssistantObj.woo)===1){let cart=localStorage.getItem("mrAssistantCart");if(parseInt(cart)){Aicb.eCommerce.setCartTotal(parseInt(cart))}}
localStorage.setItem("mrAssistantDom","expend");Aicb.common.setCookie("mrAssistantDom","expend",{"path":document.location.pathname});document.body.className=document.body.className.replace("no-js","js")})}
function addCustomStyle(){let mr_custom_style=document.getElementById("mr_custom_style");if(Aicb.common.isset(mrAssistantObj)&&mr_custom_style){let css="";if(mrAssistantObj.hasOwnProperty("chat_bg")&&Aicb.common.isValidURL(mrAssistantObj.chat_bg)){css+=`#cbBotMessages{background: transparent url(${mrAssistantObj.chat_bg}) center top no-repeat;background-size: cover;}`}
mr_custom_style.innerHTML=css}}
function addObjToScript(srt){const sc=document.getElementById("mr_config_script");let obj={};if(sc&&srt){obj.configuration=((srt.hasOwnProperty("configuration"))?srt.configuration:{});sc.innerHTML="let mrAssets ="+JSON.stringify(obj)}}
function addTranslation(){firebase.database().ref("translation").child("chatWidget").once("value",function(snap){let trans=snap.val();if(trans){const sc=document.getElementById("mr_trans_config");if(sc){sc.innerHTML="let mrTrans ="+JSON.stringify(trans)}}}).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}
function initChat(config){let singleView=`<div class="alc_popup"><div class="alc_pop_box"></div></div>`;let container=[`<div class="alc_chatbot">${singleView}</div>`].join("\n");let div=document.createElement("DIV");div.setAttribute("class","mr-assistant-container");div.innerHTML=container;document.body.prepend(div);if(parseInt(mrAssistantObj.woo)===1){let cart=parseInt(mrAssistantObj.wooCart);localStorage.setItem("mrAssistantCart",cart.toString());if(cart>0){Aicb.eCommerce.setCartTotal(cart)}}
setTimeout(function(e){const iframe=window.frameElement;iframe.style.opacity=1},1000)}
function firebaseInitPublic(){addCustomStyle();if(!mrAssistantObj.hasOwnProperty('web_api_key')||!mrAssistantObj.hasOwnProperty('project_id')){if(mrAssistantObj.dev==="on"){console.info('Ooops!!! Wrong Configuration.')}
return}
if(!mrAssistantObj.web_api_key===""||!mrAssistantObj.project_id===""){if(mrAssistantObj.dev==="on"){console.info('Ooops!!! Wrong Configuration.')}
return}
if(!firebase.apps.length){let config={apiKey:mrAssistantObj.web_api_key,authDomain:mrAssistantObj.project_id+".firebaseapp.com",databaseURL:"https://"+mrAssistantObj.project_id+".firebaseio.com",storageBucket:mrAssistantObj.project_id+".appspot.com"};firebase.initializeApp(config)}
if(firebase.apps.length){settings=Object.assign({},mrAssistantObj);firebase.database().ref("settings").once("value",function(snap){if(!snap.val()){return}
detectMobile();settings=Object.assign({},settings,snap.val());if(settings.hasOwnProperty("configuration")){if(!settings.configuration.assistantSupport){return}}
initChat(settings);addObjToScript(settings);addTranslation();flyMessage()}).then(function(){const alc_start=document.querySelector(".alc_start");if(alc_start){alc_start.addEventListener("click",chat_start,!0)}
chatWithVisitor();const chat_icon=document.querySelector(".mr-chat-icon");if(chat_icon){const custom_icon=mrAssistantObj.chat_icon?mrAssistantObj.chat_icon:"";const df_icon=mrAssistantObj.plugin_url+'assets/images/chat-button.svg';let ChatImgId=Math.floor((Math.random()*92992343)+1);chat_icon.setAttribute("id","mrImg-"+ChatImgId);Aicb.common.image(ChatImgId,custom_icon,df_icon,"imgSrc")}}).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}}
return{execute:firebaseInitPublic,settings:settings,mrHelpMenuExecute:mrHelpMenuExecute,popMessage:popMessage,chatWithVisitor:chatWithVisitor,chat_start:chat_start}})();WPAI_Chat.prototype.translate=(function(){"use strict";function get(text,key){if(mrTrans){if((key&&mrTrans.hasOwnProperty(key))&&(mrTrans[key].hasOwnProperty("tx1")&&mrTrans[key].tx1!=="")){return((mrTrans[key].hasOwnProperty("tx2")&&mrTrans[key].tx2!=="")?mrTrans[key].tx2:text)}else{let user=firebase.auth().currentUser;if(user){let tx={"tx1":text,"tx2":text}
firebase.database().ref('translation').child("chatWidget").child(key).update(tx)}}}
return text}
function execute(){let user=firebase.auth().currentUser;if(!user){return}
const mrtx=document.querySelectorAll(".mrtx");if(mrtx){firebase.database().ref("translation").child("chatWidget").once("value",function(snap){let val=snap.val()||{};if(val||!val){const sc=document.getElementById("mr_trans_config");if(sc){sc.innerHTML="let mrTrans ="+JSON.stringify(val)}
mrtx.forEach(function(ele){const text=ele.innerText,key=ele.dataset.key;if(val.hasOwnProperty(key)&&(val[key].hasOwnProperty("tx1")&&val[key].tx1!=="")){ele.innerText=((val[key].hasOwnProperty("tx2")&&val[key].tx2!=="")?val[key].tx2:text)}else{let tx={"tx1":text,"tx2":text}
firebase.database().ref('translation').child("chatWidget").child(key).update(tx)}})}}).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}}
return{execute:execute,get:get}})();WPAI_Chat.prototype.carousel=(function(){"use strict";function init(){var carousels=document.querySelectorAll('.mr_carousel');[].forEach.call(carousels,function(carousel){initialize(carousel)})}
function initialize(carousel){var productList=carousel.querySelector('.mr_items');var productListWidth=300;var productListSteps=0;var products=carousel.querySelectorAll('.mr_items li');var productAmount=0;var productAmountVisible=1;var carouselPrev=carousel.querySelector('.mr_c_prev');var carouselNext=carousel.querySelector('.mr_c_next');[].forEach.call(products,function(product){productAmount++;productListWidth+=300;productList.style.width=productListWidth+"px"});carouselNext.onclick=function(){if(productListSteps<productAmount-productAmountVisible){productListSteps++;moveProductList()}};carouselPrev.onclick=function(){if(productListSteps>0){productListSteps--;moveProductList()}};function moveProductList(){productList.style.transform="translateX(-"+300*productListSteps+"px)"}}
return{execute:init}})();WPAI_Chat.prototype.eCommerce=(function(){"use strict";function onAddToCart(cart){cart.preventDefault();cart.stopPropagation();cart.stopImmediatePropagation();if(parseInt(mrAssistantObj.woo)===0){return}
let pid=cart.target.dataset.pid;let stock=cart.target.dataset.stock;if(stock&&stock==="outOfStock"){Aicb.conn.notification(Aicb.translate.get("Sorry!! This item is out of stock.","_txcwecac4"));Aicb.searchEngine.saveMessage(Aicb.translate.get("Sorry!! This item is out of stock.","_txcwecac5"),"bot","mr");return}
if(cart.target.classList.contains("mr_view_cart")){return}
cart.target.classList.remove("s-buy-plus");cart.target.innerHTML=Aicb.template.loader();let url=new URL(mrAssistantObj.domain);url.searchParams.set("post_type","product");url.searchParams.set("add-to-cart",pid);axios.get(url).then((result)=>{if(result.data){let cart_count=document.querySelectorAll(".mr-cart-count");cart_count.forEach(ele=>{ele.style.display="block";let value=(parseInt(ele.innerText)?parseInt(ele.innerText):0),cart=value+1;ele.innerText=cart;localStorage.setItem("mrAssistantCart",cart.toString())});Aicb.conn.notification(Aicb.translate.get("Success!! Item has added to Shopping Cart.","_txcwecac1"));Aicb.searchEngine.saveMessage(Aicb.translate.get("Item has added to Shopping Cart.","_txcwecac2"),"bot","mr");const addToCart=document.getElementById('addToCart');if(addToCart){addToCart.innerHTML=`<div class="mr-add-to-cart theme"><a target="_blank" href="${mrAssistantObj.wooCartURL}"><span class="iconify" data-icon="bi:cart-check"></span>  VIEW CART</a></div>`}
cart.target.classList.add("s-buy-plus");cart.target.classList.add("mr_view_cart")}})}
function view_details(node){node.preventDefault();node.stopPropagation();node.stopImmediatePropagation();Aicb.conn.notification("Executing your Details View request.")
let pid=node.target.dataset.pid;const popup=document.querySelector(".alc_pop_box");let introMessage=document.querySelector(".introMessage");if(introMessage)introMessage.remove();let iframe=window.frameElement;iframe.style.width="100%";iframe.style.height="100vh";let config={};config.id=pid;popup.innerHTML=Aicb.common.loaderText();return axios({url:mrAssistantObj.plugin_url+"mr-postman.php",data:{action:"mr_get_posts",mr_api:"mr_view_post",requestData:JSON.stringify(config)},method:"POST",type:"JSON",withCredentials:!0,token:"show "+Date.now()+" cart",timeout:30000,headers:{"Accept":"application/json","Content-Type":"application/json"}}).then((response)=>{let result=response.data;if(result.data.status==="ok"){try{let data=result.data.data;if(!data.ID){popup.innerHTML="";iframe.style.width="430px";iframe.style.height="100vh";const url=mrAssistantObj.domain+"?p="+pid;const win=window.open(url,"_blank");win.focus();return}else{let id=data.ID,type=data.post_type;popup.innerHTML=Aicb.template.singleView(type,data)}}catch(e){const url2=mrAssistantObj.domain+"?p="+pid;Aicb.init.popMessage({"title":Aicb.translate.get("Open This Page","_txcwepop1"),"content":Aicb.translate.get("Pop-ups were Blocked on this page!! Please Click on view now button to open this.","_txcwepop2"),"type":"redirect","button":Aicb.translate.get("View Now","_txcwepop3"),"action":url2});if(mrAssistantObj.dev==="on"){console.info(e)}}}}).then(function(){let close_btn=document.querySelector(".close_btn");let carts=document.querySelectorAll(".mr-add-to-cart");if(carts){carts.forEach(ele=>{ele.addEventListener("click",onAddToCart,!0)})}
if(close_btn){close_btn.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();popup.innerHTML="";iframe.style.width="430px";iframe.style.height="100vh"},!0)}})}
function viewCartContent(){Aicb.common.mrLoader(!0);let aisNode=document.createElement("DIV");const mr_count=document.querySelectorAll(".mr-cart-count");const mr_target=document.querySelector("#cbBotMessages");if(!0){aisNode.setAttribute("class","viewCart");let body="";return axios({url:mrAssistantObj.plugin_url+"mr-postman.php",data:{action:"mr_cart_contents"},method:"POST",type:"JSON",withCredentials:!0,token:"show "+Date.now()+" cart",timeout:60000,headers:{"Accept":"application/json","Content-Type":"application/json"}}).then((response)=>{let result=response.data;if(result.cart_total&&!!mr_count){mr_count.forEach(ele=>ele.innerText=result.cart_total)}
Aicb.conn.notification("Here are your Shopping Cart.");let header=[`<div class="cart-header theme">`,`<div class="cart-title">${Aicb.translate.get("My Shopping Cart","_txcwwo1")}</div>`,`<span class="close-cart-view">X</span></div>`].join("");body+=header;if(result.cart_contents.length>0){let cartBody="";let count=1;result.cart_contents.forEach(ele=>{cartBody+=[`<li class="vc-row">`,`<span>${ele.image}</span>`,`<span class="vc-title">${ele.title}</span>`,`<span>${ele.quantity}</span>`,`<span>${ele.item_total}</span>`,`</li>`].join("")});body+=`<ul class="vc_cart"><li class="vc-head"><span> </span><span>Products</span><span> Qty</span><span>Price</span></li>`;body+=cartBody;body+=`<li class="vc-footer"><span>Sub Total</span><span>${result.subtotal}</span></li>`;body+=`<li class="vc-footer"><span>Shipping Cost</span><span>${result.shipping_cost}</span></li>`;body+=`<li class="vc-footer"><span>Total</span><span>${result.total}</span></li>`;body+=`</ul>`;body+=`<a href="${ mrAssistantObj.wooCheckOutURL || mrAssistantObj.domain + "/checkout"  }" target="_blank" class="checkoutBtn theme">${Aicb.translate.get("Check Out","_txcwwo2")}</a>`}else{body+=`<div>${Aicb.translate.get("No Iten Found","_txcwwo3")}</div>`}}).then(()=>{mr_target.querySelectorAll(".mr-loader").forEach(ele=>ele.style.display="none")}).then(function(){aisNode.innerHTML=body;const viewBox=document.querySelectorAll(".viewCart");if(viewBox)viewBox.forEach(ele=>ele.remove());const box=document.querySelector("#cbMessages");box.append(aisNode);Aicb.common.mrLoader(!1);let close=document.querySelector(".viewCart .close-cart-view");if(close){close.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const viewBox=document.querySelectorAll(".viewCart");if(viewBox)viewBox.forEach(ele=>ele.remove())},!0)}
Aicb.common.typeLoader(!1)})}}
function setCartTotal($cart){const count=document.querySelectorAll(".mr-cart-count");if(count&&$cart>0){count.forEach(ele=>{ele.style.display="block";ele.innerText=$cart})}else{if(count)count.forEach(ele=>ele.style.display="none")}}
return{onAddToCart:onAddToCart,view_details:view_details,viewCart:viewCartContent,setCartTotal:setCartTotal,}})();WPAI_Chat.prototype.searchEngine=(function(){"use strict";let settings={};let accessToken;let in0;let t0;let notFoundSuggest=0;let knowledgeDB={};let knowledgeDBLength=0;let setTime=1000;let botMessage="";let mrRepo=0;let actionType="search";function RepoMessages(){let megs=["Just splendid, thanks","Not too shabby at all, thanks","I guess you could say i feel wired all the time. Let me know how I can help!"];return megs[Math.floor(Math.random()*megs.length)]}
function getUserId(){return firebase.auth().currentUser&&firebase.auth().currentUser.uid}
function getRandomAns(obj){let arr=Object.values(obj);if(arr&&arr.length>0){return arr[Math.floor(Math.random()*arr.length)]}
return""}
function pipeMessage(template,data,token,token2){let session=Aicb.common.getCookie("mrRobotSession");if(token2!==accessToken){return}
if(template==="kb"){saveMessage(data,"bot",token)}else if(template==="rel"){Aicb.common.typeLoader(!0);let mr_tags=document.querySelectorAll(".mr-tags");if(mr_tags){mr_tags.forEach((ele)=>ele.remove())}
let node=document.createElement("DIV");node.setAttribute("class","mr-tags");let tags="";data.forEach(function(ele){let span=document.createElement("SPAN");span.setAttribute("class","tag fade theme");span.setAttribute("data-key",ele.key);span.innerText=ele.val;span.addEventListener("click",mr_suggestion_execute,!0);node.appendChild(span)});const cbMessages=document.getElementById("cbMessages");Aicb.common.playSound("au-message");Aicb.common.typeLoader(!1);if(cbMessages){cbMessages.appendChild(node)}}
const cbMessages2=document.getElementById("cbMessages");if(cbMessages2){cbMessages2.scrollIntoView({behavior:"smooth",block:"end"})}}
function openURL(url,question){try{let url2=new URL(url);Aicb.init.popMessage({"title":Aicb.translate.get("Page Suggestion","_txcwpm1"),"content":Aicb.translate.get("Click this button to open this page.","_txcwpm2")+"<p>"+url+"</p>","type":"redirect","button":Aicb.translate.get("Open Page","_txcwpm3"),"action":url});let win=window.open(url2,"_blank");if(!win||win.closed||typeof win.closed=="undefined"){Aicb.conn.notification(Aicb.translate.get("Pop-up Blocked. Click this button to open this page.","_txcwrn1"))}else{return win.focus()}}catch(e){firebase.database().ref("training").push({"uid":getUserId(),"time":Date.now(),"type":"URL","sts":1,"qs":"KB action fail. KB: "+question})}}
function nextAction(data){if(botMessage===data.key){if(mrRepo>4){saveMessage(RepoMessages(),"bot",accessToken)}
mrRepo+=1;return""}
mrRepo=0;actionType="search";botMessage=data.key;if(!data.hasOwnProperty("ans")||data.ans===""){Aicb.common.typeLoader(!1)}
if(data.type==="search"){Aicb.controller.bot(data.act,{"cuAction":1,"kbAction":0,"sbAction":1,"allow":1})}else if(data.type==="kb"){actionType="all_KB";Aicb.controller.bot(data.act,{"cuAction":0,"kbAction":1})}else if(data.type==="redirect"){if(data.act){openURL(data.act,data.que)}}else if(data.type==="update_cart"){if(parseInt(mrAssistantObj.woo)===1&&mrAssistantObj.wooCartURL){openURL(mrAssistantObj.wooCartURL,data.que)}}else if(data.type==="checkout"){if(parseInt(mrAssistantObj.woo)===1&&mrAssistantObj.wooCheckOutURL){openURL(mrAssistantObj.wooCheckOutURL,data.que)}}else if(data.type==="help"){const cb_info=document.querySelector(".cb_info");if(cb_info){cb_info.click()}}else if(data.type==="menu"){const mr_menus=document.querySelector(".mr_menus");if(mr_menus){mr_menus.click()}}else if(data.type==="cart"){const cb_cart=document.querySelector(".cb_cart");if(cb_cart){cb_cart.click()}}else if(data.type==="rate"){Aicb.form.feedbackForm("feedback")}
return""}
function mr_suggestion_execute(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let sug=e.target.innerText;let key=e.target.dataset.key;saveMessage(sug,"client",accessToken);let token=Aicb.common.generateGUID();Aicb.common.setCookie("mrRobotAutoAction",0,5);Aicb.common.setCookie("mrRobotSession",token,5);firebase.database().ref("knowledgeBase").child(key).once("value",function(snap){let val=snap.val();if(val){nextAction(val)}})}
async function knowledgeBaseSearch(str,token){if(token!==accessToken){return[]}
let mrKnowledge=elasticlunr(function(ela){ela.addField("que");ela.addField("tag");ela.setRef("key")});elasticlunr.clearStopWords=function(){elasticlunr.stopWordFilter.stopWords={}};elasticlunr.clearStopWords();elasticlunr.addStopWords=function(words){if(words==null||Array.isArray(words)===!1){return}
words.forEach(function(word){elasticlunr.stopWordFilter.stopWords[word]=!0},this)};let label;const kbType=actionType;let query=await firebase.database().ref("knowledgeBase").orderByKey();return await query.once("value").then(function(snapshot){let obj=snapshot.val();if(!obj)return[];knowledgeDBLength=Object.keys(obj).length;snapshot.forEach(function(childSnapshot){let key=childSnapshot.key;let childData=childSnapshot.val();if(childData.hasOwnProperty("status")&&parseInt(childData.status)>0){if(kbType==="all_KB"){mrKnowledge.addDoc(childData)}else if(childData.status==="2"){mrKnowledge.addDoc(childData)}}});label=mrKnowledge.search(str,{fields:{que:{boost:4},tag:{boost:3}}});return label})}
function knowledgeBase(apiAonfig,token){(async()=>{if(token!==accessToken)return;let label=await knowledgeBaseSearch(apiAonfig.qs,token);actionType="search";if(typeof label!==undefined&&label.length>0){let interval=1200;setTime=1000;let accept=3;if(mrAssets&&mrAssets.hasOwnProperty("configuration")){let mrAssetConfig=mrAssets.configuration;if(mrAssetConfig&&mrAssetConfig.hasOwnProperty("sb_power")){let sb_power=parseFloat(mrAssetConfig.sb_power);accept=sb_power>0?sb_power:0}}
if(label[0].score<=accept){if(!!settings.sbAction){return master(apiAonfig,token)}}
let answer=label[0].doc.ans?label[0].doc.ans:{};if(answer&&answer.constructor===Object&&Object.keys(answer).length>0){pipeMessage("kb",getRandomAns(Object.values(label[0].doc.ans)[0]),"mr",token);setTime+=1000}
if(answer&&answer.constructor===Object&&Object.keys(answer).length>1){let mAns=Object.assign({},Object.values(answer).slice(1));let last=Object.keys(mAns).pop();let i=1;const token2="pipe";Object.keys(mAns).forEach(function(prop){let val=mAns[prop];setTimeout(()=>{pipeMessage("kb",getRandomAns(val),"ma",token)},setTime+(interval*Math.random()));setTime+=1000;if(prop===last){let rel=label[0].doc.rel;if(rel&&rel.length>0){setTimeout(()=>{pipeMessage("rel",rel,"ma",token)},setTime+(interval*Math.random()));setTime+=1000}
if(apiAonfig.type!=="kb"&&label[0].doc.type!==""){try{let token=Aicb.common.getCookie("mrRobotAutoAction");let count=parseInt(token)>0?parseInt(token):0;Aicb.common.setCookie("mrRobotAutoAction",(count+1),5);if(count<3){setTimeout(()=>{nextAction(label[0].doc)},setTime+(interval*Math.random()));setTime+=1000}else{Aicb.common.setCookie("mrRobotAutoAction",0,5)}}catch(e){if(mrAssistantObj.dev==="on"){console.info(e)}}}}})}else{let rel=label[0].doc.rel;if(rel&&rel.length>0){setTimeout(()=>{pipeMessage("rel",rel,"ma",token)},setTime+(interval*Math.random()));setTime+=1000}
if(label[0].doc.act!==""){try{let token=Aicb.common.getCookie("mrRobotAutoAction");let count=parseInt(token)>0?parseInt(token):0;Aicb.common.setCookie("mrRobotAutoAction",(count+1),5);if(count<3){setTime+=1000;return nextAction(label[0].doc)}else{Aicb.common.setCookie("mrRobotAutoAction",0,5)}}catch(e){if(mrAssistantObj.dev==="on"){console.info(e)}}}}}else{if(!!settings.sbAction){master(apiAonfig,token)}}})()}
function master(apiAonfig,session){Aicb.common.mrLoader(!0);if(session!==accessToken)return;let result;apiAonfig=Object.assign({},apiAonfig,{"qs":Aicb.common.sanitize(apiAonfig.qs,!0)});if(apiAonfig.qs.trim().split(" ").splice(-1)[0].toLowerCase()==="go"){apiAonfig.ks="navigator";apiAonfig.qs=apiAonfig.qs.trim().replace(/\w+[.!?]?$/,"")}
apiAonfig.accessToken=session;let in1=(apiAonfig.ks+apiAonfig.qs).trim();in0=in1;t0=performance.now();const plugin_dir=mrAssistantObj.plugin_url;let ajax=plugin_dir+"mr-postman.php";let ajax_token={url:ajax,data:{action:"mr_professor",mr_api:apiAonfig.api||"master",requestData:JSON.stringify(apiAonfig)},method:"POST",timeout:30000,type:"JSON",headers:{"Accept":"application/json","Content-Type":"application/json"},};return axios(ajax_token).then(function(response){let data=response.data;if(!data){return Aicb.controller.bot("_notFound",{"cuAction":0,"kbAction":1,"sbAction":0,"botAction":"all_KB"})}
let label=response.data.data.data;let cryptography=response.data.cryptography;let accessToken2=data.accessToken;if(accessToken!==accessToken2)return;if(cryptography.api==="tags"&&cryptography.ks===""){if(!!label&&Object.keys(label).length>0){saveMessage(Aicb.translate.get("Here have some categories.","_txcwtag1"),"bot",accessToken);saveMessage(label,"tags",accessToken)}else{saveMessage(Aicb.translate.get("Sorry! no category found.","_txcwtag1"),"bot",accessToken)}}else{if(apiAonfig.ks==="navigator"){try{if(label[0]){let domain=mrAssistantObj.domain.replace(/\/$/,"")+"?p=";Aicb.conn.notification(Aicb.translate.get("Opening your requested page.","_txcwrd1"));saveMessage(Aicb.translate.get("Opening your requested page: ","_txcwrd1")+label[0].post_title,"bot",accessToken);let url=new URL(domain+label[0].id);let win=window.open(url,"_blank");Aicb.init.popMessage({"title":Aicb.translate.get("Page Suggestion","_txcwpm1"),"content":Aicb.translate.get("Click this button to open this page.","_txcwpm2"),"type":"redirect","button":Aicb.translate.get("Open Page","_txcwpm3"),"action":domain+label[0].id});if(!win||win.closed||typeof win.closed=="undefined"){}else{return win.focus()}
return}else{Aicb.conn.notification(Aicb.translate.get("Didn't find object to to open. Try again!!","_txcwrd2"));return saveMessage(Aicb.translate.get("Didn't find object to to open. Try again!!","_txcwrd2"),"bot",accessToken)}}catch(e){if(mrAssistantObj.dev==="on"){console.info(e)}}}
function botResponse(type,length){let _s=length>1?"s":"";let _this=length>1?"theses ":"this ";let _some=length>1?"some ":"the ";let found=[Aicb.translate.get("Here's what I found","_txcwrs1"),"Check out "+_this+type+_s,"Here's "+_some+type+_s,"Here's "+_some+"result"+_s];let notFound=[Aicb.translate.get("Sorry, I didn't find anything","_txcwrs3"),Aicb.translate.get("Nothing found","_txcwrs4"),Aicb.translate.get("No result found","_txcwrs5")];let meg=length>0?found[Math.floor(Math.random()*found.length)]:notFound[Math.floor(Math.random()*notFound.length)];saveMessage(meg,"bot",accessToken)}
if(label.length>0){notFoundSuggest=0;botResponse(label[0].post_type,label.length)}else{if(notFoundSuggest<1&&mrAssets.configuration.hasOwnProperty("notFound")&&mrAssets.configuration.notFound==="custom"){notFoundSuggest+=1;Aicb.controller.bot("_notFound",{"cuAction":0,"kbAction":1,"sbAction":0,"botAction":"all_KB"})}else{botResponse("null",0)}
Aicb.conn.notification("Need Help!! Type help or menu");firebase.database().ref("training").push({"uid":getUserId(),"time":Date.now(),"type":"notFound","status":1,"qs":apiAonfig.qs,})}
saveMessage(label,"slider",accessToken)}}).then(function(){document.getElementById("cbMessages").scrollIntoView({behavior:"smooth",block:"end"});Aicb.common.mrLoader(!1);return!0}).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}
function reduce(label){var result=label.reduce(function(acc,item){if(!!item.post_content){let ct=item.post_content.replace(/<\/?[^>]+(>|$)/g,"");let sc=ct.replace(/\[.*?\]/g,"").replace(/(\r\n|\n|\r)/gm," ");let sp=sc.split(" ").filter(n=>n).join(" ");let co=(sp.length>150)?sp.substring(0,150):sp;item.post_content=co.trim();acc.push(item)}else{acc.push(item)}
return acc},[]);return result}
function saveMessage(label,type,token=""){if(token===""){return}
let user=firebase.auth().currentUser;let obj={};obj.type=type;obj.time=Date.now();obj.text=label;if(type==="bot"){obj.text=label}else if(type==="slider"){obj.data=reduce(label)}else if(type==="tags"){obj.data=label}
if(user){let uid=user.uid||null;if(Aicb.conn.chatUsers){if(type==="client"){obj.name=Aicb.conn.chatUsers.clientName||"Anonymous"}else if(type==="bot"){obj.name=mrAssistantObj.name||"Mr. Assistant"}}
firebase.database().ref("livechat").child(uid).push(obj)}else{Aicb.common.localDB("mrAssistantOfflineChat","set",obj);Aicb.template.templateDark("offline-"+Math.floor(Math.random()*Math.floor(Date.now())),obj,"message-visitor")}}
function knowledgeBaseInit(){firebase.database().ref("knowledgeBase/").orderByChild("/time/").on("value",function(snap){let obj=snap.val();knowledgeDB=Object.assign({},obj)})}
function menuAction(action,type){accessToken="mrAssistant";return master({api:"master",ks:"all",qs:action,att:{}},accessToken)}
function tagManagerEvent(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let name=e.target.dataset.name;let slug=e.target.dataset.slug;let key=e.target.dataset.id;saveMessage(name,"client",accessToken);let token=Aicb.common.generateGUID();Aicb.common.setCookie("mrRobotAutoAction",0,5);Aicb.common.setCookie("mrRobotSession",token,5);let val=Aicb.common.sanitize(slug);return execute({api:"tags",ks:val,qs:"",att:{}},settings)}
function execute(apiConfig,botConfig){settings=Object.assign({},botConfig);try{accessToken=Aicb.common.getCookie("mrRobotSession");let actions=["master","products","posts","pages","tags","author"];if(apiConfig.api==="master"){if(!!botConfig.kbAction){if(botConfig.hasOwnProperty("botAction")&&botConfig.botAction==="all_KB"){actionType="all_KB"}
knowledgeBase(apiConfig,accessToken)}else if(!!botConfig.sbAction){master(apiConfig,accessToken)}}else if(actions.indexOf(apiConfig.api)!=="-1"){master(apiConfig,accessToken)}}catch(e){if(mrAssistantObj.dev==="on"){console.info(e)}}
return 0}
return{run:execute,menuAction:menuAction,tagManagerEvent:tagManagerEvent,saveMessage:saveMessage}})();WPAI_Chat.prototype.controller=(function(){"use strict";let settings={};const list={symAuthor:["@"],symPro:["$"],symRe:["/"],symTag:["#"],product1:["product","products","shop"],post1:["post","posts","blog"],page1:["page","pages"],tag1:["tag","tags","cat","category"],};let fe=Object.assign({},list,{symbols:Array.from(new Set(list.symPro.concat(list.symTag,list.symAuthor,list.symRe))),action:Array.from(new Set(list.product1.concat(list.post1,list.page1,list.tag1)))});function symbol(a,f){let feature=f.substr(1).trim();if(fe.symPro.indexOf(a)!==-1&&settings.a_product){return Aicb.searchEngine.run({api:"products",ks:"all",qs:feature,att:{}},settings)}else if(fe.symTag.indexOf(a)!==-1&&settings.a_tag){let first_word=feature.replace(/ .*/,"").replace(/[^a-zA-Z]+/g,"");if(fe.action.indexOf(first_word)!==-1){word(first_word,feature)}else{let sp=Aicb.common.split(feature);return Aicb.searchEngine.run({api:"tags",ks:sp[0],qs:sp[1],att:{}},settings)}}else if(fe.symAuthor.indexOf(a)!==-1&&settings.a_author){let sp=Aicb.common.split(feature);return Aicb.searchEngine.run({api:"author",ks:sp[0],qs:sp[1],att:{}},settings)}else if(fe.symRe.indexOf(a)!==-1){return Aicb.searchEngine.run({api:"master",ks:"navigator",qs:feature,att:{}},settings)}}
function word(a,f){let feature=f.substr(f.indexOf(" ")+1).trim();feature=(a!==f)?feature:"";if(fe.product1.indexOf(a)!==-1&&(settings.a_product||settings.allow)){return Aicb.searchEngine.run({api:"products",ks:"all",qs:feature,att:{}},settings)}else if(fe.post1.indexOf(a)!==-1&&(settings.a_post||settings.allow)){return Aicb.searchEngine.run({api:"posts",ks:"all",qs:feature,att:{}},settings)}else if(fe.tag1.indexOf(a)!==-1&&(settings.a_tag||settings.allow)){let sp=Aicb.common.split(feature);return Aicb.searchEngine.run({api:"tags",ks:sp[0],qs:sp[1],att:{}},settings)}else if(fe.page1.indexOf(a)!==-1&&(settings.a_page||settings.allow)){return Aicb.searchEngine.run({api:"pages",ks:"all",qs:feature,att:{}},settings)}}
function twoWordsSearch(str){let strLength=str.split(" ").length;if(6>strLength){const cats=["category","categories","cat","tag","tags"];if(Aicb.common.mrSearch([cats],str)){if(mrAssistantObj.woo&&Aicb.common.mrSearch([["product","products","shop","store"],cats],str)){return Aicb.searchEngine.run({api:"tags",ks:"",qs:"",tax:"product_cat",att:{}},settings)}else{return Aicb.searchEngine.run({api:"tags",ks:"",qs:"",tax:"category",att:{}},settings)}}}
return Aicb.searchEngine.run({api:"master",ks:"all",qs:str,att:{}},settings)}
function selectAction(val){let first=val.substr(0,1);let first_word=val.replace(/ .*/,"").replace(/[^a-zA-Z]+/g,"");if(fe.symbols.indexOf(val.substr(0,1))!==-1){symbol(val.substr(0,1),val);return!0}else if(fe.action.indexOf(first_word)!==-1){word(first_word,val);return!0}else{return twoWordsSearch(val)}
return Aicb.searchEngine.run({api:"master",ks:"all",qs:val,att:{}},settings)}
function mrCommandLine(cmd){let ac=cmd.toLowerCase();if(ac==="-mr allow adminchat"){localStorage.setItem("mrAssistantChatItself",!1)}}
function bot(feature,botConfig){settings=Object.assign({},botConfig);if(!!settings.cuAction){return selectAction(feature)}else{return Aicb.searchEngine.run({api:"master",ks:"all",qs:feature,att:{}},settings)}}
return{bot:bot,mrCommandLine:mrCommandLine}})();WPAI_Chat.prototype.template=(function(){"use strict";let system={};function loader(){return['<div class="mr-load">','<span></span>','<span></span>','<span></span>','<span></span>','</div>'].join('')}
function _tx(text='',identifier='',mode=!0){return'<span class="mrtx" data-key="'+identifier+'" data-mode="'+mode+'">'+text+'</span>'}
function flyTemplate(message,name='Mr. Assistant',avatar=''){return['<div class="close-introMessage">','<button type="button">','<span class="iconify" data-icon="ion:close"></span>','</button>','</div>','<div class="intro-container">','<img src="'+avatar+'" alt="'+name+'" class="avatar i-avatar">','<div style="margin-right: 20px;"><div class="i-avatar-name">'+name+'</div><div class="message-container">'+message+'</div>','<div class="intro-start-btn theme"><span class="iconify" data-icon="bx:bxs-chat" data-inline="true"></span><span>&nbsp;&nbsp;'+_tx('Start Live Chat','_txcwi1')+'</span></div>','</div>','</div>',].join('\n')}
function chatTemplate(){const bot=mrAssistantObj.plugin_url+'assets/images/mr-assistant.svg';let imgId=Math.floor((Math.random()*92992343)+1);let mrAvatar=bot;if(mrAssistantObj.hasOwnProperty("menu_avatar")&&Aicb.common.isValidURL(mrAssistantObj.menu_avatar)){mrAvatar=mrAssistantObj.menu_avatar}
Aicb.common.image(imgId,mrAvatar,bot,"imgSrc");let placeholder="Search & Message...";if(mrAssistantObj.hasOwnProperty("placeholder")&&mrAssistantObj.placeholder!==""){placeholder=mrAssistantObj.placeholder}
let header=['<div class="chat-header theme">','<div class="mr-left-header">','<div class="mr-avatars">','<div class="mr-avatar theme"><img width="45" src="'+bot+'"/></div>','</div>','<h2 class="mr-live-person "><span class="mr-chat-with">'+_tx('Chat with','_txcwh1')+' </span>Mr. Assistant</h2>','</div>','<button class="close-chat material-icons" type="button">','<span class="iconify" data-icon="ion:close"></span>','</button>','<button class="mr-dropdown-btn material-icons" type="button">','<span class="iconify" data-icon="bx:bx-dots-vertical-rounded" data-inline="true"></span>','</button>','<div class="mr-dropdown theme" style="display: none"></div>','<div class="mr_status_box theme">','<span class="mr_status theme">Loading ...</span>','</div>','</div>'].join('\n');const body=['<div id="cbBotMessages">','<div class="loadMore theme" data-inset="20" data-step="10" style="display: none;">Load More </div>','<div id="cbMessages" class="scrollbar">','</div>','</div>'].join('\n');const footer=['<div class="input-group">','<div class="drag-active-wrapper">','<button type="button" data-action="sleep" class="cb_bot material-icons">','<span class="iconify bot-line" data-icon="uil:line-alt" style="display: none"></span>','<span class="iconify" ><img id="mrImg-'+imgId+'" src="'+mrAvatar+'" width="30" height="30" class="theme"/></span>','</button>','<button type="button" class="cb_info material-icons">','<span class="iconify" data-icon="icomoon-free:info"></span>','</button>','<button type="button" class="cb_cart iconify material-icons">','<span class="iconify" data-icon="mdi:cart-outline"></span>','<sup class="mr-cart-input mr-cart2 theme mr-cart-count" style="display: none"></sup>','</button>','<button type="button" data-action="sleep" class="mr_microphone material-icons">','<span class="iconify" data-icon="mdi:microphone-off"></span>','</button>','<button type="button" class="mr_menus material-icons">','<span class="iconify" data-icon="ion:menu" data-inline="false"></span>','</button>','<button type="button" style="display: none" class="cb_expend iconify material-icons">','<span class="iconify" data-icon="mdi:chevron-right"></span>','</button>','<div id="message-form" style="display: flex;width: 100%">','<input id="mrCrts" type="hidden"/>','<input id="message" placeholder="'+placeholder+'" type="text" autocomplete="off"/>','<button  id="mr_sender" class="material-icons">','<span class="iconify" data-icon="mdi:send"></span>','</button>','</div>','</div>','</div>'].join('\n');return header+body+footer}
function getAvatar(uid){let def=mrAssistantObj.plugin_url+'assets/images/boy.svg';if(uid!==""&&Aicb.common.isset(mrUsers)&&mrUsers.hasOwnProperty(uid)){let user=mrUsers[uid];if(user.hasOwnProperty("avatar")&&user.avatar!==""){return user.avatar}}
return def}
function getName(type,uid){if(type==="admin"||type==="client"){if(Aicb.common.isset(mrUsers)&&mrUsers.hasOwnProperty(uid)){let user=mrUsers[uid];return(user&&user.hasOwnProperty('name'))?user.name:"Anonymous"}}
return(mrAssistantObj&&mrAssistantObj.hasOwnProperty('name'))?mrAssistantObj.name:"Mr. Assistant"}
function setMessage(key,data,settings,nodeType){const node=document.createElement("DIV");const container=document.createElement("DIV");container.setAttribute('class','meg-wrapper');node.setAttribute('class','message fade '+(data.type!==''?data.type:'bot'));node.setAttribute('id','mr'+key);const text=document.createElement("span");text.setAttribute('class','message-content');text.appendChild(document.createTextNode(data.text));let nam=`<p class="user">${(data.name && data.name !== '') ? data.name  : getName(data.type, data.uid || "")}</p>`;let cls=(data.type==='client')?'theme':'';container.innerHTML=nam+'<span class="message-content '+cls+'">'+data.text+'</span>';if(data.type!=='bot'){const time=document.createElement("div");time.setAttribute('class','time');time.appendChild(document.createTextNode(Aicb.common.getDateTime(data.time)));if(node){container.appendChild(time)}}
node.append(container);let div=document.createElement("DIV");let img=document.createElement("IMG");img.width=25;img.height=25;let imgId=Math.floor((Math.random()*92992343)+1);div.setAttribute('class','avatar-wrapper');img.setAttribute('class','avatar');img.setAttribute('id',"mrImg-"+imgId);let defAvatar=mrAssistantObj.plugin_url+'assets/images/mr-assistant.svg';let avatar="";if(data.type==='bot'){avatar=(mrAssistantObj.hasOwnProperty('avatar'))?mrAssistantObj.avatar:'';img.src=(avatar!==''&&Aicb.common.isValidURL(avatar))?avatar:defAvatar;if(node){div.append(img);node.prepend(div)}}else if(data.type==='admin'){if(data.hasOwnProperty("avatar")&&Aicb.common.isValidURL(data.avatar)){avatar=data.avatar}else{avatar=getAvatar(data.uid||'')}
defAvatar=mrAssistantObj.plugin_url+'assets/images/boy.svg';img.src=avatar;if(node){div.append(img);node.prepend(div)}}
let cbMessages=document.getElementById("cbMessages");if(!cbMessages){return}
if(nodeType==='prepend'){cbMessages.prepend(node);let scroll=document.getElementById('cbMessages');if(scroll){scroll.scrollIntoView({behavior:'smooth',block:'start'})}}else{cbMessages.appendChild(node);let scroll2=document.getElementById('cbMessages');if(scroll2){scroll2.scrollIntoView({behavior:'smooth',block:'end'})}}
Aicb.common.image(imgId,avatar,defAvatar,"imgSrc");Aicb.common.typeLoader(!1)}
function templateDark(key,data,settings,nodeType='append',clientId){let client=document.getElementById('client_id');if(client&&client.value!==clientId){return''}
const node=document.getElementById('mr'+key);if(!node){if(data.type==='slider'){return chatBotReturn(key,data.data,settings,nodeType)}if(data.type==='tags'){return tagsListTemplate(key,data.data,settings,nodeType)}else{return setMessage(key,data,settings,nodeType)}}}
function tagsListTemplate(key,data,settings,nodeType){const container=document.getElementById('cbMessages');var div=document.getElementById('mr'+key);if(!container||div)return'';let box=document.createElement('DIV');box.setAttribute('id','mr'+key);box.setAttribute('class','mr-categories');if(data instanceof Object&&Object.keys(data).length>0){Object.keys(data).forEach(function(ele){let term=data[ele];const div=document.createElement('DIV');div.setAttribute('class','tag fade theme');div.setAttribute('data-id',ele);div.setAttribute('data-name',term.name);div.setAttribute('data-slug',term.slug);div.addEventListener('click',Aicb.searchEngine.tagManagerEvent,!0);div.innerText=term.name;box.append(div)})}
if(nodeType==='prepend'){container.prepend(box)}else{container.appendChild(box)}
let cursor=(nodeType==='prepend')?'start':'end';let scroll=document.getElementById('cbMessages');if(scroll)scroll.scrollIntoView({behavior:'smooth',block:cursor});Aicb.common.typeLoader(!1)}
function setAvatar(key,agents){let person='',ava='',count=0,asset=mrAssistantObj.plugin_url+'assets';let def=asset+'/images/boy.svg';let mrDef=asset+'/images/mr-assistant.svg';let mrAvatar=mrAssistantObj.hasOwnProperty("avatar")?mrAssistantObj.avatar:mrDef;let mrBotName=Aicb.translate.get("Mr. Assistant",'_txcwh8');for(let k in agents){if(agents.hasOwnProperty(k)){let obj=agents[k];let imgId=Math.floor((Math.random()*8299432343)+84);let avatar=(obj.avatar)?obj.avatar:def;if("mr-assistant"===k&&obj.status==='active'){count++;let mrName=mrAssistantObj.name||mrBotName;person+=mrName.split(/(\s).+\s/).join("")+', ';try{let img=new Image();img.src=mrAvatar;ava+='<div class="mr-avatar theme" id="mrImg-'+imgId+'"><img width="45" src="'+mrAvatar+'"/></div>'}catch(e){ava+='<div class="mr-avatar theme" id="mrImg-'+imgId+'"><img width="45" src="'+mrDef+'"/></div>'}
Aicb.common.image(imgId,mrAvatar,mrDef,"img",45)}else if(obj.type==="person"&&obj.status==='active'){count++;person+=obj.name||""+', ';let avatar2=(obj.hasOwnProperty('avatar')&&Aicb.common.isValidURL(obj.avatar))?obj.avatar:def;try{let img=new Image();img.src=avatar2;ava+='<div class="mr-avatar theme" id="mrImg-'+imgId+'"><img width="45" src="'+avatar2+'"/></div>'}catch(e){ava+='<div class="mr-avatar theme" id="mrImg-'+imgId+'"><img width="45" src="'+def+'"/></div>'}
Aicb.common.image(imgId,avatar2,def,"img",45)}}}
let chat=Aicb.translate.get('Chat With','_txcwh1');if(count===0){chat=Aicb.translate.get("Chat With",'_txcwh6');person=mrBotName;if(agents.hasOwnProperty('mr-assistant')){if(agents["mr-assistant"].status&&agents["mr-assistant"].status==="pulse"){chat=Aicb.translate.get("Hello there!",'_txcwh9');person=Aicb.translate.get("I'm Mr. Assistant",'_txcwh10')}}
let imgId1=Math.floor((Math.random()*8294322343)+44);ava='<div class="mr-avatar theme" id="mrImg-'+imgId1+'"><img width="45" src="'+mrAvatar+'"/></div>';Aicb.common.image(imgId1,mrAvatar,mrDef,"img",45);count=1}
let operators=person.replace(/,(\s+)?$/,'');return['<div class="mr-avatars mr-ava-'+count+'">'+ava+'</div >','<h2 class="mr-live-person " title="'+operators+'"><span class="mr-chat-with">'+chat+'</span>'+operators+'</h2>'].join('\n')}
function aMegText(text,type='message-operator',name='',pic=''){var node=document.createElement("DIV");node.setAttribute('class','message '+type);node.innerHTML='<span class="message-content">'+text+'</span>';document.getElementById("cbMessages").appendChild(node);document.getElementById('cbMessages').scrollIntoView({behavior:'smooth',block:'end'});Aicb.common.typeLoader(!1)}
function productCarousel(key,data,target){try{let tmImage=mrAssistantObj.hasOwnProperty("tmImage")?mrAssistantObj.tmImage:"on";let tmTitle=mrAssistantObj.hasOwnProperty("tmTitle")?mrAssistantObj.tmTitle:"on";let tmContent=mrAssistantObj.hasOwnProperty("tmContent")?mrAssistantObj.tmContent:"on";let tmActions=mrAssistantObj.hasOwnProperty("tmActions")?mrAssistantObj.tmActions:"on";let tmBg=mrAssistantObj.hasOwnProperty("tmBg")?mrAssistantObj.tmBg:"";let tmFont=mrAssistantObj.hasOwnProperty("tmFont")?mrAssistantObj.tmFont:"";const container=document.getElementById('cbMessages');var div=document.getElementById('mr'+key);if(!container||div)return'';let box=document.createElement('DIV');box.setAttribute('id','mr'+key);box.setAttribute('class','carousel mr-ani-tb');box.innerHTML=' <div class="mr-load carousel-loader"><span></span><span></span><span></span><span></span></div>';if(target==='prepend'){container.prepend(box)}else{container.appendChild(box)}
var i=1;var data1=Object.values(data);var domain=mrAssistantObj.domain,path2=mrAssistantObj.domain+'/wp-content/uploads/',path=mrAssistantObj.upload_dir?(mrAssistantObj.upload_dir+'/'):path2,def=mrAssistantObj.plugin_url+'assets/images/default.svg';let imageTemplate=function(id,title,attachment,type){let imgId=Math.floor((Math.random()*92992343)+1);if(tmImage==="off"){return}
var wrap=document.createElement('div'),src=!(attachment)?def:(path+attachment);Aicb.common.image(imgId,src,def,"img");return['<div class="product-img" data-action="asyncImg">','<span class="mr-img-'+id+'" id="mrImg-'+imgId+'"><img src="'+src+'"/></span>','<div class="cb-img-hover">','<div class="cb-img-overflow">','<a href="#" class="cb-view-btn cb_view_details theme" data-type="'+type+'" data-pid="'+id+'">View Details</a>','</div>','</div>','</div>'].join('')}
let titleContent=function(id,title,content,type){let ti=(title.length>60)?title.substring(0,60)+'...':title;let cleanText=content.replace(/<\/?[^>]+(>|$)/g,"");let co=(cleanText.length>140)?cleanText.substring(0,140)+'...':cleanText;return[(tmTitle!=="off")?'<h4 class="s-title"><a target="_blank" title="'+title+'" href="'+mrAssistantObj.domain.replace(/\/$/,"")+'?p='+id+'" style="color: '+tmFont+'">'+ti+'</a></h4>':"",(tmContent!=="off")?'<p class="s-text"  style="color: '+tmFont+'">'+co+'</p>':""].join('\n')}
let addToCart=function(id,price1,price_max1,type){if(tmActions==="off"){return}
let price=parseInt(price1),price_max=parseInt(price_max1),min=(price&&price>0)?price:0,max=(price_max&&price_max>0)?price_max:0,prices=system.woo_currency+min;if(min>0&&min===max){prices=system.woo_currency+min}else if(max>0&&min!==max){prices=system.woo_currency+min+' - '+system.woo_currency+max}
if(system.wooBot&&type==='product'){return['<div class="cb-s-footer">','<div class="e-footer theme">','<div class="s-price"><span class="mr_price">'+prices+'</span></div>',system.wooCart?'<div class="s-buy cb_view_details" data-type="'+type+'" data-pid="'+id+'">View Details</div>':'',system.wooCart?'<div class="s-buy mr-buy-now" data-action="buy" data-pid="'+id+'"><a href="'+mrAssistantObj.domain+'?p='+id+'" target="_blank">Buy Now</a></div>':'','</div></div>'].join('')}else{return['<div class="cb-s-footer">','<div class="mr-footer-center theme">','<div class="s-buy cb_view_details" data-type="'+type+'" data-pid="'+id+'">View Details</div>','</div></div>'].join('')}
return''};let setHeight=function(){let iHeight=0;if(tmImage==="on"){iHeight+=140}
if(tmTitle==="on"){iHeight+=90}
if(tmContent==="on"){iHeight+=80}
if(tmActions==="on"){iHeight+=60}
return `style="height: ${iHeight}px"`}
return[`<div class="mr_carousel" ${setHeight()}>`,'<span class="c_btn mr_c_prev theme"><span class="iconify" data-icon="mdi-light:chevron-double-left"></span></span>','<span class="c_btn mr_c_next theme"><span class="iconify" data-icon="mdi-light:chevron-double-right"></span></span>','<ul class="mr_items"">',data.map(post=>([`<li data-action="mr_carousel_item" data-type="${post.post_type}" style="background: ${tmBg}">`,imageTemplate(post.id,post.post_title,post.attachment,post.post_type),titleContent(post.id,post.post_title,post.post_content,post.post_type),addToCart(post.id,post.price,post.price_max,post.post_type),'</li>'].join(''))).join(''),'</ul>','</div>'].join('')}catch(e){if(mrAssistantObj.dev==="on"){console.info(e)}}}
function chatBotReturn(key,label,settings,nodeType){try{system=Object.assign({},settings);if(label===undefined||label.length==0)return;return new Promise(function(res,rej){res(productCarousel(key,label,nodeType))}).then(function(result){let box=document.querySelector('#cbMessages #mr'+key);if(box){box.innerHTML='';box.innerHTML+=result}}).then(function(){Aicb.carousel.execute();let cursor=(nodeType==='prepend')?'start':'end';let scroll=document.getElementById('cbMessages');if(scroll)scroll.scrollIntoView({behavior:'smooth',block:cursor})}).then(function(){var cb_view_details=document.querySelectorAll('.cb_view_details');if(cb_view_details){cb_view_details.forEach(ele=>{ele.addEventListener('click',Aicb.eCommerce.view_details,!0)})}
Aicb.common.typeLoader(!1)})}catch(e){if(mrAssistantObj.dev==="on"){console.info(e)}}}
function knowledgeBase(l){var aSet=async()=>{return await new Promise(res=>{res(aMegText(l[0].doc.answer))}).then(function(){if(firebase.auth().currentUser!==null){Aicb.common.saveLocalStroage(firebase.auth().currentUser.uid,'cbMessages')}})}
return aSet()}
function star_rating(rating=0){let percentage=(parseFloat(rating)/5)*100;return[`<div class="rating">`,`<div class="rating-upper" style="width: ${parseInt(percentage)}%">`,`<span></span><span></span><span></span><span></span><span></span>`,`</div>`,`<div class="rating-lower">`,`<span></span><span></span><span></span><span></span><span></span>`,`</div>`,`</div>`].join("\n")}
function singlePostViewTemplate(type,data){try{let stock=function(){if(type==="product"){return(data.stock_status==="outofstock")?"OUT OF STOCK":"IN STOCK"}
return""}
let sku=function(){if(type==="product"&&data.sku!==""){return `<h5 class="att_name">SKU: ${data.sku}</h5>`}
return""}
let review=function(){if(type!=="product"){return""}
if(data.average_rating!==""&&data.review_count>0){return `<div class="cart-rating"> ${star_rating(data.average_rating)} <span>${data.review_count} Reviews</span></div>`}
return""}
let attributes=function(){if(type!=="product"){return""}
if(data.attributes&&Object.keys(data.attributes).length>0){let att_html="";Object.keys(data.attributes).forEach(function(ele){let row=data.attributes[ele];att_html+=`<h5 class="att_name">${row.name}</h5>`;att_html+=`<div class="att_val"><span>${row.value.replace(/\|/gi, "</span><span>")}</span></div>`});return att_html}}
let currency=system.woo_currency||'$';let priceVal=data.hasOwnProperty('price')?data.price:0;let price='<div class="price">'+priceVal+'</div>';let ti=data.post_title;let ti2=(ti.length>50)?ti.substring(0,50)+'...':ti;let cleanText=data.post_content.replace(/\[.*?\]/g,"");let cart=function(){let inStock=(data.stock_status!=="instock")?"outOfStock":"inStock";if(data.product_type==='simple'){return `<div id="addToCart"><div class="mr-add-to-cart theme ${inStock}" data-stock="${inStock}" data-pid="${data.ID}"><span class="iconify" data-icon="fa-solid:cart-plus"></span>&nbsp;&nbsp;ADD TO CART</div></div>`}else{return `<div class="mr-buy-now theme ${inStock} "><a href="${mrAssistantObj.domain}?p=${data.ID}" ${inStock} target="_blank"><span class="iconify" data-icon="fa-solid:cart-plus"></span>&nbsp;&nbsp;Buy Now</a></div>`}};let cls=(type==='product')?"mr-single-product":"mr-single-post";let path=mrAssistantObj.domain+'/wp-content/uploads/';let upload_path=mrAssistantObj.upload_dir?(mrAssistantObj.upload_dir+'/'):path;let def=mrAssistantObj.plugin_url+'assets/images/default.svg';let gallery=function(){if(data.gallery.length>0){let gallery_html=`<ul class="cart-gallery">`;Object.keys(data.gallery).forEach(function(ele){gallery_html+=`<li><img src="${data.gallery[ele]}"></li>`});gallery_html+=`</ul>`;return gallery_html}
return""}
let imageContainer=function(){if(type!=="product"&&!data.attachment){return}
if(data.image!==""||data.attachment!==""){let attImage='<img src="'+(!!data.attachment?data.attachment:def)+'"/>';let image=(data.image)?data.image:attImage;return['<aside class="left-set">',image,gallery(),'</aside>',].join('')}}
Aicb.common.typeLoader(!1);let categories=function(){if(data.categories&&data.categories.length>0){let cat_html=[];data.categories.forEach(function(ele){if(ele.name){cat_html.push(ele.name.toUpperCase())}});return `<p class="cart-cats">${cat_html.join(", ")}</p>`}
return""}
let tags=function(){if(data.tags&&data.tags.length>0){let cat_html=`<h5 class="att_name">Tags: </h5><div class="att_val tags_val">`;data.tags.forEach(function(ele){if(ele.name){cat_html+=`<span>${ele.name}</span>`}});cat_html+=`</div>`;return cat_html}
return""}
return['<div class="single-item cb-shadow-1 '+cls+'" style="display: block">','<div class="close_btn" type="button">X</div>','<section class="pop-cart">','<div class="pop-cart-container">',imageContainer(),'<aside class="right-set">','<p>'+stock()+'</p>',`<div class="name" title="${ti}"><a href="${mrAssistantObj.domain + '?p=' + data.ID}" target="_blank">${ti}</a></div>`,categories(),review(),(type==='product')?price:" ",attributes(),(type==='product')?cart():" ",sku(),tags(),'</aside>','</div>','<div class="description">',(type==='product')?"<h4>Description</h4>":"",'<p>'+cleanText+'</p>','</div>','</section>','</div>'].join('\n')}catch(e){if(mrAssistantObj.dev==="on"){console.info(e)}}}
function menuViewTemplate(type,data){try{let cls=(type==='menuContext')?"mr-single-menu-context":"mr-single-menu",path=mrAssistantObj.domain+'/wp-content/uploads/',upload_path=mrAssistantObj.upload_dir?(mrAssistantObj.upload_dir+'/'):path;if(data.menuAction==='redirectAction'){if(data.actionContext&&data.actionContext!==''){try{if(Aicb.common.isValidURL(data.actionContext)){let url=new URL(data.actionContext);let win=window.open(data.actionContext,'_blank');if(!win||win.closed||typeof win.closed=='undefined'){Aicb.init.popMessage({"title":'Page Suggestion',"content":"Click this button to open this page.","type":'redirect',"button":"Open Page","action":data.actionContext})}else{return win.focus()}}}catch(e){if(mrAssistantObj.dev==="on"){console.info(e)}}}}else if(data.menuAction==='searchAction'){if(data.actionContext&&data.actionContext!==''){Aicb.common.setCookie('mrRobotAutoAction',0,5);Aicb.common.setCookie('mrRobotSession',Aicb.common.generateGUID(),5);return Aicb.controller.bot(data.actionContext,{"cuAction":1,"kbAction":1,"sbAction":1})}}else if(data.menuAction==='kb'){if(data.actionContext&&data.actionContext!==''){return Aicb.controller.bot(data.actionContext,{"cuAction":0,"kbAction":1,"sbAction":0})}}else if(data.menuAction==='help'){const cb_info=document.querySelector('.cb_info');if(cb_info)cb_info.click()}else if(data.menuAction==='menu'){const mr_menus=document.querySelector('.mr_menus');if(mr_menus)mr_menus.click()}else if(data.menuAction==='cart'){const cb_cart=document.querySelector('.cb_cart');if(cb_cart)cb_cart.click()}else if(data.menuAction==='rate'){Aicb.form.feedbackForm('feedback')}
Aicb.common.typeLoader(!1);if(data.hasOwnProperty("menuAction")&&data.menuAction!=="contextAction"){const popup=document.querySelector(".alc_pop_box");const iframe=window.frameElement;if(popup){popup.innerHTML=""}
iframe.style.width="430px";iframe.style.height="100vh";return""}
return['<div class="single-item cb-shadow-1 '+cls+'" style="display: block">','<div class="close_btn" type="button">X</div>','<section class="single-menu-item">','<div class="single-menu-title" title="'+data.menuName+'">'+data.menuName+'</div>','<div class="single-menu-description">'+data.menuContext+'</div>','</section>','</div>'].join('\n')}catch(e){}}
return{loader:loader,set:chatBotReturn,setMeg:aMegText,setAvatar:setAvatar,adminMeg:chatBotReturn,templateDark:templateDark,kno:knowledgeBase,flyTemplate:flyTemplate,chatTemplate:chatTemplate,singleView:singlePostViewTemplate,menuView:menuViewTemplate}})();WPAI_Chat.prototype.form=(function(){"use strict";let signEvent=!1;function signUp(obj={},type="",unique=!1){firebase.auth().onAuthStateChanged(function(currentUser){if(!signEvent){return}
let chatItSelf=localStorage.getItem("mrAssistantChatItself");if(!currentUser&&!chatItSelf){let ann="Anonymous "+Date.now().toString().substr(3);let userData={"name":obj.name||ann,"email":obj.email||"","gdpr":obj.hasOwnProperty("gdpr")?obj.gdpr:0,"isNewUser":!1,"marge":!1,"join":Date.now(),"chatWay":"SignUp","method":"SignUp","type":"liveChat","lastSeen":Date.now(),"status":"active","currentPage":window.location.href,"browser":Aicb.common.getBrowser(),"languages":navigator.languages.join(", "),"language":navigator.languages.join(","),"platform":navigator.platform,};firebase.auth().signInAnonymously().then(snap=>{signEvent=!1;var user=snap.user;if(user){if(type==="survey"){const viewBox=document.querySelectorAll(".signUpForm");if(viewBox)viewBox.forEach(ele=>ele.remove())}
Aicb.conn.notification("Success!! Now you can chat or search...");userData.uid=user.uid;firebase.database().ref("clients").child(user.uid).child("info").set(userData);Aicb.conn._conversationInit();Aicb.conn.setMessages("Hello "+userData.name+"!! Thank you for Sign Up.",user,"bot");Aicb.controller.bot("_preChat",{"cuAction":0,"kbAction":1,"sbAction":0,"botAction":"all_KB"})}}).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}else if(!!chatItSelf){const viewBox2=document.querySelectorAll(".signUpForm");if(viewBox2)viewBox2.forEach(ele=>ele.remove());let errors=document.querySelector(".errors");if(errors){errors.innerHTML="Hello Admin!! Please log in from your admin control panel."}
Aicb.conn.setMessages("Hello Admin!! Please log in from your admin control panel.",currentUser,"bot");Aicb.conn.notification("Hello Admin!! Please log in from your admin control panel.")}})}
function validation(data){let re=/\S+@\S+\.\S+/;if(data.hasOwnProperty("name")&&data.name.length>2){if(data.hasOwnProperty("email")&&re.test(data.email)){let gdpr_check=mrAssistantObj.hasOwnProperty("gdpr_check")?mrAssistantObj.gdpr_check:"off";if(gdpr_check==="on"){if(data.hasOwnProperty("gdpr")&&data.gdpr===1){return"valid"}
return"Please check GDPR Compliance."}
return"valid"}
return"Please add your valid email address."}
return"Name must be minimum 3 letters."}
function mrSignUp(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();signEvent=!0;setTimeout(function(e){var surveyBtn=document.querySelectorAll(".mrSurveyForm .mr-survey-save");if(surveyBtn){surveyBtn.forEach(ele=>{ele.removeEventListener("click",mrSignUp,!1)})}},100);let obj=Aicb.common.getObject(".cbSurveyForm .mrInput");var sanitize=validation(obj);if(sanitize==="valid"){if(firebase.auth().currentUser!==null){let uid=firebase.auth().currentUser.uid;if(uid){firebase.database().ref("clients").child(uid).child("info").update(obj)}}else{if(signEvent){signUp(obj,"survey")}}}else{let errors=document.querySelector(".errors");if(errors){errors.innerHTML=sanitize}
Aicb.conn.notification(sanitize)}
if(firebase.auth().currentUser!==null){const viewBox=document.querySelectorAll(".signUpForm");if(viewBox)viewBox.forEach(ele=>ele.remove())}}
function inputValidation(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let type=e.target.dataset.action;let key=e.target.dataset.key;let val=e.target.value;if(type==="text"){if(e.target.type==="email"){e.target.value=val.replace(/[^\w\s.@]+/g,"");var re=/\S+@\S+\.\S+/;if(re.test(e.target.value)){e.target.style.borderColor="green"}else{e.target.style.borderColor="red"}}else{e.target.value=val.replace(/[^\w\s.&-]+/g,"");if(e.target.value!==""){e.target.style.borderColor="green"}else{e.target.style.borderColor="red"}}}}
function saveFeedback(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();setTimeout(function(e){var surveyBtn=document.querySelectorAll(".mrSurveyForm .mr-survey-save");if(surveyBtn){surveyBtn.forEach(ele=>{ele.removeEventListener("click",saveFeedback,!1)})}},100);let feedback=document.getElementById("feedback-input"),rate=document.querySelector("input[name='rate']:checked"),type=e.target.dataset.type;if(firebase.auth().currentUser!==null){let currentUser=firebase.auth().currentUser;let uid=currentUser.uid;if(uid&&rate.value>0){firebase.database().ref("clients").child(uid).child("info").update({"rate":rate.value,"feedback":feedback.value,"lastSeen":Date.now()}).then(function(){if(type==="feedbackAndSignOut"){const cbMessages=document.querySelector(".cbMessages");if(cbMessages)cbMessages.innerHTML="";firebase.auth().signOut().then(function(){return surveyForm("signUp")})}
Aicb.conn.notification("Thank you for your Feedback.");Aicb.conn.setMessages("Thank you for your Feedback.",currentUser,"bot");const viewBox=document.querySelectorAll(".signUpForm");if(viewBox)viewBox.forEach(ele=>ele.remove())})}else{Aicb.conn.notification("Please Rate Us!!")}}}
function feedbackForm(formType=""){Aicb.common.mrLoader(!0);if(formType==="feedbackAndSignOut"){Aicb.conn.notification("Please Provide your Feedback before leave chat")}else{Aicb.conn.notification("Please Rate Us or Provide Feedback:")}
let img=mrAssistantObj.plugin_url+"assets/images/boy.svg";var survey_form=[`<div class="mrSurveyForm">`,`<button style="display:none" class="sf_close_btn" type="button">X</button>`,`<div class="cbSurveyForm ">`,`<div class="signUpImg theme"><img src="${img}" width="80"/></div>`,`<div class="survey-input survey_text"><span>Please Rate Us or Provide Feedback: </span></div>`,`<div class="rate">`,`<input type="radio" id="mr_star5" name="rate" value="5"/>`,`<label for="mr_star5" title="5 stars">5 stars</label>`,`<input type="radio" id="mr_star4" name="rate" value="4"/>`,`<label for="mr_star4" title="4 stars">4 stars</label>`,`<input type="radio" id="mr_star3" name="rate" value="3"/>`,`<label for="mr_star3" title="3 stars">3 stars</label>`,`<input type="radio" id="mr_star2" name="rate" value="2"/>`,`<label for="mr_star2" title="2 stars">2 stars</label>`,`<input type="radio" id="mr_star1" name="rate" value="1"/>`,`<label for="mr_star1" title="1 star">1 star</label>`,`</div>`,`<textarea id="feedback-input" placeholder="Type Your Feedback..." rows="4" cols="30"></textarea>`,`<input type="button" class="mr-survey-save theme" data-type="${formType}" value="SEND FEEDBACK"/>`,`</div>`,`</div>`].join("");var container=document.querySelector("#cbMessages");var node=document.createElement("DIV");node.setAttribute("class","signUpForm");node.innerHTML=survey_form;const viewBox=document.querySelectorAll(".signUpForm");if(viewBox)viewBox.forEach(ele=>ele.remove());container.appendChild(node);setTimeout(function(e){var surveyBtn=container.querySelectorAll(".mrSurveyForm .mr-survey-save");if(surveyBtn){surveyBtn.forEach(ele=>{ele.addEventListener("click",saveFeedback,!0)})}},2000);Aicb.common.mrLoader(!1)}
function surveyForm(f){Aicb.common.mrLoader(!0);Aicb.conn.notification("Please introduce yourself:");let img=mrAssistantObj.plugin_url+"assets/images/boy.svg";let gdpr_check=mrAssistantObj.hasOwnProperty("gdpr_check")?mrAssistantObj.gdpr_check:"off";let gdpr=(mrAssistantObj.hasOwnProperty("gdpr")&&mrAssistantObj.gdpr!=="")?mrAssistantObj.gdpr:"";let policy=(mrAssistantObj.hasOwnProperty("policy_url")&&Aicb.common.isValidURL(mrAssistantObj.policy_url))?`<a href="${mrAssistantObj.policy_url}" target="_blank">more</a>`:"";let gdprHtml=function(){if(gdpr_check==="on"){return `<label class="mrCheckBox" for="gdpr"><input required type="checkbox" id="gdpr" data-key="gdpr" data-action="checkbox" class="mrInput survey-input"/>${gdpr + policy}</label>`}
return""}
var survey_form=[`<div class="mrSurveyForm">`,`<button style="display:none" class="sf_close_btn" type="button">X</button>`,`<div class="cbSurveyForm ">`,`<div class="signUpImg theme"><img src="${img}" width="80"/></div>`,`<div class="survey-input survey_text"><span>Please introduce yourself:</span></div>`,`<input type="text" data-key="name" data-action="text" class="mrInput survey-input" placeholder="Type Name..."/>`,`<input type="email" data-key="email" data-action="text" class="mrInput survey-input" placeholder="Type Email..."/>`,gdprHtml(),`<div class="errors"></div>`,`<input type="button" class="mr-survey-save theme" value="Start Chat"/>`,`</div>`,`</div>`].join("");var container=document.querySelector("#cbMessages");var node=document.createElement("DIV");node.setAttribute("class","signUpForm");node.innerHTML=survey_form;const viewBox=document.querySelectorAll(".signUpForm");if(viewBox)viewBox.forEach(ele=>ele.remove());container.appendChild(node);setTimeout(function(e){var surveyBtn=container.querySelectorAll(".mrSurveyForm .mr-survey-save");if(surveyBtn){surveyBtn.forEach(ele=>{ele.addEventListener("click",mrSignUp,!0)})}
let validation=node.querySelectorAll(".cbSurveyForm .mrInput");if(validation){validation.forEach(ele=>{ele.addEventListener("input",inputValidation,!0)})}},2000);Aicb.common.mrLoader(!1)}
return{signUp:signUp,surveyForm:surveyForm,feedbackForm:feedbackForm}})();document.addEventListener("readystatechange",event=>{if(event.target.readyState==="complete"){const x=document.getElementsByTagName("BODY")[0].getAttribute("data-action");if(x==="mr-assistant-chat-bot-client"){let chat=new WPAI_Chat();chat.init.execute()}}});})()