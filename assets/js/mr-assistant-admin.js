(function(){'use strict';let Alc__admin=function(){};let Aicb=new Alc__admin();Alc__admin.prototype.common=(function(){"use strict";let input,t0,t1;function sanitize(string){const map={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;',"/":'&#x2F;',};const reg=/[&<>"'/]/ig;return string.replace(reg,(match)=>(map[match]))}
function whiteSpaces(s){let str=s.split(' ').filter(n=>n).join(' ');return sanitize(str)}
function time(t){let d=new Date(t);return d.toLocaleString('en-US',{hour:'numeric',minute:'numeric',hour12:!0})}
function getDateTime(time){let t=new Date(parseInt(time)),monthsList=['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'];let h=function(h){if(t.getHours()>12)return h?t.getHours()-12:' PM';else return h?t.getHours():' AM'};return t.getDate()+' '+monthsList[(t.getMonth()+1)]+' AT '+h(!0)+':'+t.getMinutes()+h(!1)}
function getLocalTime(time){return new Date(parseInt(time)).toLocaleString()||''}
function getTimeDiff(t0,t1){var s,m,h,d,tDiff="";let z=n=>(10>n?'0':'')+n;let diff=t1-t0;if(diff<0){return"0s"};diff=Math.abs(diff);d=Math.floor(diff/86.4e6|0);h=Math.floor(diff/3.6e6|0);if(d>0){tDiff+=d+"d ";h-=(d*24)}
m=Math.floor((diff%3.6e6)/6e4|0);s=Math.floor((diff%6e4)/1e3|0);if(h>0){tDiff+=h+"h "}
if(m>0){tDiff+=m+"m "}
tDiff+=s+"s";return tDiff}
function timeDiff(join,lastSeen,cursor,now=!1){let t1=new Date(join).getTime(),t2=new Date(lastSeen).getTime(),milliseconds=0,time='';if(now)t2=Date.now();if(isNaN(t1)||isNaN(t2))return'';if(t1<t2)milliseconds=t2-t1;else milliseconds=t1-t2;var minutes=Math.floor((milliseconds/1000)/60);var hours=Math.floor(minutes/60);var days=Math.floor(milliseconds/1000/60/(60*24));var date_diff=new Date(milliseconds);if(cursor==='day'){return days}else if(cursor==='hour'){return(date_diff.getHours()>0)?date_diff.getHours():0}else if(cursor==='minute'){return minutes}
return 0}
function getUrlPath(link="",type='path'){try{let url=new URL((link&&link!=='')?link:document.location.href);if(type==='domain')return url.origin;if(type==='path')return url.pathname}catch(e){return link}
return''}
function jsonParse(str){try{if(typeof str!=='undefined'){return JSON.parse(str)}}catch(e){return!1}
return!1}
function timeAgo(t0){if(!t0)return'';var d=new Date(parseInt(t0));var t=new Date();var diffMs=(t-d);var diffDays=Math.floor(diffMs/86400000);var diffHrs=Math.floor((diffMs%86400000)/3600000);var diffMins=Math.round(((diffMs%86400000)%3600000)/60000);if(diffDays>0){return diffDays>1?diffDays+' days ago':diffDays+' day ago'}else if(diffHrs>0){return diffHrs>1?diffHrs+' hours ago ':diffHrs+' hour ago'}else if(diffMins>0){return diffMins>1?diffMins+' mins ago ':diffMins+' min ago'}else{return d.toLocaleString('en-US',{hour:'numeric',minute:'numeric',hour12:!0})}}
function setRangeVal(key,val){let range=document.querySelectorAll('.range_val');if(range){range.forEach(function(ele){if(ele.dataset.key&&ele.dataset.key===key){ele.innerText=(val*100).toString()}})}}
function getObject(target){const group=document.querySelectorAll(target);let result={};for(var i=0;i<group.length;i++){var type=group[i].dataset.action;var key=group[i].dataset.key;if(type==='text'){result[key]=group[i].value}
if(type==='checkbox'){result[key]=group[i].checked==!0?1:0}
if(type==='select'){result[key]=group[i].options[group[i].selectedIndex].value}
if(type==='radio'){var radio=group[i].querySelector("input[name="+key+"]:checked");result[key]=radio?radio.value:'1'}
if(type==='range'){result[key]=group[i].value;setRangeVal(key,group[i].value)}}
return result}
function setOptionConfig(target,options){if(!options)return;const group=document.querySelectorAll(target);for(var i=0;i<group.length;i++){var type=group[i].dataset.action;var key=group[i].dataset.key;if(type==='text'){group[i].value=options[key]&&options[key]!==''?options[key]:''}
if(type==='checkbox'){if(options[key]&&options[key]===1){group[i].checked=!0}else{group[i].checked=!1}}
if(type==='select'){for(var j=0;j<group[i].options.length;j++){if(group[i].options[j].value===options[key]){group[i].options[j].selected=!0;break}}}
if(type==='radio'){var radio=group[i].querySelectorAll("input");for(var j=0;j<radio.length;j++){if(radio[j].value===options[key]){radio[j].checked=!0;break}}}
if(type==='range'){group[i].value=options[key]&&options[key]!==''?options[key]:10;setRangeVal(key,group[i].value)}
if(type==='dragNDrop'){setDragNDrop(options[key],group[i])}}}
function setCookie(name,value,config={expires:1,path:'/',domain:window.location.hostname,secure:!1}){return Cookies.set(name,value,{expires:config.exp,path:config.path,domain:config.domain,secure:config.secure})}
function getCookie(name,config={expires:1,path:'/',domain:window.location.hostname,secure:!1}){return Cookies.get(name,{expires:config.exp,path:config.path,domain:config.domain,secure:config.secure})}
function loader(type="on"){if(type==="off"){let load=document.querySelectorAll('.mr-loader');if(load){load.forEach(ele=>ele.remove())}
return''}else{const pre=document.createElement('DIV');pre.setAttribute('class','mr-loader');pre.innerHTML="<div></div><div></div>";return pre}}
function getAvatar(name,size){let nam,color,colors=["#184d47","#086972","#a8df65","#ffcd3c","#12cad6","#ffcd3c"];if(name&&name.length>0){var nameArray=name.split(" ")?name.split(" "):name;if(nameArray.length>1){nam=nameArray[0].charAt(0).toUpperCase()+nameArray[1].charAt(0).toUpperCase()}else{nam=name.charAt(0).toUpperCase()}}else{nam='MR'}
nam=nam.replace(/[^A-Za-z0-9]/gi,'');color=colors[Math.floor((Math.random()*colors.length)+0)];return'<span style="background: '+color+'">'+(nam||'MR')+'</span>'}
function mrLoader(target,type=!1){const loader=document.querySelectorAll('.mr-spinner-full');if(loader){loader.forEach(ele=>ele.remove())}
let logo=mrAssistantObj.plugin_url+'assets/images/mr-logo.png';const spinner=document.createElement('DIV');spinner.setAttribute('class','mr-spinner-full');const img=document.createElement('IMG');img.src=logo;img.width=200;spinner.innerHTML='<div class="mr-spinner"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div>';spinner.prepend(img);const ele=document.querySelector(target);if(type&&ele){if(type==='append'){ele.prepend(spinner)}else{ele.innerHTML=spinner.innerHTML}}}
async function image(key,path,fallback,type="bg"){await new Promise(resolve=>{const img=new Image();img.src=path;img.onload=()=>resolve(path);img.onerror=()=>resolve(fallback)}).then(function(img){if(img===path){return}
let imgId=document.getElementById("mrImg-"+key);if(imgId){if(type==="img"){imgId.innerHTML='<img src="'+img+'"/>'}else{imgId.style.backgroundImage='url('+img+')'}}})}
function isset(accessor){try{return typeof accessor!=='undefined'}catch(e){return!1}}
return{time:time,getDateTime:getDateTime,getLocalTime:getLocalTime,getTimeDiff:getTimeDiff,timeDiff:timeDiff,getUrlPath:getUrlPath,jsonParse:jsonParse,timeAgo:timeAgo,whiteSpaces:whiteSpaces,setCookie:setCookie,getCookie:getCookie,loader:loader,setOptionConfig:setOptionConfig,getObject:getObject,getAvatar:getAvatar,mrLoader:mrLoader,image:image,isset:isset}})();Alc__admin.prototype.translate=(function(){"use strict";let pageTx='';let mrTrans={};function getPage(){const container=document.querySelector('.mr-container');let page='';if(container){let ac=container.dataset.action;switch(ac){case "mr-dashboard":page="dashboard";break;case "mr-chatbot-console":page="console";break;case "mr-index-table":page="indexing";break;case "mr-knowledge-base":page="knowledge";break;case "mr-chatbot-settings":page="settings";break;case "mr-chat-history":page="history";break;case "mr-user-profile":page="profile";break;default:page=""}}
return page}
function saveTx(config){const container=document.querySelector('.mr-container');const mrPopBox=document.querySelectorAll('.mrPopBox');if(mrPopBox)mrPopBox.forEach(ele=>ele.remove());let node=document.createElement('DIV');let p=document.createElement('P');p.innerHTML=config.text;let x=document.createElement("TEXTAREA");x.setAttribute("type","text");x.setAttribute("id","inputTx");x.maxLength="5000";x.cols="30";x.rows="4";x.value=config.text;let btn=document.createElement('SPAN');btn.innerText=config.btnText;btn.setAttribute('data-key',config.key);btn.setAttribute('data-page',config.page);btn.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const inp=e.target.parentNode.querySelector('TEXTAREA');if(inp&&inp.value){let key=e.target.dataset.key,page=e.target.dataset.page,filter=Aicb.common.whiteSpaces(inp.value);if(key&&page){firebase.database().ref('translation').child(page).child(key).set(filter)}}
const mrPopBox=document.querySelectorAll('.mrPopBox');if(mrPopBox)mrPopBox.forEach(ele=>ele.remove());execute()},!0)
node.setAttribute('class','mrPopBox');node.append(p);node.append(x);node.append(btn);if(container)container.prepend(node)}
function changeTx(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let config={};config.key=e.target.dataset.key;config.page=getPage();config.text=e.target.innerText;config.btnText='Save';if(config.key!==''&&config.page!==''){return saveTx(config)}}
function onInputChangeTranslate(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let parent=e.target.dataset.parent,key=e.target.dataset.key,value=e.target.value,data={};if(key&&parent&&value){if(value!==''){data.tx2=value;firebase.database().ref('translation').child(parent).child(key).update(data)}}}
function doTranslation(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let property=e.target.dataset.property;const target=document.querySelector('.txBody');target.innerHTML='';if(property){firebase.database().ref('translation').child(property).once('value',function(snap){let val=snap.val();if(val){let data=Object.keys(val);if(data&&target){data.forEach(function(ele){const container=document.createElement('DIV');container.setAttribute('data-property',ele);container.setAttribute('class','s-row border');const label=document.createElement('LABEL');label.setAttribute('for',ele);label.innerHTML=((val[ele].hasOwnProperty("tx1")&&val[ele].tx1!=="")?val[ele].tx1:"...");container.append(label);const input=document.createElement('INPUT');input.setAttribute('id',ele);input.setAttribute('class','mrA_input mr-main__input');input.setAttribute('data-key',ele);input.setAttribute('data-parent',property);input.value=((val[ele].hasOwnProperty("tx2")&&val[ele].tx2!=="")?val[ele].tx2:"...");input.addEventListener('input',onInputChangeTranslate,!0);container.append(input);target.append(container)})}}}).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}}
function settingInit(){firebase.database().ref('translation').once('value',function(snap){let val=snap.val();if(val){let data=Object.keys(val);const target=document.querySelector('.txHeader');target.innerHTML='';if(data&&target){data.forEach(function(ele){const div=document.createElement('DIV');div.innerText=ele;div.setAttribute('data-property',ele);div.setAttribute('class','txRow');div.addEventListener('click',doTranslation,!0);target.append(div)})}}}).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}
function menuTranslate(text,key,mode='menus'){let txText=text;if(!!mrTrans&&mrTrans.hasOwnProperty('menus')){if(key&&mode==='menu'){if(mrTrans.hasOwnProperty(key)){txText=(mrTrans[key]!=='')?mrTrans[key]:text}else{}}}else{firebase.database().ref('translation').once('value',function(snap){let val=snap.val();if(val&&val.hasOwnProperty(mode)){mrTrans=Object.assign({},mrTrans,val);let data=val[mode];if(data.hasOwnProperty(key)){txText=(data[key]!=='')?data[key]:text}else{firebase.database().ref('translation').child('menus').child(key).set(text)}}else{}}).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}
return txText}
function execute(){const mrtx=document.querySelectorAll('.mrtx');if(mrtx){pageTx=getPage();firebase.database().ref('translation').once('value',function(snap){let val=snap.val();if(val&&val.hasOwnProperty(pageTx)){mrTrans=Object.assign({},mrTrans,val);let data=val[pageTx];mrtx.forEach(function(ele){const text=ele.innerHTML,key=ele.dataset.key,mode=ele.dataset.mode;if(key!==''){if(mode==='menu'){if(val.hasOwnProperty('menus')){if(val.menus.hasOwnProperty(key)){ele.innerText=(val.menus[key]!=='')?val.menus[key]:text}else{firebase.database().ref('translation').child('menus').child(key).set(text)}}}else{if(data.hasOwnProperty(key)&&(data[key].hasOwnProperty("tx1")&&data[key].tx1!=="")){ele.innerText=((data[key].hasOwnProperty("tx2")&&data[key].tx2!=="")?data[key].tx2:text)}else{let tx={"tx1":text,"tx2":text}
firebase.database().ref('translation').child(pageTx).child(key).update(tx)}
if(mrAssistantObj.translation&&mrAssistantObj.translation==='on'){if(mode==='page'){ele.style.border='1px solid #ccc';ele.addEventListener('click',changeTx,!0)}}}}})}}).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}}
return{execute:execute,settingInit:settingInit,menuTx:menuTranslate}})();Alc__admin.prototype.carousel=(function(){"use strict";function init(){var carousels=document.querySelectorAll('.mr_carousel');[].forEach.call(carousels,function(carousel){initialize(carousel)})}
function initialize(carousel){var productList=carousel.querySelector('.mr_items');var productListWidth=300;var productListSteps=0;var products=carousel.querySelectorAll('.mr_items li');var productAmount=0;var productAmountVisible=1;var carouselPrev=carousel.querySelector('.mr_c_prev');var carouselNext=carousel.querySelector('.mr_c_next');[].forEach.call(products,function(product){productAmount++;productListWidth+=300;productList.style.width=productListWidth+"px"});carouselNext.onclick=function(){if(productListSteps<productAmount-productAmountVisible){productListSteps++;moveProductList()}};carouselPrev.onclick=function(){if(productListSteps>0){productListSteps--;moveProductList()}};function moveProductList(){productList.style.transform="translateX(-"+300*productListSteps+"px)"}}
return{execute:init}})();Alc__admin.prototype.dashboard=(function(){let settings={},visitorList={};function initializeVisitorChat(event){event.preventDefault();event.stopPropagation();event.stopImmediatePropagation();let guid=event.target.dataset.guid,action=event.target.dataset.action,uid=event.target.dataset.uid;if(guid&&action==='vChatInit'){firebase.database().ref('actions').child('visitorSignUp').child(guid).set({"guid":guid,"lastSync":Date.now(),"status":"pending","user":"admin"}).then(function(){event.target.innerHTML=Aicb.templateDom.loader})}else if(uid&&action==='chatNow'){if(uid.length>20){Aicb.initializer.menuInit('mr-chatbot-console');Aicb.livechat_admin.chatInit(uid,!0)}}}
function loadMore(){let setLoadMore=function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let data=visitorList;let length=Object.keys(data).length;setDashCounter(length,"visitors");let start=parseInt(this.parentNode.dataset.start),end=parseInt(this.parentNode.dataset.end),step=parseInt(this.parentNode.dataset.step),type=this.dataset.type,start1,end1;if(type==='prev'){start1=start-step;end1=start}else{start1=end;end1=end+step}
let start2=(start1>0)?(start1-1):0;let end2=(end1<length)?(end1-1):(length-1);if(end2<=0||start1>=length)return;let sort=Object.entries(data).sort((a,b)=>{if(a[1].lastSeen&&b[1].lastSeen){return b[1].lastSeen-a[1].lastSeen}else{return 0}});let list=sort.slice(start2,end2);const mrClientsList=document.getElementById('mrVisitorsList');if(mrClientsList)mrClientsList.innerHTML='';for(let i=0;list.length>i;i++){if(list[i]){let key=list[i][0];if(data.hasOwnProperty(key)){loadVisitors(key,data[key],'append')}}}
const mrPagination=document.querySelector('.mrPagination');if(mrPagination){mrPagination.dataset.start=start2+1;mrPagination.dataset.end=end2+1;mrPagination.dataset.counter=length}
const mrPagiStatus=document.querySelector('.mrPagiStatus');if(mrPagiStatus)mrPagiStatus.innerHTML='( '+parseInt(start2+1)+' - '+parseInt(end2+1)+' ) / '+length}
firebase.database().ref('visitors/').orderByChild("/lastSeen/").once('value',function(snap){let data=snap.val();let loadData=document.getElementById('mrVisitorsList');let header=document.getElementById('mrVisitorsListHead');if(header)header.innerHTML='<tr class="vcHeader"><th>Name</th><th class="vPage">Current Page</th><th>Platform</th><th>Browser</th><th>Language</th><th>Join</th><th>LastSeen</th><th>Action</th></tr>';if(data){visitorList=Object.assign({},data);let length2=Object.keys(data).length;setDashCounter(length2,"visitors");if(length2>10){const container=document.createElement('DIV');container.setAttribute('class','mrPagination');container.setAttribute('data-start',1);container.setAttribute('data-end',11);container.setAttribute('data-counter',length2);container.setAttribute('data-step',10);const prev=document.createElement('DIV');prev.innerText='Prev';prev.setAttribute('data-type','prev');prev.addEventListener('click',setLoadMore,!0);const text=document.createElement('DIV');text.setAttribute('class','mrPagiStatus')
text.innerHTML='(1 - 11) / '+length2;const next=document.createElement('DIV');next.innerText='Next';next.setAttribute('data-type','next');next.addEventListener('click',setLoadMore,!0);container.append(prev);container.append(text);container.append(next);if(loadData){loadData.parentNode.append(container)}}}else{if(loadData)loadData.innerHTML='No Visitors'}})}
function loadVisitors(key,data,type){var uTable=document.getElementById('mrVisitorsList');if(!uTable)return;var val=data;let ex=document.getElementById('vc'+key);if(ex)ex.remove();let removeCounter=parseInt(settings.removeVisitors)||0;if(settings&&removeCounter>0){if(parseInt(val.lastSeen)){if(Aicb.common.timeDiff(val.lastSeen,Date.now(),'day')>removeCounter){return firebase.database().ref('visitors/').child(key).remove()}}}
let name=val.name,nam=name&&name.length>0?name:'Anonymous';var td=[`<td>${name}</td>`,`<td class="vPage">${val.currentPage}</td>`,`<td>${val.platform}</td>`,`<td>${val.browser}</td>`,`<td>${val.language}</td>`,`<td>${Aicb.common.getDateTime(val.join)}</td>`,`<td>${Aicb.common.timeAgo(val.lastSeen)}</td>`].join('');const tr=document.createElement('TR');tr.setAttribute('id','vc'+key);tr.innerHTML=td;let btn=document.createElement('SPAN');btn.setAttribute('data-badge','visitorChat');btn.setAttribute('id','btn'+key);btn.setAttribute('data-guid',val.guid);btn.setAttribute('data-uid',val.uid||'');btn.addEventListener('click',initializeVisitorChat,!0);if(val.vChat&&val.vChat==='initialized'){btn.setAttribute('class','mr_base_action vChat btn-green');btn.setAttribute('data-action','chatNow');btn.innerText='Chat Now'}else{btn.setAttribute('class','mr_base_action vChat');btn.setAttribute('data-action','vChatInit');btn.innerText='Try Chat'}
const td2=document.createElement('TD');td2.append(btn);tr.append(td2);if(!uTable)return;if(type==='append'){uTable.append(tr)}else{uTable.prepend(tr)}}
function isDashboard(){const page=document.querySelector('.mr-container');if(page&&page.dataset.action==='mr-dashboard'){return!0}
return!1}
function clientsList(user){if(user){let loadFromSnap=function(snap){if(isDashboard()){if(snap.key&&snap.val()){loadVisitors(snap.key,snap.val(),'prepend')}}};firebase.database().ref('visitors/').orderByChild("/lastSeen/").limitToLast(10).on('child_added',loadFromSnap);firebase.database().ref('visitors/').orderByChild("/lastSeen/").limitToLast(10).on('child_changed',loadFromSnap);loadMore();setTimeout(()=>Aicb.common.mrLoader('body',!1),1500)}}
function documentation(){firebase.database().ref('clients').on('value',function(snap){if(!isDashboard())return;let val=snap.val();if(val){let length=Object.keys(val).length;setDashCounter(length,"clients")}});firebase.database().ref('training').on('value',function(snap){if(!isDashboard())return;let val=snap.val();if(val){let length=Object.keys(val).length;setDashCounter(length,"issues")}});firebase.database().ref('users').on('value',function(snap){if(!isDashboard())return;let val=snap.val();if(val){let length=Object.keys(val).length;setDashCounter(length,"operators")}});const train=document.getElementById('train-me');if(train){train.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const menu=document.querySelectorAll('.mr-menu ul li');if(menu){menu.forEach(ele2=>ele2.classList.remove('menu-active'));menu.forEach(function(ele){let inset=ele.dataset.inset;if(inset==='mr-knowledge-base'){ele.click()}})}},!0)}}
function setDashCounter(counter,type=""){const node=document.getElementById("desh_"+type);if(node&&node.dataset.type===type){node.innerText=counter}}
function execute(){firebase.auth().onAuthStateChanged(function(user){if(user){firebase.database().ref('actions').child("onlineVisitors").update({"lastSync":Date.now(),"status":'Find Visitors'});settings=Object.assign({},settings,Aicb.common.jsonParse(Aicb.common.getCookie('mrAssistantSettings')));clientsList(user);documentation();const mrSync=document.querySelector('.mrSync');if(mrSync){mrSync.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let action=mrSync.dataset.action;if(action!=='sync'){mrSync.dataset.action='sync';const html=mrSync.innerHTML;mrSync.innerHTML=Aicb.templateDom.loader;firebase.database().ref('actions').child("onlineVisitors").update({"lastSync":Date.now(),"status":'Find Visitors',"unSeen":0});setTimeout(function(e){mrSync.dataset.action='ready';mrSync.innerHTML=html},10000)}},!0)}
Aicb.translate.execute()}})}
return{execute:execute,coreAction:initializeVisitorChat}})();Alc__admin.prototype.chat_history=(function(){let clientData={};function coreAction(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let action=e.target.dataset.action,chatId=e.target.dataset.key;if(!chatId)return;if(action==='history'){if(chatId.length>20){Aicb.initializer.menuInit('mr-chatbot-console');Aicb.livechat_admin.chatInit(chatId,!0)}}else if(action==='delete'){if(chatId.length>20){let confirm2=confirm("Want to delete?");if(confirm2){Aicb.livechat_admin.deleteClient(chatId);const cl=document.getElementById('cl'+chatId);if(cl)cl.remove()}}}}
function loadMore(){function setLoadMore(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let data=clientData;let length=Object.keys(data).length;let start=parseInt(this.parentNode.dataset.start),end=parseInt(this.parentNode.dataset.end),step=parseInt(this.parentNode.dataset.step),type=this.dataset.type,start1,end1;if(type==='prev'){start1=start-step;end1=start}else{start1=end;end1=end+step}
let start2=(start1>0)?(start1-1):0;let end2=(end1<length)?(end1-1):(length-1);if(end2<=0||start1>=length)return;let sort=Object.entries(data).sort((a,b)=>{if(a[1].info.lastSeen&&b[1].info.lastSeen)
return b[1].info.lastSeen-a[1].info.lastSeen});let list=sort.slice(start2,end2);const mrClientsList=document.getElementById('mrClientsList');if(mrClientsList)mrClientsList.innerHTML='';for(let i=0;list.length>i;i++){if(list[i]){let key=list[i][0];if(data.hasOwnProperty(key)){loadClients(key,data[key],'append')}}}
const mrPagination=document.querySelector('.mrPagination');if(mrPagination){mrPagination.dataset.start=start2+1;mrPagination.dataset.end=end2+1;mrPagination.dataset.counter=length}
const mrPagiStatus=document.querySelector('.mrPagiStatus');if(mrPagiStatus)mrPagiStatus.innerHTML='( '+parseInt(start2+1)+' - '+parseInt(end2+1)+' ) / '+length}
firebase.database().ref('clients/').orderByChild("/info/lastSeen/").once('value',function(snap){let data=snap.val();let loadData=document.getElementById('mrClientsList');let header=document.getElementById('mrClientsListHead');if(header)header.innerHTML='<tr class="vcHeader"><th>Name</th><th>Email</th><th>Browser</th><th>Language</th><th>Join</th><th>Last Seen</th><th>Chat Time</th><th>Status</th><th>Action</th></tr>';if(data){clientData=Object.assign({},data);let length2=Object.keys(data).length;if(length2>2){const container=document.createElement('DIV');container.setAttribute('class','mrPagination');container.setAttribute('data-start',1);container.setAttribute('data-end',11);container.setAttribute('data-counter',length2);container.setAttribute('data-step',10);const prev=document.createElement('DIV');prev.innerText='Prev';prev.setAttribute('data-type','prev');prev.addEventListener('click',setLoadMore,!0);const text=document.createElement('DIV');text.setAttribute('class','mrPagiStatus')
text.innerHTML='(1 - 11) / '+length2;const next=document.createElement('DIV');next.innerText='Next';next.setAttribute('data-type','next');next.addEventListener('click',setLoadMore,!0);container.append(prev);container.append(text);container.append(next);if(loadData){loadData.parentNode.append(container)}}}else{if(loadData)loadData.innerHTML='No Client'}})}
function loadClients(key,data,type){var uTable=document.getElementById('mrClientsList');if(!data.info)return;var val=data.info;if(!val)return;let ex=document.getElementById('cList'+key);if(ex)ex.remove();var td=[`<td>${val.name || 'Anonymous'}</td>`,`<td>${val.email || 'No Email'}</td>`,`<td>${val.browser || 'Unknown'}</td>`,`<td>${val.language || 'Unknown'}</td>`,`<td>${Aicb.common.getLocalTime(val.join)}</td>`,`<td>${Aicb.common.timeAgo(val.lastSeen)}</td>`,`<td>${Aicb.common.getTimeDiff(val.join, val.lastSeen, true)}</td>`,`<td>${(val.status === 'active') ? 'Active' : 'Ended'}</td>`].join('');const tr=document.createElement('TR');tr.setAttribute('id','cList'+key);tr.innerHTML=td;const btn1=document.createElement('SPAN');btn1.setAttribute('class','vChat btn-green');btn1.innerText='History';btn1.setAttribute('data-action','history');btn1.setAttribute('data-key',key);btn1.addEventListener('click',coreAction,!0);const btn2=document.createElement('SPAN');btn2.setAttribute('class','vChat');btn2.innerText='Delete';btn2.setAttribute('data-action','delete');btn2.setAttribute('data-key',key);btn2.addEventListener('click',coreAction,!0);const box=document.createElement('TD');box.append(btn1);box.append(btn2);tr.append(box);if(type==='append'){uTable.append(tr)}else{uTable.prepend(tr)}}
function execute(){let loadFromSnap=function(snap){if(snap.key&&snap.val()){const page=document.querySelector('.mr-container');if(page&&page.dataset.action==='mr-chat-history'){loadClients(snap.key,snap.val(),'prepend')}}}
firebase.database().ref('clients/').orderByChild("/info/lastSeen/").limitToLast(10).on('child_added',loadFromSnap);firebase.database().ref('clients/').orderByChild("/info/lastSeen/").limitToLast(10).on('child_changed',loadFromSnap);loadMore();Aicb.translate.execute();Aicb.common.mrLoader('body',!1)}
return{execute:execute,coreAction:coreAction,}})();Alc__admin.prototype.livechat_admin=(function(){"use strict";let timeout,timeout2,timeout3=null;let loadMoreMessagesClosures=null;let clientList,lastSync=Date.now(),settings,joinChat={};function getUserName(){return firebase.auth().currentUser.displayName||'Admin'}
function getClientId(){let client=document.getElementById('client_id');if(client&&client.value!==''){return client.value}
return''}
function getUserId(){return firebase.auth().currentUser&&firebase.auth().currentUser.uid}
function chatPrimaryMenus(id){const chatInfos=document.querySelectorAll('.mr-chat-info-menu h2');if(chatInfos){chatInfos.forEach(function(ele){ele.addEventListener('click',function(e){let action=ele.dataset.action;chatInfos.forEach(ele2=>ele2.classList.remove('menu-active'));ele.classList.add('menu-active');const boxes=document.querySelectorAll('.mr-info-boxes');if(boxes){boxes.forEach(ele3=>{let action2=ele3.dataset.action;if(action===action2){ele3.classList.remove('mr-hide')}else{ele3.classList.add('mr-hide')}
const all=document.querySelector('.allActionsView');if(all)all.classList.add('mr-hide')})}})})}}
function mrActionRequest(messageId){messageId=getClientId();if(messageId==='')return;const btn=document.querySelectorAll('.mr_action_btn');if(btn){btn.forEach(function(ele){ele.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let data={};let type=e.target.dataset.type,action=e.target.dataset.action;if(type==='search'){let url=document.getElementById('redirect_input');let radioCheck=document.querySelector('input[name="chatConsoleAction"]:checked');if(!radioCheck){return Aicb.initializer.popMessage('You Need to choose an Action','OK')}else{let radio=radioCheck.value;if(url.value!==''){action=url.value;data.actionName=action;data.subAction=radio;url.value=''}else{return}}}
if(type!==''&&action!==''){data.actionType=type;data.actionName=action;data.time=Date.now();data.status='pending';if(joinChat.join==='ok'){saveAdminMessage(getUserName()+" has suggested","bot");firebase.database().ref('clients').child(getClientId()).child('actions').push(data)}else{Aicb.initializer.popMessage('You Need to Join chat.','OK')}}},!0)})}
firebase.database().ref('clients').child(getClientId()).child('actions').on('value',function(snap){if(!messageState(getClientId()))return;let val=snap.val();const table=document.querySelectorAll('.mr_action_table');if(table){table.forEach(function(tab){let type=tab.dataset.type;if(!type)return;const th=document.createElement('TR');tab.innerHTML='';th.innerHTML='<td>Time</td><td>Action</td><td>status</td>';tab.appendChild(th);if(val&&Object.entries(val).length>0){for(let key in val){if(!val.hasOwnProperty(key))continue;let obj=val[key];if(obj.hasOwnProperty('actionType')){if(obj.actionType===type){let dom=function(data){const tr=document.createElement('TR');tr.innerHTML='<td>'+Aicb.common.time(data.time)+'</td><td>'+data.actionName+'</td><td>'+data.status+'</td>';tab.appendChild(tr)};dom(obj)}
if(type==='allActions'){let dom2=function(data){const tr2=document.createElement('TR');tr2.innerHTML='<td>'+Aicb.common.time(data.time)+'</td><td>'+data.actionName+'</td><td>'+data.status+'</td>';tab.appendChild(tr2)};dom2(obj)}}}}else{tab.innerHTML=''}})}});const allActionsBtn=document.querySelector('.allActionsBtn');if(allActionsBtn){allActionsBtn.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const boxes=document.querySelectorAll('.mr-info-boxes');if(boxes){boxes.forEach(ele2=>{let ac=ele2.dataset.action;if(ac==='chatInfo')ele2.classList.add('mr-hide');if(ac==='chatAction')ele2.classList.add('mr-hide');if(ac==='allActionsView')ele2.classList.remove('mr-hide')})}},!0)}}
function star_rating(rating=0,type=""){let percentage=(parseFloat(rating)/5)*100;return[`<div class="rating_dom"><div class="rating">`,`<div class="rating-upper" style="width: ${parseInt(percentage)}%">`,`<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>`,`</div>`,`<div class="rating-lower">`,`<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>`,`</div>`,`</div></div>`,`<p>${ rating + ((rating === "1") ? ' star' : ' stars') + ' rating'}<p>`].join("\n")}
function mrMoreInfo(data){const ul=document.querySelector('#mr_info');ul.innerHTML='';let dom=function(key,value,cls=''){const li=document.createElement('LI');li.innerHTML='<label>'+key+'</label><div class="'+cls+'">'+value+'</div>';ul.appendChild(li)};if(data.join)dom('Chat Time:',Aicb.common.getTimeDiff(data.join,data.lastSeen));if(data.join)dom('Join Chat:',Aicb.common.getDateTime(data.join));if(data.lastSeen)dom('Last Seen:',Aicb.common.getDateTime(data.lastSeen));if(data.currentPage)dom('Browsing:','...'+Aicb.common.getUrlPath(data.currentPage,'path'));if(data.lastMessage)dom('Message:',data.lastMessage);if(data.method)dom('Chat Method:',data.method);if(data.domain)dom('Domain:',data.domain);if(data.status)dom('Status:',data.status);if(data.rate)dom('Rating:',star_rating(data.rate));if(data.feedback)dom('Feedback:',data.feedback,'feedbackBox')}
function chatMenuInit(messageId){messageId=getClientId();if(messageId==='')return;let callback=function(snap){if(!messageState(messageId))return;const items=document.querySelectorAll('.mr_menu_item');let settings=snap.val();const menus=document.getElementById('mr-more-action');if(menus){menus.innerHTML='';if(settings){let initMenu=function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();if(joinChat.join==='ok'){var key=e.target.dataset.type;var action=e.target.dataset.action;let data={};data[key]=action;let publicAction={"actionType":action,"status":"pending","time":Date.now()};if(key==='status'){publicAction.actionName="botStatus";firebase.database().ref('clients').child(messageId).child('actions').push(publicAction)}else if(key==='uEndChat'){publicAction.actionName="endChat";firebase.database().ref('clients').child(messageId).child('actions').push(publicAction)}else{firebase.database().ref('clients').child(messageId).child('settings').update(data)}}else{Aicb.initializer.popMessage('You Need to Join chat.','OK')}};let getDom=function(key,val){let text={"mrSupport":"Mr Assistant","cbSupport":"Chatbot support","kbSupport":"Knowledge Base","sbSupport":"Sitebot support","scSupport":"Custom Actions","block":"Block User","archive":"Archive Chat","uEndChat":"End Chat","status":"Bot Status",};let result={"on":"off","off":"on","block":"unblock","unblock":"block","archive":"unarchived","unarchived":"archive","start":"end","end":"start","pulse":"active","active":"pulse",};let li=document.createElement('LI');let label=document.createElement('LABEL');label.innerHTML=text[key];let span=document.createElement('SPAN');span.addEventListener('click',initMenu,!0);span.setAttribute('class','mr_menu_item mr-off2 '+result[val]);span.setAttribute('data-type',key);span.setAttribute('data-action',result[val]);span.innerHTML=result[val];li.appendChild(label);li.appendChild(span);menus.appendChild(li)};Object.keys(settings).forEach(function(key){if(settings.hasOwnProperty(key)){let val=settings[key];let li=document.createElement('LI');getDom(key,val)}})}}};firebase.database().ref('clients').child(messageId).child('settings').on('value',callback)}
function shortNotes(messageId){messageId=getClientId();if(messageId==='')return;let box=document.querySelector('.shortNoteBox');if(box)box.innerHTML='';let input=document.querySelector('#noteInput'),btn=document.querySelector('#noteInputBtn');if(input&&btn){btn.addEventListener('click',function(e){if(!messageState(getClientId()))return;e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let value=Aicb.common.whiteSpaces(input.value);if(value!==''){firebase.database().ref('clients').child(getClientId()).child('info').child('notes').push({"text":value,"time":Date.now()});input.value=''}},!0)}
let shortNoteDelete=function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const key=e.target.dataset.key,id=e.target.dataset.id;if(joinChat.join==='ok'){firebase.database().ref('clients').child(id).child('info').child('notes').child(key).remove().then(function(snap){const check=document.getElementById('note-'+key);if(check)check.remove()})}else{Aicb.initializer.popMessage('You Need to Join Chat.','OK')}};firebase.database().ref('clients').child(getClientId()).child('info').child('notes').on('child_added',function(snap){if(!messageState(getClientId()))return;let val=snap.val(),node=document.createElement('P');node.setAttribute('id','note-'+snap.key);const check=document.getElementById('note-'+snap.key);if(check)return;const span=document.createElement('SPAN');const btn=document.createElement('SPAN');btn.setAttribute('class','note-btn');btn.setAttribute('data-key',snap.key);btn.setAttribute('data-id',getClientId());btn.innerHTML='⤬';btn.addEventListener('click',shortNoteDelete,!0)
if(box&&val.hasOwnProperty('text')){span.innerHTML=val.text;node.appendChild(span);node.appendChild(btn);box.appendChild(node)}})}
function loadClientInfo(messageId){messageId=getClientId();if(messageId==='')return;let clientId=document.getElementById('client_id');var cbName=document.getElementById('cbName');var cbEmail=document.getElementById('cbEmail');if(messageState(messageId))shortNotes(messageId);let editClintInfo=(e)=>{if(joinChat.join==='ok'){var val=Aicb.common.whiteSpaces(e.target.value);var cid=e.target.dataset.cid;var id=e.target.id;if(cid){var ci=firebase.database().ref('clients').child(cid).child('info');if(id==='cbName'&&val){ci.child('name').set(val);document.getElementById('cb-client-name').innerText=val}
if(id==='cbEmail'&&val){ci.child('email').set(val)}}}else{Aicb.initializer.popMessage('You Need to Join chat.','OK')}}
var callback=function(snap){if(!messageState(messageId))return;if(clientId.value===messageId){var ci=snap.val();let name=(ci.name&&ci.name!=='')?ci.name:'Anonymous';document.getElementById('cb-client-name').innerText=name;cbName.value=name;cbName.setAttribute('data-cid',messageId);cbName.addEventListener('keyup',editClintInfo);cbEmail.value=(ci.email&&ci.email!=='')?ci.email:'';cbEmail.setAttribute('data-cid',getClientId());cbEmail.addEventListener('keyup',editClintInfo);mrMoreInfo(ci)}};firebase.database().ref('clients').child(getClientId()).child('info').on('value',callback)}
function browsingHistory(hId,primaryData){hId=getClientId();if(hId==='')return;const hostory=document.getElementById('cb-clint-browsing');let clientId=document.getElementById('client_id');hostory.innerHTML='';var callback=function(snap){if(!messageState(hId))return;let id='bh'+snap.key,target=document.getElementById(id);if(!target&&clientId.value===hId){let val=snap.val();let page=Aicb.common.time(val.time)+' - '+((val.page.length>35)?val.page.substring(0,35)+"..":val.page);let li=document.createElement('LI');li.setAttribute('class','lr');li.setAttribute('id',id);li.innerHTML=page;hostory.prepend(li);hostory.scrollIntoView({behavior:'smooth',block:'end'})}};firebase.database().ref('browses').child(hId).limitToLast(20).on('child_added',callback)}
function trainingIssue(hId,primaryData){hId=getClientId();if(hId==='')return;const hostory=document.getElementById('cb-clint-error');let clientId=document.getElementById('client_id');hostory.innerHTML='';var callback=function(snap){if(!messageState(hId))return;let id='ti'+snap.key,target=document.getElementById(id);if(!target&&clientId.value===hId){let val=snap.val();let page=Aicb.common.time(val.time)+' - '+((val.qs.length>35)?val.qs.substring(0,35)+"..":val.qs);let li=document.createElement('LI');li.setAttribute('class','lr');li.setAttribute('id',id);li.innerHTML=page;hostory.prepend(li);hostory.scrollIntoView({behavior:'smooth',block:'end'})}};firebase.database().ref('training').orderByChild('uid').equalTo(hId).limitToLast(20).on("child_added",callback)}
function saveAdminMessage(message,type="",avatar=!1){let megs={name:getUserName(),uid:getUserId(),text:message,type:type||'admin',time:Date.now()}
if(avatar){megs.avatar=Aicb.template.getAvatar(megs.uid)}
return firebase.database().ref('livechat').child(getClientId()).push(megs).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}
function sentMessage(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let timeout=null;const messageFormBtn=document.getElementById('mr_admin_send_btn');let clientId=messageFormBtn.dataset.clientId;if(joinChat.join==='ok'){const messageInputBox=document.getElementById('mr_admin_send');var str=Aicb.common.whiteSpaces(messageInputBox.value);if(timeout)clearTimeout(timeout);messageInputBox.value='';timeout=setTimeout(function(){if(str!==''){(async()=>{return saveAdminMessage(str,"admin")})()}},10)}else{Aicb.initializer.popMessage('You Need to Join chat.','OK')}}
function updateChatState(client){client=getClientId();if(client==='')return;const chat_start=document.querySelector('#start_chat');const chat_menu=document.querySelector('#chat_menu');chat_start.dataset.chat=client;chat_start.style.display='block';if(chat_start){let startChat=function(e){client=getClientId();if(client==='')return;e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let clientId=chat_start.dataset.chat;let type=chat_start.dataset.type;if(getUserId()!==""){firebase.database().ref('users').child(getUserId()).once('value',function(snap){let currentUser=snap.val();if(currentUser&&currentUser.access){let data={"name":currentUser.name||'Admin',"type":'person',"avatar":currentUser.hasOwnProperty("avatar")?currentUser.avatar:"",};if(type==='join'){data.join=Date.now();data.status='active';saveAdminMessage(getUserName()+" has joined the chat.","admin",!0);joinChat=Object.assign({},{"join":1});firebase.database().ref('clients').child(client).child('info').child('type').once('value',function(snap){let chatType=snap.val();if(!chatType||chatType!=='archive'){firebase.database().ref('clients').child(client).child('info').child('type').set('liveChat')}})}else{data.ended=Date.now();data.status='ended';saveAdminMessage(getUserName()+" has left the chat.","admin",!0);joinChat=Object.assign({},{"join":0})}
firebase.database().ref('clients').child(client).child('conversation').child(getUserId()).update(data)}})}};chat_start.addEventListener('click',startChat,!0)}
if(chat_menu){chat_menu.classList.remove('mr-hide');const pop=document.querySelector('#mr-more-action');if(pop){pop.classList.remove('mr-hide');chat_menu.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let type=pop.dataset.type;if(type==='close'){pop.style.display='block';pop.dataset.type='open'}else{pop.style.display='none';pop.dataset.type='close'}},!0)}}}
function sentMessageEventListener(client,uid,state){client=getClientId();if(client==='')return;const messageFormBtn=document.getElementById('mr_admin_send_btn');const messageInputBox=document.getElementById('mr_admin_send');if(state==='join'){if(messageInputBox){let keyup=function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let key='which' in e?e.which:e.keyCode;if(key===13||e.key==='Enter'){if(messageFormBtn)messageFormBtn.click()}};messageInputBox.removeEventListener('keyup',keyup,!0);messageInputBox.addEventListener('keyup',keyup,!0)}
if(messageFormBtn){messageFormBtn.dataset.clientId=client;messageFormBtn.removeEventListener('click',sentMessage,!0);messageFormBtn.addEventListener('click',sentMessage,!0)}}else if(state==='leave'){if(messageFormBtn){messageFormBtn.removeEventListener('click',sentMessage,!0);let joinAlert=function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();Aicb.initializer.popMessage('You Need To Join Chat.')};messageFormBtn.removeEventListener('click',joinAlert,!0);messageFormBtn.addEventListener('click',joinAlert,!0)}}}
function userPrivilegesForChat(client,data){client=getClientId();if(client==='')return;let cursor=firebase.database().ref('clients').child(client);const chat_start=document.querySelector('#start_chat');const messageFormBtn=document.getElementById('mr_admin_send_btn');const messageInputBox=document.getElementById('mr_admin_send');let uid=getUserId();if(!uid)return;cursor.child('conversation').child(uid).on('value',function(snap){const chat_start=document.querySelector('#start_chat');let uData=snap.val();if(uData&&uData.status==='active'){chat_start.dataset.type='leave';chat_start.innerText='Leave';chat_start.classList.add('mr-off');joinChat=Object.assign({},{"join":'ok',"clintId":client,"admin":uid})}else{chat_start.dataset.type='join';chat_start.innerText='Join Chat';chat_start.classList.remove('mr-off');joinChat=Object.assign({},{"join":'not',"clintId":client,"admin":uid})}
sentMessageEventListener(client,uid,'join');chat_start.style.display='block';chat_start.dataset.uid=uid;if(timeout){clearTimeout(timeout)}
timeout=setTimeout(function(){updateChatState(client)},100)})}
function messageState(messageId){if(messageId==='')return;const clientId=document.getElementById('client_id');if(clientId){const id=clientId.value;if((Date.now()-lastSync)>60000){lastSync=Date.now();firebase.database().ref('actions').child("onlineVisitors").update({"lastSync":Date.now(),"status":'Chat Console'})}
if(id===messageId)return!0}
return!1}
function chatInit(messageId,cursor=!1){if(!messageId){return}
if(timeout2){clearTimeout(timeout2)}
timeout2=setTimeout(function(){let clientId=document.getElementById('client_id');const _messageDisplay=document.getElementById('admin-messages');var list=document.querySelectorAll('#mrClientsList li');if(list){list.forEach(ele=>ele.classList.remove('chat-active'))}
let mr=document.getElementById('mr-'+messageId);if(mr){mr.classList.add('chat-active')}
joinChat=Object.assign({},{"join":'not',"clintId":messageId});_messageDisplay.innerHTML='';clientId.value=messageId;firebase.database().ref('clients').child(messageId).once('value',function(snap){let data=snap.val();if(data){messageId=getClientId();chatMenuInit(messageId);mrActionRequest(messageId);chatPrimaryMenus(messageId);userPrivilegesForChat(messageId,data);loadClientInfo(messageId,data);browsingHistory(messageId,data);trainingIssue(messageId,data)}}).then(function(){Aicb.common.mrLoader(!0);firebase.database().ref('livechat').child(messageId).limitToLast(20).on('child_added',function(snap){var data=snap.val();if(messageState(messageId)){Aicb.template.templateDark(snap.key,data,'message-visitor',messageId)}});Aicb.common.mrLoader(!1);firebase.database().ref('clients').child(messageId).child('info').child('unread').set('')}).then(function(){if(cursor){var list=document.querySelectorAll('#mrClientsList li');if(list){list.forEach(ele=>ele.classList.remove('chat-active'))}
let mr=document.getElementById('mr-'+messageId);if(mr){mr.classList.add('chat-active')}}
if(timeout3){clearTimeout(timeout3)}
timeout3=setTimeout(function(){loadMoreMessages(messageId)},100)}).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})},100)}
function initializeEventsAndMessages(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const messageId=(e.target.dataset.chat?e.target.dataset.chat:e.target.offsetParent.dataset.chat);return chatInit(messageId)}
function setLoadMoreMessages(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let clientId=document.getElementById('client_id');const mId=clientId.value;let box=document.getElementById('admin-messages');if(!box||mId==='')return;let container=box.parentNode;if(container){container.prepend(Aicb.common.loader("on"))}
firebase.database().ref('livechat').child(mId).once('value',function(snap){let data=snap.val();if(!data){return Aicb.common.loader("off")}
let sort=Object.entries(data);let length=sort.length||0;let loadMore=document.querySelector('.loadMoreMessages');let step=parseInt(loadMore.dataset.step),inset=parseInt(loadMore.dataset.inset),counter=parseInt(loadMore.dataset.counter),limit=inset+step;let end=(length-inset);let start=(end-step)>0?(end-step):0;let list=sort.slice(start,end);for(let i=list.length;i>=0;i--){if(list[i]){let key=list[i][0];if(data.hasOwnProperty(key)){Aicb.template.templateDark(key,data[key],'prepend',mId)}}}
loadMore.dataset.inset=limit;loadMore.style.display=(length>limit)?'block':'none';Aicb.common.loader("off")})}
function loadMoreMessages(mId){if(loadMoreMessagesClosures){clearTimeout(loadMoreMessagesClosures)}
loadMoreMessagesClosures=setTimeout(function(){mId=getClientId();let box=document.getElementById('admin-messages');if(!box||mId==='')return;let container=box.parentNode;if(container){container.prepend(Aicb.common.loader("on"))}
let loadMore=document.querySelectorAll('.loadMoreMessages');if(loadMore){loadMore.forEach(ele=>ele.remove())}
return firebase.database().ref('livechat/').child(mId).once('value',function(snap){let data=snap.val();if(!data){return Aicb.common.loader("off")}
let length=Object.keys(data).length||0;if(box&&length>20){const div=document.createElement('DIV');div.setAttribute('class','loadMoreMessages');div.setAttribute('data-inset',20);div.setAttribute('data-step',20);div.setAttribute('data-counter',length);div.setAttribute('style','display:block');div.setAttribute('id',mId);div.innerHTML='Load More ↻';div.addEventListener('click',setLoadMoreMessages,!0);if(mId===getClientId()){let loadMore2=document.querySelectorAll('.loadMoreMessages');if(loadMore2){loadMore2.forEach(ele=>ele.remove())}
container.prepend(div);Aicb.common.loader("off")}}else{Aicb.common.loader("off")}})},100)}
function loadMore(){firebase.database().ref('clients/').orderByChild("/info/lastSeen/").once('value',function(snap){let data=snap.val();if(!data)return;let length=Object.keys(data).length;if(length>20){let loadMore=document.querySelector('.loadMore');if(loadMore){let preInset=parseInt(loadMore.dataset.inset);loadMore.style.display=(length>preInset)?'block':'none';loadMore.dataset.counter=length;loadMore.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let step=20,inset=parseInt(loadMore.dataset.inset),counter=parseInt(loadMore.dataset.counter),limit=inset+step;firebase.database().ref('clients/').orderByChild("/info/lastSeen/").once('value',function(snap){let data=snap.val();let sort=Object.entries(data).sort((a,b)=>{if(a[1].info.lastSeen&&b[1].info.lastSeen)
return b[1].info.lastSeen-a[1].info.lastSeen});let start=(inset-1);const list=sort.slice(start,(start+step));for(let i=0;list.length>i;i++){if(list[i]){let key=list[i][0];if(data.hasOwnProperty(key)){setClientNode(key,data[key],'append')}}}});loadMore.dataset.inset=limit;loadMore.style.display=(length>limit)?'block':'none'},!0)}}})}
function deleteClient(clientId){firebase.database().ref('clients/').child(clientId).remove();firebase.database().ref('browses/').child(clientId).remove();firebase.database().ref('livechat/').child(clientId).remove();firebase.database().ref('training/').child(clientId).remove()}
function setClientNode(key,data,type){var visitorList=document.getElementById('mrClientsList'),cls=['cb-row'];if(key&&visitorList){let val=data;var vId=document.getElementById('mr-'+key);if(vId){if(vId.classList.contains('chat-active'))cls.push('chat-active')}
var vId2=document.getElementById('mr-'+key);let removeCounter=parseInt(settings.removeChatHistory)||0;if(settings.hasOwnProperty('removeChatHistory')&&removeCounter>0){if(parseInt(val.info.lastSeen)){if(Aicb.common.timeDiff(val.info.lastSeen,Date.now(),'day')>removeCounter){return deleteClient(key)}}}
if(data){var li=document.createElement('li'),chatType=val.info.type;if(val.settings&&val.settings.archive=='archive'){cls.push('archive');cls.push('hide')}else if(chatType==='visitorChat'){cls.push('visitor');cls.push('hide')}else{cls.push('chatting')}
if(val.settings){let status=val.settings;if(status.block==='block'){cls.push('p0')}else if(status.status==='pulse'){cls.push('p1')}}
li.setAttribute('class',cls.join(' '));li.setAttribute('data-chat',key);li.addEventListener('click',initializeEventsAndMessages,!0);li.setAttribute('id','mr-'+key);let name=val.info.name,nam=name&&name.length>0?name:'Anonymous',lastMeg=val.info.lastMessage,lm=lastMeg&&lastMeg.length>0?lastMeg:'',ur=parseInt(val.info.unread),ur2=ur>99?'99':ur,unread=(ur&&ur>0)?'<sup class="unRead">'+ur2+'</sup>':'',lastSeenMin=()=>{let lastSeen=parseInt(val.info.lastSeen);if(lastSeen<1||lastSeen>Date.now())return'offline';let miliSeconds=Math.abs(Date.now()-lastSeen);if(!miliSeconds)return'offline';if(3e5>miliSeconds){return'online'}else if(3.6e6>miliSeconds){return'away'}else{return'offline'}},onlineStatus='<sub class="onlineDot '+lastSeenMin()+'">&nbsp;</sub>';li.innerHTML=['<div class="mr-avatar-img">',Aicb.common.getAvatar(val.info.name||'MR.',30),unread,onlineStatus,'</div>','<div class="mr-avatar-name">','<div class="name">'+nam+'</div>','<div class="time" data-time="'+val.info.lastSeen+'">'+Aicb.common.timeAgo(parseInt(val.info.lastSeen))+'</div>','<div class="status"><span class="dot '+lastSeenMin()+'"></span> '+lastSeenMin()+'</div>','<div class="preview">'+lm+'</div>','</div>'].join('\n');if(vId){let time=vId.querySelector('.time');if(time){let oldTime=time.dataset.time;if(oldTime==val.info.lastSeen){vId.className=cls.join(' ');vId.innerHTML=li.innerHTML}else{vId.remove();if(type==='append'){visitorList.append(li)}else{visitorList.prepend(li)}}}}else{if(type==='append'){visitorList.append(li)}else{visitorList.prepend(li)}}}}}
function mobileMenuEvent(){const mobileMenu=document.querySelectorAll('.mClientMenu');if(mobileMenu){mobileMenu.forEach(function(ele){ele.addEventListener('click',function(e){event.preventDefault();event.stopPropagation();event.stopImmediatePropagation();let type=ele.dataset.type;const left=document.querySelector('.left');const right=document.querySelector('.cb-info');if(right&&left){if(type==='clients'){left.style.display=(left.style.display==='block')?'none':'block';right.style.display='none'}else if(type==='info'){right.style.display=(right.style.display==='block')?'none':'block';left.style.display='none'}}},!0)})}}
function clientsList(user){if(user){const chatMenus=document.querySelectorAll('.mr-chat-menu h2');let ref=firebase.database().ref('clients/').orderByChild("/info/lastSeen/").limitToLast(20);ref.on('child_added',function(snap){let data=snap.val();const page=document.querySelector('.mr-container');if(page&&page.dataset.action==='mr-chatbot-console'){if(data)setClientNode(snap.key,data,'prepend')}});firebase.database().ref('clients/').on('child_changed',function(snap){let data=snap.val();const page=document.querySelector('.mr-container');if(page&&page.dataset.action==='mr-chatbot-console'){if(data)setClientNode(snap.key,data,'prepend')}});loadMore();if(chatMenus){chatMenus.forEach(function(ele){ele.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();chatMenus.forEach(ele2=>ele2.classList.remove('menu-active'));ele.classList.add('menu-active');const list=document.querySelectorAll('#mrClientsList li');if(list){let action=ele.dataset.action;list.forEach(function(ele2){ele2.classList.add('hide');if(action==='archiveChat'){if(ele2.classList.contains('archive')){ele2.classList.remove('hide')}}else if(action==='visitorsChat'){if(ele2.classList.contains('visitor')){ele2.classList.remove('hide')}}else if(action==='liveChat'){if(ele2.classList.contains('chatting')){ele2.classList.remove('hide')}}})}})})}
const chatMenus2=document.querySelectorAll('.mr-chat-menu2 h2');if(chatMenus2){chatMenus2.forEach(ele=>{ele.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let action=ele.dataset.action,list=document.getElementById('mrClientsList');if(list){if(action==='listView'){list.classList.remove('grid');list.classList.add('list')}else if(action==='gridView'){list.classList.remove('list');list.classList.add('grid')}else if(action==='sort'){let sort=ele.dataset.sort;if(sort==='asc'){ele.dataset.sort='desc';list.classList.add('asc')}else{ele.dataset.sort='asc';list.classList.remove('asc')}}}},!0)})}}
setTimeout(()=>Aicb.common.mrLoader('body',!1),1500)}
function execute(){let sortKey;firebase.auth().onAuthStateChanged(function(user){settings=Object.assign({},settings,Aicb.common.jsonParse(Aicb.common.getCookie('mrAssistantSettings')));if(user){clientsList(user)}else{clientsList(null)}
mobileMenuEvent()});Aicb.translate.execute();setTimeout(()=>Aicb.common.mrLoader('body',!1),1500)}
return{execute:execute,chatInit:chatInit,deleteClient:deleteClient}})();Alc__admin.prototype.aisb_indexing=(function(){"use strict";let currentIndex,totalRowCount,totalPage,step=20,indexing=!1;let iProcess=!1;function setOptions(data){const target=document.querySelector('.mr_indexing .mr-item');Aicb.common.setOptionConfig('.mr-index-right .mrA_input',data);return setDragNDrop(data.indexings,target,data.post_types)}
function setDragNDrop(option,target,available){Aicb.common.mrLoader('body',!1);Array.prototype.diff=function(a){return this.filter(function(i){return a.indexOf(i)<0})};let pt_av2=['post','page'];let pt_av=available||pt_av2;let pt_se=option||[];let pt_diff=pt_av.diff(pt_se);if(!target||!target.parentNode)return;const box=target.parentNode.querySelector('.mr_drag_drop');const av_box=box.querySelector('.mr_drag_available');av_box.innerHTML='';av_box.addEventListener('dragover',preventDefault,!1);av_box.addEventListener('drop',(e)=>{preventDefault(e);drop(e)},!1);const se_box=box.querySelector('.mr_drag_selected');se_box.innerHTML='';se_box.addEventListener('dragover',preventDefault,!1);se_box.addEventListener('drop',(e)=>{preventDefault(e);drop(e)},!1);let i=1;pt_se.forEach(ele=>{let elem=document.createElement('P');elem.setAttribute('draggable',!0);elem.setAttribute('id',ele+'_'+(i++));elem.setAttribute('data-value',ele);elem.addEventListener('dragstart',drag,!0);elem.addEventListener('drop',drag,!1);elem.textContent=ele;se_box.appendChild(elem)});pt_diff.forEach(ele=>{let elem=document.createElement('P');elem.setAttribute('draggable',!0);elem.setAttribute('id',ele+'_'+(i++));elem.setAttribute('data-value',ele);elem.addEventListener('dragstart',drag,!0);elem.addEventListener('drop',drag,!1);elem.textContent=ele;av_box.appendChild(elem)});function preventDefault(e){e.preventDefault()}
function drag(e){e.dataTransfer.setData("mr_temp_index",e.target.id)}
function drop(e){var de=document.getElementById(e.dataTransfer.getData("mr_temp_index"));var tar=e.target;if(e.target.parentNode.nodeName!="P"){if((tar.nodeName=="DIV")||(tar.firstChild.nodeName=="P"&&de.childNodes.length!=2))
tar.appendChild(de)}}}
function setStatus(count=0,txt=''){const status_box=document.querySelector('.indexing_status');if(txt===''){txt='<p>Please wait until finish!! It might take some time.</p>'}
let meg='<p>processing....</p>';if(count>0){meg='<p>'+count+'/'+totalRowCount+' completed</p>'}
if(status_box){status_box.innerHTML=txt+meg}}
function asyncRequest(row){let config={url:mrAssistantObj.plugin_url+'mr-postman.php',data:{action:'mr_bot_install',mr_api:'mr_do_indexing',requestData:JSON.stringify({"page":row})},method:'POST',timeout:60000,type:'JSON',headers:{'Accept':'application/json','Content-Type':'application/json'},};return axios(config).then(function(response){if(response.data.status===1){let result=response.data.data.data;iProcess=!0;if(result.hasOwnProperty('page')&&parseInt(result.page)<totalPage){setStatus(parseInt(result.page)*step,'')
return doIndexing(parseInt(result.page)+1)}
if(result.hasOwnProperty('page')&&parseInt(result.page)===totalPage){iProcess=!1;setStatus(totalRowCount,'');setTimeout(function(){const status_box2=document.querySelector('.indexing_status');status_box2.innerHTML="<h2>Successfully Completed!!</h2>"},1000)}}}).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}
function doIndexing(row){indexing=!1;if(totalPage>=row){currentIndex=row;return asyncRequest(row)}}
function mrSaveActions(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();if(iProcess){Aicb.initializer.popMessage("Please wait until finish!! It might take some time.");return}
indexing=!0;Aicb.common.mrLoader('.mr-container','append');const group=document.querySelectorAll('.mr_indexing .mr-item');let result={};for(let i=0;i<group.length;i++){const type=group[i].dataset.action;const key=group[i].dataset.key;if(type==='dragNDrop'){let drops=[]
const drags=group[i].querySelectorAll(".mr_drag_selected p");drags.forEach(ele=>{drops.push(ele.dataset.value)});result[key]=drops}}
let allow=Aicb.common.getObject('.mr-index-right .mrA_input');result=Object.assign({},result,allow);setStatus(0,'')
sendRequest(result)}
function sendRequest(data,type='set'){let config={url:mrAssistantObj.plugin_url+'mr-postman.php',data:{action:'mr_bot_install',mr_api:type==='get'?'mr_get_indexing':'mr_set_indexing',requestData:JSON.stringify(data)},method:'POST',timeout:30000,type:'JSON',headers:{'Accept':'application/json','Content-Type':'application/json'},};return axios(config).then(function(response){if(response.data.status===1){setOptions(response.data.data);return response.data.data}else{throw 'Something was wrong! please try again.'}}).then(function(result){if(result.hasOwnProperty('row_count')&&result.row_count>0){totalRowCount=result.row_count;totalPage=Math.ceil(result.row_count/step);if(indexing&&totalPage>0){doIndexing(1)}}}).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}
function execute(){sendRequest({},'get');const mr_save=document.querySelector("#mr-save-action-btn");if(mr_save)mr_save.addEventListener('click',mrSaveActions,!0);Aicb.translate.execute()}
return{execute:execute}})();Alc__admin.prototype.userProfile=(function(){let usersList={};function coreAction(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();var key=e.target.dataset.key,action=e.target.dataset.action;if(action==='block'){if(confirm("Are you Sure?")){if(key!==''){firebase.database().ref('users/').child(key).once('value',function(snap){let val=snap.val();if(!!val&&val.hasOwnProperty('access')){let access=val.access;firebase.database().ref('users/').child(key).update({"access":!access})}})}}}}
function loadMore(){function setLoadMore(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let data=usersList;let length=Object.keys(data).length;let start=parseInt(this.parentNode.dataset.start),end=parseInt(this.parentNode.dataset.end),step=parseInt(this.parentNode.dataset.step),type=this.dataset.type,start1,end1;if(type==='prev'){start1=start-step;end1=start}else{start1=end;end1=end+step}
let start2=(start1>0)?(start1-1):0;let end2=(end1<length)?(end1-1):(length-1);if(end2<=0||start1>=length)return;let sort=Object.entries(data).sort((a,b)=>{if(a[1].lastSignInTime&&b[1].lastSignInTime)
return b[1].lastSignInTime-a[1].lastSignInTime});let list=sort.slice(start2,end2);const mrClientsList=document.getElementById('mrUsersList');if(mrClientsList)mrClientsList.innerHTML='';for(let i=0;list.length>i;i++){if(list[i]){let key=list[i][0];if(data.hasOwnProperty(key)){loadUsers(key,data[key],'append')}}}
const mrPagination=document.querySelector('.mrPagination');if(mrPagination){mrPagination.dataset.start=start2+1;mrPagination.dataset.end=end2+1;mrPagination.dataset.counter=length}
const mrPagiStatus=document.querySelector('.mrPagiStatus');if(mrPagiStatus)mrPagiStatus.innerHTML='( '+parseInt(start2+1)+' - '+parseInt(end2+1)+' ) / '+length}
firebase.database().ref('users/').orderByChild("/lastSignInTime/").once('value',function(snap){let data=snap.val();let loadData=document.getElementById('mrUsersList');let header=document.getElementById('mrUsersListHead');if(header)header.innerHTML='<tr class="vcHeader"><th>Name</th><th>Email</th><th>Creation Time</th><th>Last SignIn Time</th><th>Action</th></tr>';if(data){usersList=Object.assign({},data);let length2=Object.keys(data).length;if(length2>2){const container=document.createElement('DIV');container.setAttribute('class','mrPagination');container.setAttribute('data-start',1);container.setAttribute('data-end',11);container.setAttribute('data-counter',length2);container.setAttribute('data-step',10);const prev=document.createElement('DIV');prev.innerText='Prev';prev.setAttribute('data-type','prev');prev.addEventListener('click',setLoadMore,!0);const text=document.createElement('DIV');text.setAttribute('class','mrPagiStatus')
text.innerHTML='(1 - 11) / '+length2;const next=document.createElement('DIV');next.innerText='Next';next.setAttribute('data-type','next');next.addEventListener('click',setLoadMore,!0);container.append(prev);container.append(text);container.append(next);if(loadData){loadData.parentNode.append(container)}}}else{if(loadData)loadData.innerHTML='No Client'}})}
function loadUsers(key,data,type){var uTable=document.getElementById('mrUsersList');var val=data;let ex=document.getElementById('us'+key);if(ex)ex.remove();let block=!val.access?'Unblock User':'Block User';let btn='<span class="mr_base_action vChat mrUserDelete" data-key="'+key+'" data-action="block" data-badge="userAction">'+block+'</span>';var td=(i)=>{return['<td>'+val.name+'</td>','<td>'+val.email+'</td>','<td>'+Aicb.common.getLocalTime(val.creationTime)+'</td>','<td>'+Aicb.common.timeAgo(val.lastSignInTime)+'</td>'].join('')};var tr=document.createElement('TR');tr.setAttribute('id','us'+key);tr.innerHTML=td();const btn1=document.createElement('SPAN');btn1.setAttribute('class','vChat btn-green');btn1.innerText=block;btn1.setAttribute('data-action','block');btn1.setAttribute('data-key',key);btn1.addEventListener('click',coreAction,!0);const box=document.createElement('TD');box.append(btn1);tr.append(box);if(type==='append'){uTable.append(tr)}else{uTable.prepend(tr)}}
function profileUpdate(user){const photoUrl=document.getElementById('mrUpdatePhotoUrl'),name=document.getElementById('mrUpdateDisplayName'),email=document.getElementById('mrUpdateUserEmail'),update=document.getElementById('mr_update_user_profile'),updatePass=document.getElementById('mr_update_user_pass');if(user){if(user.uid){firebase.database().ref("users").child(user.uid).once("value",function(snap){let mrUser=snap.val();if(mrUser){if(photoUrl){photoUrl.value=mrUser.avatar||""}
if(name){name.value=mrUser.name||""}
if(email){email.value=user.email||""}}}).then(function(){if(update){update.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();user.updateProfile({displayName:name.value,photoURL:photoUrl.value!==''?photoUrl.value:" "}).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}});firebase.database().ref().child('users').child(user.uid).update({'name':name.value,'avatar':photoUrl.value,}).then(function(){Aicb.initializer.addUserToScript()})},!0)}})}}
Aicb.common.mrLoader('body',!1)}
function execute(){firebase.auth().onAuthStateChanged(function(user){if(user){profileUpdate(user);let loadFromSnap=function(snap){const page=document.querySelector('.mr-container');if(page&&page.dataset.action==='mr-user-profile'){if(snap.key&&snap.val()){loadUsers(snap.key,snap.val(),'prepend')}}};firebase.database().ref('users/').orderByChild("/lastSignInTime/").limitToLast(10).on('child_added',loadFromSnap);firebase.database().ref('users/').orderByChild("/lastSignInTime/").limitToLast(10).on('child_changed',loadFromSnap);loadMore();Aicb.translate.execute()}})}
return{execute:execute,coreAction:coreAction}})();Alc__admin.prototype.templateDom=(function(){"use strict";function _tx(text='',identifier='',mode='page'){return'<span class="mrtx" data-key="'+identifier+'" data-mode="'+mode+'">'+text+'</span>'}
let loader='<div class="mr-load"><span></span><span></span><span></span><span></span></div>';function dashboard(){return['<div class="aicb-setting" data-action="mr-chatbot-manager">','<div class="mr-main mr-shadow mr-main-full">','<div class="mr-main__header"><h2 id="cb-title"><span class="iconify" data-icon="fa-solid:home"></span> '+_tx('Dashboard','_txd1')+'</h2></div>','<div class="mr-main__content"><div class="mr-main__settings-form">','<div class="mr-dash-box"><h2 class="dash-title1"><span class="iconify" data-icon="ant-design:user-switch-outlined"></span> '+_tx('Visitors on your page right now','_txd2')+'</h2>','<p>'+_tx('Start a conversation with your visitors and turn them into happy customers.','_txd3')+'</p>','<span class="iconify visitor-img" data-icon="whh:visitor"></span></div>','<div id="cbAppearance" class="cb-setting active">','<section class="mr-setting-block"><div class="table-title header-both">','<h2 class="">'+_tx('Visitors List','_txd4')+'</h2>','<div class="mrSync"><span class="iconify" data-icon="fa-solid:sync-alt"></span> Sync</div></div>','<table class="mrTable"><thead id="mrVisitorsListHead"></thead><tbody id="mrVisitorsList"></tbody></table>','<div class="scrollbar"><ul id="mrVisitorsList" class="list-reverse people visitors "></ul></div>','</section></div>','<div class="mr-dash-news"><h2 class="dash-title">'+_tx('Mr. Assistant Overview','_txd50')+'</h2>','<div class="mr-dash-docs"><div class="train-box"><h1 id="desh_visitors" data-type="visitors">0</h1>','<h2><strong>'+_tx('Total Visitors','_txd61')+'</strong></h2>','</div>','<div class="train-box"><h1 id="desh_clients" data-type="clients">0</h1>','<h2><strong>'+_tx('Total Clients','_txd71')+'</strong></h2>','</div>','<div class="train-box"><h1 id="desh_issues" data-type="issues">0</h1>','<h2><strong>'+_tx('Training Issues','_txd81')+'</strong></h2>','<div id="train-me" class="train-btn"><span class="iconify" data-icon="mdi:robot-industrial"></span> Train Now','</div></div>','<div class="train-box"><h1 id="desh_operators" data-type="operators">0</h1>','<h2><strong>'+_tx('Total Live Operators','_txd91')+'</strong></h2>','<div class="train-btn theme">+ 1 Mr. Assistant</div>','</div></div></div></div></div></div></div>'].join('')}
function chatConsole(){return['<div class="aicb-setting mr-chat-console wrapper" data-action="mr-chatbot-console">','<div class="container">','<div class="left">','<div class="cb-row mr-chat-menu">','<h2 data-action="liveChat"><span class="iconify" data-icon="bx:bxs-chat"></span><span>'+_tx('Chats','_txc1')+'</span></h2>','<h2 data-action="visitorsChat"><span class="iconify" data-icon="whh:visitor" data-inline="true"></span><span>'+_tx('Visitors','_txc2')+'</span></h2>','<h2 data-action="archiveChat"><span class="iconify" data-icon="feather:archive" data-inline="false"></span><span>'+_tx('Archive','_txc3')+'</span></h2>','</div>','<div class="scrollbar2">','<ul id="mrClientsList" class="list-reverse people visitors "></ul>','</div>','<div class="loadMore loadMoreClients" data-action="loadMore" data-inset="20">'+_tx('Load More','_txc4')+' <span>&#8635;</span></div>','<div class="cb-row mr-chat-menu2">','<h2 data-action="gridView"><span class="iconify" data-icon="simple-line-icons:grid"></span><span> Grid View</span></h2>','<h2 data-action="listView"><span class="iconify" data-icon="fa-solid:th-list"></span><span> List View</span></h2>','<h2 data-action="sort" data-sort="asc"><span class="iconify" data-icon="whh:sortbysizeascending"></span></span><span> Sort</span></h2>','</div>','</div>','<div class="right">','<div class="cb-row padding-15">','<div class="mClientMenu" data-type="clients"><span class="iconify" data-icon="ant-design:menu-unfold-outlined"></span></div>','<div class="flex-grow cb-to"><span id="cb-client-name">'+_tx('Mr. Visitor','_txc8')+'</span>','</div>','<div id="chat-action" class="flex-grow header-right">','<span id="start_chat" class="btn">'+_tx('Start Chat','_txc9')+'</span>','<span id="chat_menu" class="iconify mr-hide" data-icon="mdi-light:chevron-down"></span>','</div>','<ul id="mr-more-action" class="mr-popup" data-type="close" style="display: none;"></ul>','<div class="mClientMenu mClientMenuInfo" data-type="info"><span class="iconify" data-icon="ant-design:menu-fold-outlined"></span></div>','</div>','<div class="scrollbar cb-message-box">','<div class="loadMoreMessages">Load More <span>↻</span></div>','<div id="admin-messages" class="messages">','<div class="message-box"><p>'+_tx('No Chat Selected','_txc10')+'</p></div>','</div>','</div>','<div class="cb-message-input">','<div id="admin-message-form" class="cb-row cb-form theme">','<input type="hidden" id="client_id" value="">','<textarea id="mr_admin_send" class="cb-input cb-input-box" type="text" placeholder="Write Your Message here..."></textarea>','<button id="mr_admin_send_btn" type="submit" class="cb-input cb-input-btn"><span class="iconify" data-icon="zmdi:mail-send"></span></button>','</div>','</div>','</div>','<div class="cb-info">','<div class="cb-row mr-chat-info-menu">','<h2 data-action="chatInfo"><span class="iconify" data-icon="whh:details"></span><span>'+_tx('Chat Info','_txc11')+'</span></h2>','<h2 data-action="chatAction"><span class="iconify" data-icon="ant-design:interaction-outlined"></span><span>'+_tx('Chat Actions','_txc12')+'</span></h2>','</div>','<div class="scrollbar3 mr-info-boxes" data-action="chatInfo">','<div class="cb-panel cb-clint-info2 bg-light2">','<h4 class="cb-panel-head"><span class="iconify" data-icon="mdi:account-card-details-outline"></span> Details</h4>','<ul class="mr-info-box cb-light-box cb-panel-body cb-browses">','<li id="test"><label for="cbName">'+_tx('Name:','_txc13')+' </label><input type="text" class="cbPanelInput" id="cbName"></li>','<li><label for="cbEmail">'+_tx('Email:','_txc14')+' </label><input type="email" class="cbPanelInput" id="cbEmail"><br></li>','<li><label for="cbJoin">'+_tx('Notes:','_txc15')+' </label>','<div class="shortNote"><div class="shortNoteBox"></div>','<div class="shortNoteInput"><input type="text" class="cbPanelInput" id="noteInput"><span id="noteInputBtn">'+_tx('Add','_txc16')+'</span></div>','</div>','</li>','</ul>','</div>','<div class="cb-panel">','<h4 class="cb-panel-head"><span class="iconify" data-icon="whh:detailsalt"></span> '+_tx('Chat Info','_txc17')+'</h4>','<ul id="mr_info" class="cb-light-box"></ul>','</div>','<div class="cb-panel">','<h4 class="cb-panel-head"><span class="iconify" data-icon="oi:browser"></span> '+_tx('Visited Pages','_txc18')+'</h4>','<ul id="cb-clint-browsing" class="cb-panel-body"></ul>','</div>','<div class="cb-panel">','<h4 class="cb-panel-head"><span class="iconify" data-icon="bpmn:end-event-error"></span> '+_tx('Training Issues','_txc19')+'</h4>','<ul id="cb-clint-error" class="cb-panel-body"></ul>','</div>','</div>','<div class="scrollbar mr-info-boxes mr-hide" data-action="chatAction">','<div id="survey_action" class="cb-panel mr_actions">','<h4 class="cb-panel-head"><span class="iconify" data-icon="simple-line-icons:action-redo"></span> '+_tx('Send Survey Form','_txc20')+'</h4>','<p>'+_tx('Ask Anonymous visitors about his/her Name and Email Address','_txc21')+'</p>','<table class="mr_action_table mr-table" data-type="survey"></table>','<button class="mr_action_btn btn btn-green" data-type="survey" data-action="signUp">Execute Action</button>','</div>','<div id="Choose chat widget Themredirect_action" class="cb-panel mr_actions">','<h4 class="cb-panel-head"><span class="iconify" data-icon="fa-solid:search-dollar" data-inline="true"></span>'+_tx('Help Searching Best','_txc23')+'</h4>','<p>'+_tx('Search one of Your best Result and suggest your user','_txc24')+'</p>','<table class="mr_action_table mr-table" data-type="search"></table>','<div class="mrTheme chatConsoleAction">','<label for="theme1"><input type="radio" name="chatConsoleAction" id="theme1" value="search"><p style="background: #fbc490">Searching</p></label>','<label for="theme2"><input type="radio" name="chatConsoleAction" id="theme2" value="kb"><p style="background: #cd8d7b">KB Action</p></label>','<label for="theme3"><input type="radio" name="chatConsoleAction" id="theme3" value="redirect"><p style="background: #687466">Open Page</p></label>','</div>','<input type="text" id="redirect_input" placeholder="Add Action here"/>','<button class="mr_action_btn btn btn-green" data-type="search" data-action="searchAction">Execute Action</button>','</div>','<div id="help_action" class="cb-panel mr_actions">','<h4 class="cb-panel-head"><span class="iconify" data-icon="simple-line-icons:action-redo"></span> '+_tx('Help Action','_txc26')+'</h4>','<p>'+_tx('Open Help menu in user facing chat widget.','_txc27')+'</p>','<table class="mr_action_table mr-table" data-type="help"></table>','<button class="mr_action_btn btn btn-green" data-type="help" data-action="HelpMenu">Execute Action</button>','</div>','<div id="feedback_action" class="cb-panel mr_actions">','<h4 class="cb-panel-head"><span class="iconify" data-icon="simple-line-icons:action-redo"></span> '+_tx('Send Feedback Form','_txc29')+'</h4>','<p>'+_tx('Ask your visitors about feedback and rating of chat','_txc31')+'</p>','<table class="mr_action_table mr-table" data-type="feedback"></table>','<button class="mr_action_btn btn btn-green" data-type="feedback" data-action="Feedback">Execute Action</button>','</div>','<div id="feedback_action" class="cb-panel mr_actions">','<h4 class="cb-panel-head"><span class="iconify" data-icon="bx:bxs-food-menu" data-inline="true"></span> '+_tx('Open Menu Action','_txc33')+'</h4>','<p>'+_tx('Open Menu in User Chat Widget','_txc34')+'</p>','<table class="mr_action_table mr-table" data-type="menuAction"></table>','<button class="mr_action_btn btn btn-green" data-type="menuAction" data-action="menuAction">Execute Action</button>','</div>','</div>','<div class="scrollbar mr-info-boxes mr-hide allActionsView" data-action="allActionsView">','<div id="all_action" class="cb-panel mr_actions">','<h4 class="cb-panel-head"><span class="iconify" data-icon="simple-line-icons:action-redo"></span> '+_tx('All Actions','_txc38')+'</h4>','<table class="mr_action_table mr-table mr-all-action-table" data-type="allActions"></table>','</div>','</div>','<div class="cb-row mr-chat-menu4">','<h2 class="allActionsBtn"><span class="iconify" data-icon="uil:transaction"></span><span>'+_tx('All Actions Status','_txc39')+'</span></h2>','</div>','</div>','</div>','</div>'].join('')}
function indexTable(){return['<div class="aicb-setting mr-main mr-shadow mr-index-full" data-action="aicb_indexing">','<div class="mr-main__header"><h2 id="cb-title"> '+_tx('Index Table','_txi1')+'</h2></div>','<h2 class="mr_header">'+_tx('Indexing Operations','_txi2')+'</h2>','<p class="mr-text">'+_tx('To read more about the index table, please read the documentation chapter about Index table usage.','_txi7')+'</p>','<div class="mr_index_container">','<div class="mr_indexing">','<h2 class="mr_header">'+_tx('Indexing with available Post Type Drag to Right Box','_txi3')+'</h2>','<div id="aisPostTypes" class="cb-setting mr_active">','<div class="mr_drag_drop regular-text mr-item" data-key="postTypes" data-action="dragNDrop">','<div class="mr_drag_box">','<h4 class="mr_header">'+_tx('Available Post Type','_txi4')+'</h4>','<div class="mr_drag_box2 mr_drag_available"></div>','</div>','<div class="mr_drag_box">','<h4 class="mr_header">'+_tx('Drag here the post types you want to use!','_txi5')+'</h4>','<div class="mr_drag_box2 mr_drag_selected"></div>','</div>','</div>','</div>','</div>','<div class="mr-index-right">','<div class="second"><input class="mrA_input" type="checkbox" data-action="checkbox" data-key="mr_title">'+_tx('Search In Post Title','_txi10')+'</div>','<div class="second"><input class="mrA_input" type="checkbox" data-action="checkbox" data-key="mr_content">'+_tx('Allow Search in Post Content','_txi8')+'</div>','<div class="second"><input class="mrA_input" type="checkbox" data-action="checkbox" data-key="mr_excerpt">'+_tx('Allow Search in Post Excerpt','_txi9')+'</div>','<div class="second"><input class="mrA_input" type="checkbox" data-action="checkbox" data-key="mr_exactly">'+_tx('Show only exact matches Results','_txi11')+'</div>','<div class="indexing_status"></div>','<button class="button button-primary button-hero" id="mr-save-action-btn">'+_tx('Index Now','_txi6')+'</button>','</div>','</div>','</div>'].join('')}
function settingsPageHTML(){const header=['<div class="aicb-setting" data-action="mr-chatbot-manager">','<ul id="cb-settings-actions" class="mr-sidebar mr-shadow">','<div class="mr-sidebar__header"><p><span class="iconify" data-icon="dashicons:admin-settings"></span> '+_tx('Settings and Configuration','_txs1')+'</p></div>','<li class="mr-sidebar__menu-item sidebar__menu-item--active" data-id="#cbBotConfig"><span class="iconify" data-icon="simple-icons:dependabot"></span> '+_tx('Chatbot Configuration','_txs2')+'</li>','<li class="mr-sidebar__menu-item" data-id="#cbChatWithVisitors"><span class="iconify" data-icon="raphael:anonymous"></span> '+_tx('Chat With Visitors','_txs3')+'</li>','<li class="mr-sidebar__menu-item" data-id="#cbSearchEngine"><span class="iconify" data-icon="simple-icons:dependabot"></span> '+_tx('Mr. Assistant Bot','_txs11')+'</li>','<li class="mr-sidebar__menu-item" data-id="#cbBotConfigEcommerce"><span class="iconify" data-icon="logos:woocommerce"></span> '+_tx('E-Commerce Settings','_txs5')+'</li>','<li class="mr-sidebar__menu-item" data-id="#cbBotCustomActions"><span class="iconify" data-icon="simple-icons:githubactions"></span> '+_tx('Custom Actions','_txs6')+'</li>','<li class="mr-sidebar__menu-item" data-id="#cbMenus"><span class="iconify" data-icon="gridicons:menus"></span> '+_tx('Custom Menus','_txs7')+'</li>','<li class="mr-sidebar__menu-item" data-id="#cbTranslation"><span class="iconify" data-icon="dashicons:translation"></span> '+_tx('Translation','_txs10')+'</li>','<li class="mr-sidebar__menu-item" data-id="#cbHelp"><span class="iconify" data-icon="mdi-light:help-circle"></span> '+_tx('Help Menu','_txs8')+'</li>','</ul>','<div class="mr-main mr-shadow">','<div class="mr-main__header mSettingsHeader">','<div class="mSettingsMenu"><span class="iconify" data-icon="ant-design:menu-unfold-outlined"></span></div>','<h2 id="cb-title"><span class="iconify" data-icon="ant-design:setting-filled"></span> Settings</h2>','</div>','<div class="mr-main__content">','<div class="mr-main__settings-form">'].join('');const cbBotConfig=['<div id="cbBotConfig" class="cb-setting active">','<section class="mr-setting-block">','<div class="s-row border">','<label for="mr-switch-1">'+_tx('Enable Mr. Assistant Bot','_txsb1')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This is the main action of your chat bot on/off. If you click off no action will execute like livechat, bots, find visitors etc.</div></div>:</label>','<div class="s-action" id="mrA_support2">','<input id="mr-switch-1" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="assistantSupport">','<label for="mr-switch-1" class="mr-switch">Label</label><p class="s-row subLine">Enable MR. Assistant Bot  when you will not be online. MR. Assistant Bot will support your client as your train.</p>','</div>','</div>','<div class="s-row border">','<label for="kbBot">'+_tx('Chat Start method','_txsb2')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">Choose one of chat start method how you want to visitors will start chatting with you, your agents, bots.</div></div>:</label>','<div class="s-action">','<div class="mrA_input" data-action="radio" data-key="chatWay">','<div class="s-row s-radio border2">','<input type="radio" name="chatWay" id="chatWay11" value="chatWithVisitors">','<label for="chatWay11"><h4>'+_tx('Chat With Visitors','_txsb3')+'</h4><p>There have two method to chat with visitors</p><p>1. Chat with visitors with Anonymous GUID and auth (Manually) </p><p>2. Chat with visitors with automatic Anonymous auth</p></label>','</div>','<div class="s-row s-radio border2">','<input type="radio" name="chatWay" id="chatWay1" value="chatWithEmail">','<label for="chatWay1"><h4>'+_tx('Chat With Email and Name','_txsb4')+'</h4><p>Visitors need to input Name and Email to start conversation or supports.</p></label>','</div>','<div class="r-box border2">','<div class="s-row s-radio ">','<input type="radio" name="chatWay" id="chatWay2"  value="chatAnonymously">','<label for="chatWay2"><h4>'+_tx('Chat Anonymously (No required Email and Name)','_txsb5')+'</h4><p>No Email and Name require in chat start but you can send sign up form in chatting session.</p></label>','</div>','<div class="second"><input class="mrA_input" type="checkbox" data-action="checkbox" data-key="uniqueAnonymous">Generate unique id for Anonymous user</div>','</div>','<div class="s-row s-radio border2">','<input type="radio" name="chatWay" id="chatWay4" value="chatOffline">','<label for="chatWay4"><h4>'+_tx('Chat Offline (No save Chat history)','_txsb6')+'</h4><p>This is an offline chat for visitors. Here Visitors can chat with all Mr. Assistant bots except your live agents.</p><p class="subLine">Note: you can not chat with visitors and can not see any chat History. Only Bots will chat with your visitors</p></label>','</div> ','</div>','</div>','</div>','<div class="s-row border" style="margin-bottom: 80px;">','<label>'+_tx('Remove Chat History','_txsb11')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">Here you can automatically remove chat history except archive chat of your offline visitors within a time periods(user last seen). But this will not remove any archive chat history.</div></div>:</label>','<div class="s-action">','<div class="mrA_input" data-action="radio" data-key="removeChatHistory">','<div class="s-row s-radio border2">','<input type="radio" name="removeChatHistory" id="removeChatHistory1" value="1">','<label for="removeChatHistory1"><h4>'+_tx('Remove chat History after 1 day','_txsb12')+'</h4></label>','</div>','<div class="s-row s-radio border2">','<input type="radio" name="removeChatHistory" id="removeChatHistory2" value="7">','<label for="removeChatHistory2"><h4>'+_tx('Remove chat History after 7 day','_txsb13')+'</h4></label>','</div>','<div class="s-row s-radio border2">','<input type="radio" name="removeChatHistory" id="removeChatHistory3" value="30">','<label for="removeChatHistory3"><h4>'+_tx('Remove chat History after 30 day','_txsb14')+' </h4></label>','</div>','<div class="s-row s-radio border2">','<input type="radio" name="removeChatHistory" id="removeChatHistory4" value="0">','<label for="removeChatHistory4"><h4>'+_tx('Never remove any Chat History','_txsb15')+'</h4></label>','</div>','</div>','</div>','</div>','</section>','</div>'].join('');const cbChatWithVisitors=['<div id="cbChatWithVisitors" class="cb-setting ">','<section class="mr-setting-block">','<div class="s-row border">','<label for="chatWithVisitor">'+_tx('Enable Visitors Cursor','_txsc1')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">Enable Visitors Cursor to chat with your visitors when they are visiting your site. See what they browsing and guide them.</div></div>:</label>','<div class="s-action">','<input id="chatWithVisitor" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="chatWithVisitor">','<label for="chatWithVisitor" class="mr-switch">Label</label>','<p class="s-row subLine">'+_tx('Enable Visitors Cursor to Chat With Your live Visitors when someone visiting on your site.','_txsc2')+'</p>','</div>','</div>','<div class="s-row border">','<label>'+_tx('Chat With Visitors method','_txsc3')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">Choose one of these methods. There have 2 powerful and secure options to chat with visitors. </div></div>:</label>','<div class="s-action">','<div class="mrA_input" data-action="radio" data-key="chatWithVisitorWay">','<div class="s-row s-radio border2">','<input type="radio" name="chatWithVisitorWay" id="chatWithVisitorWay1" value="anonymousAuth">','<label for="chatWithVisitorWay1"><h4>'+_tx('Chat with visitors with automatic Anonymous auth','_txsc4')+'</h4><p>This will Authenticate your visitors immediately as Anonymous auth when someone visit your site</p><p class="subLine">Note: This will Authenticate your all visitors immediately. So if you have much visitors traffic on your site that can make you a little bit confusing in chat console. Because this will generate many live chat persons in the chat room. So you need many active live agents to handle this situation.</p></label>','</div>','<div class="r-box border2">','<div class="s-row s-radio">','<input type="radio" name="chatWithVisitorWay" id="chatWithVisitorWay2" value="anonymousGuidAuth">','<label for="chatWithVisitorWay2"><h4>'+_tx('Chat with visitors with Unique GUID and visitors Authentication (Manually Authentication)','_txsc5')+'</h4><p>This will Generate unique GUID for Every visitor Client. You need to Authenticate visitors by sending a chat request token to the visitor.</p><p class="subLine">Note: This will not Authenticate your all visitors automatically. So if you have much visitors traffic on your site then you can choose visitors as their browsing history and online status. This could not Authenticate visitors if they are offline or immediately leave the site in the of your sending chat request token.</p></label>','</div><br/>','<div class="second">','<input class="mrA_input" type="checkbox" data-action="checkbox" data-key="offlineTracking"> '+_tx('Track your visitors all time (24/7)','_txsc6'),'<p class="subLine">Note: If you uncheck this option you can only Track your visitors when you would be online</p>','</div>','</div>','</div>','</div>','</div>','<div class="s-row border">','<label>'+_tx('Remove Visitors','_txsc7')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">Here you can automatically remove offline visitors within a time periods. </div></div>:</label>','<div class="s-action">','<div class="mrA_input" data-action="radio" data-key="removeVisitors">','<div class="s-row s-radio border2">','<input type="radio" name="removeVisitors" id="removeVisitors1" value="1">','<label for="removeVisitors1"><h4>'+_tx('Remove offline Visitors in 1 day','_txsc8')+'</h4></label>','</div>','<div class="s-row s-radio border2">','<input type="radio" name="removeVisitors" id="removeVisitors2" value="7">','<label for="removeVisitors2"><h4>'+_tx('Remove offline Visitors in 7 days','_txsc9')+'</h4></label>','</div>','<div class="s-row s-radio border2">','<input type="radio" name="removeVisitors" id="removeVisitors3" value="30">','<label for="removeVisitors3"><h4>'+_tx('Remove offline Visitors in 30 days','_txsc10')+'</h4></label>','</div>','<div class="s-row s-radio border2">','<input type="radio" name="removeVisitors" id="removeVisitors4" value="0">','<label for="removeVisitors4"><h4>'+_tx('Never remove any Visitor','_txsc11')+'</h4></label>','</div>','</div>','</div>','</div>','</section>','</div>'].join('');const cbSearchEngine=['<div id="cbSearchEngine" class="cb-setting ">','<section class="mr-setting-block">','<div class="s-row border">','<label for="kbBot">'+_tx('Enable Knowledge Base(KB) Bot','_txses1')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This is a division of Mr. Assistant Bot. This will support with your Knowledge base question answering (KBQA) memory.</div></div>:</label>','<div class="s-action">','<input id="kbBot" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="kbBot">','<label for="kbBot" class="mr-switch">Label</label>','</div>','</div>','<div class="s-row border">','<label for="siteBot">'+_tx('Enable Website Bot','_txses2')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This is a division of Mr. Assistant Bot. This will support with your site content like posts, pages, products and much more.</div></div>:</label>','<div class="s-action">','<input id="siteBot" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="siteBot">','<label for="siteBot" class="mr-switch">Label</label>','</div>','</div>','<div class="s-row border">','<label for="sb_power">'+_tx('Website Search Power','_txses3')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This is a division of Mr. Assistant Bot. This will support with your site content like posts, pages, products and much more.</div></div>:</label>','<div class="s-action">','<div class="range-box"><span class="range_val" data-key="sb_power"></span><input type="range" min="1" max="100" step ="0.25"  value="4" id="sb_power" class="mrA_input range-slider" data-action="range" data-key="sb_power"></div>','<p class="subLine">You can increase Website Search power. Default: 400</p>','</div>','</div>','<div class="s-row border">','<label for="notFound">'+_tx('Not Found Type','_txses4')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">By default, system will handle Not-found request. But you can choose custom handler to handle it yourself. Just update your _notFound action from Knowledge Base.</div></div>:</label>','<div class="s-action">','<div class="mrA_input" data-action="radio" data-key="notFound">','<div class="s-row s-radio border2">','<input type="radio" name="notFound" id="notFound1" value="system">','<label for="notFound1"><h4>'+_tx('System Handler','_txses5')+'</h4></label>','</div>','<div class="s-row s-radio border2">','<input type="radio" name="notFound" id="notFound2" value="custom">','<label for="notFound2"><h4>'+_tx('Custom Handler','_txses6')+'</h4></label>','</div>','</div>','</div>','</div>','</section>','</div>'].join('');const cbBotConfigEcommerce=['<div id="cbBotConfigEcommerce" class="cb-setting ">','<section class="mr-setting-block">','<div class="s-row border">','<label for="wooBot">'+_tx('Enable eCommerce Bot(WooCommerce)','_txse1')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This is a division of Mr. Assistant Bot. This will support with your WooCommerce online shop content like products, tags, attributies and much more.</div></div>:</label>','<div class="s-action">','<input id="wooBot" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="wooBot">','<label for="wooBot" class="mr-switch">Label</label>','<p class="s-row subLine">'+_tx('Include eCommerce Bot in your Mr. Assistanr Bots.','_txse2')+'</p>','</div>','</div>','<div class="s-row border">','<label for="wooCart">'+_tx('Enable Add to cart feature','_txse3')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This is an option that user can add to cart product from chat widget within one single click. Also can view carts in single click.</div></div>:</label>','<div class="s-action">','<input id="wooCart" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="wooCart">','<label for="wooCart" class="mr-switch">Label</label>','<p class="s-row subLine">'+_tx('Include add to cart feature in your Mr. Assistanr Bots.','_txse4')+'</p>','</div>','</div>','<div class="s-row border">','<label for="mrOnlineStatus">'+_tx('Add your currency','_txse5')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This is custom currency option. You can add your currency here.</div></div>:</label>','<div class="s-action">','<input class="mrA_input mr-main__input" placeholder="$" type="text" data-action="text" data-key="woo_currency">','</div>','</div>','</section>','</div>'].join('');const cbBotCustomActions=['<div id="cbBotCustomActions" class="cb-setting ">','<section class="mr-setting-block">','<div class="s-row border">','<label for="actionBot">'+_tx('Include Custom Actions into Bot','_txsd0')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">There have lot of build in custom actions that will help user to finding content more easily and complete task more easily. The purpose of custom actions to find right content within less time with best match.</div></div>:</label>','<div class="s-action">','<input id="actionBot" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="actionBot">','<label for="actionBot" class="mr-switch">Label</label><br/><p class="s-row subLine">This will include All custom Actions into your Mr. Assistant Bots</p>','</div>','</div>','<div class="s-row border">','<label for="a_product">'+_tx('Enable Quick Product Search','_txsd1')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">User can find product quickly by adding a "product" keyword before a search</div></div>:</label>','<div class="s-action">','<input id="a_product" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="a_product">','<label for="a_product" class="mr-switch">Label</label>','<p class="s-row subLine">'+_tx('User can find product quickly by adding the "product" keyword before a search','_txsd2')+'</p>','</div>','</div>','<div class="s-row border">','<label for="a_post">'+_tx('Enable Quick Post Search','_txsd3')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">User can find posts quickly by adding a "post" keyword before a search</div></div>:</label>','<div class="s-action">','<input id="a_post" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="a_post">','<label for="a_post" class="mr-switch">Label</label>','<p class="s-row subLine">'+_tx('User can find posts quickly by adding the "post" keyword before a search','_txsd4')+'</p>','</div>','</div>','<div class="s-row border">','<label for="a_page">'+_tx('Enable Quick Page Search','_txsd5')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">User can find Page quickly by adding a "Page" keyword before a search</div></div>:</label>','<div class="s-action">','<input id="a_page" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="a_page">','<label for="a_page" class="mr-switch">Label</label>','<p class="s-row subLine">'+_tx('User can find Page quickly by adding the "page" keyword before search','_txsd6')+'</p>','</div>','</div>','<div class="s-row border">','<label for="a_tag">'+_tx('Enable HashTag search Action','_txsd7')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">User can find Tags quickly by adding a "tags" keyword before a search </div></div>:</label>','<div class="s-action">','<input id="a_tag" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="a_tag">','<label for="a_tag" class="mr-switch">Label</label>','<p class="s-row subLine">'+_tx('User can find Tags quickly by adding a "tags" keyword before a search','_txsd8')+'</p>','</div>','</div>','<div class="s-row border">','<label for="a_author">'+_tx('Enable Quick Author Search','_txsd9')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">User can find posts by Author quickly by adding "author" keyword before search</div></div>:</label>','<div class="s-action">','<input id="a_author" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="a_author">','<label for="a_author" class="mr-switch">Label</label>','<p class="s-row subLine">'+_tx('User can find Page quickly by adding "author/@" keyword before search','_txsd10')+'</p>','</div>','</div>','<div class="s-row border">','<label for="a_goto">'+_tx('Enable Navigation Action','_txsd11')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">Users can go another page quickly by adding "/" before a search or just use the "go" keyword in the last of your search.</div></div>:</label>','<div class="s-action">','<input id="a_goto" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="a_goto">','<label for="a_goto" class="mr-switch">Label</label>','<p class="s-row subLine">'+_tx('Users can navigate another page, post, product quickly by adding "/" before a search or just use the "go" keyword in the last of your search.','_txsd14')+'</p>','</div>','</div>','</section>','</div>'].join('');const cbMenus=['<div id="cbMenus" class="cb-setting">','<div class="s-row menu-box"><button class="btn btn-danger" id="mr_create_menu">Create New Menu</button></div>','<section style="display: none" id="mrMenuTree" class="mr-setting-block border">','<input class="mrA_input" id="mrMenuID" type="hidden" data-action="text" data-key="menuID" value=""> ','<div class="s-row">','<label for="menuName">'+_tx('Menu name','_txsm1')+' <div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">Add a public facing Menu name. Menu name can be like current offer, discount, coupon or as your demand.</div></div>:</label>','<div class="s-action"><input id="menuName" class="mrA_input mr-main__input" placeholder="Menu Name" type="text" data-action="text" data-key="menuName"></div>','</div>','<div class="s-row">','<label for="menuUrl">'+_tx('Menu Image url','_txsm2')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">Add menu icon URL or add an icon from Unified icons framework(iconify). This will show top of menu name.</div></div>:</label>','<div class="s-action" ><input id="menuUrl" class="mrA_input mr-main__input" placeholder="ICON URL or ICON from Unified icons framework(iconify)" type="text" data-action="text" data-key="menuUrl">','<p class="subLine">Add menu icon URL or add an icon from Unified icons framework(iconify). <a href="https://iconify.design/icon-sets/" target="_blank">Get an ICON</a></p></div>','</div>','<div class="s-row">','<label for="menuContext">'+_tx('Menu Content','_txsm3')+' <div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This is the menu content according to menu context.  </div></div>:</label>','<div class="s-action"><textarea name="menuContext" id="menuContext" class="mrA_input mr-main__input" placeholder="Write Menu Context" type="text" data-action="text" data-key="menuContext"></textarea>','<p class="subLine">To see content in the menu you must select "context action" from Menu Action type</p></div>','</div>','<div class="s-row">','<label for="menuAction">'+_tx('Menu Action Type','_txsm4')+' <div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This is the option of menu actions how to execute menu action.</div></div>:</label>','<div class="s-action">','<select id="menuAction" class="mrA_input mr-main__input" data-action="text" data-key="menuAction"><option value="contextAction" selected>Context Action</option><option value="searchAction">Search Action</option><option value="kb">Knowledge Base Action</option><option value="redirectAction">Open URL Action</option><option value="help">Help Action</option><option value="menu">Menu Action</option><option value="rate">Ratting Action</option><option value="cart">View Cart Action</option></select>','</div>','</div>','<div class="s-row">','<label for="actionContext">'+_tx('Add Action','_txsm5')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This option is relative to menu actions - Context Action(no input), Redirect Action(Input Url), Search Action(action context) etc. </div></div>:</label>','<div class="s-action">','<p id="mr_action_show"></p>','<input id="actionContext" style="display:none" class="mrA_input mr-main__input" placeholder="Action Context" type="text" data-action="text" data-key="actionContext">','<p class="subLine"></p>','</div>','</div>','<div class="s-row">','<label>'+_tx('Status','_txsm6')+'<div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This will represent current status of menu to display in chat widget.</div></div>:</label>','<div class="s-action" id="mr_user_active">','<input id="mrUA" type="checkbox" class="mrA_input mr-switch-checkbox" data-action="checkbox" data-key="status">','<label for="mrUA" class="mr-switch">Label</label>','</div>','</div>','<div class="s-row">','<label></label>','<div class="s-action"><button class="btn btn-danger" id="mr_menu_save" data-key="" data-action="create">Create Menu</button></div>','</div><br/>','</section>','<table class="mrTable"><thead id="mrMenusListHead"></thead><tbody id="mrMenusTable"></tbody></table>','</div>'].join('');const cbHelp=['<div id="cbHelp" class="cb-setting">','<section id="mrHelp" class="mr-setting-block">','<div class="s-row border">','<label for="helpTitle">'+_tx('Title','_txsh1')+' <div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">This is Help menu Title in public facing pop box in chat widget.</div></div>:</label>','<div class="s-action"><input id="helpTitle" class="mrA_input mr-main__input" placeholder="Write Title" type="text" data-action="text" data-key="helpTitle"></div>','</div>','<div class="s-row border">','<label for="helpContent">'+_tx('Help Content','_txsh2')+' <div class="labelRelative"><span class="labelFaq">?</span><div class="labelFaqAns">There you may input help context about how to use your service and little guide about your service.</div></div>:</label>','<div class="s-action"><textarea id="helpContent" class="mrA_input mr-main__input" placeholder="Write Content" type="text" data-action="text" data-key="helpContent"></textarea></div>','</div>','<div class="s-row ">','<label></label>','<div class="s-action"><button class="btn btn-danger" id="mr_help_save">Save</button></div>','</div>','</section>','</div>'].join('');const cbTranslation=['<div id="cbTranslation" class="cb-setting">','<section id="mrHelp" class="mr-setting-block">','<div class="s-row txHeader">','</div>','<div class="txBody">','</div>','<br/><br/><p>Select One of the page on top to translate.</p><p class="subLine">Note: Translatable text will Bring up for pages in the time of Browsing on-page. So if you don\'t show your desire translatable text you need to browse on this portion to extract translatable text.</p>','</section>','</div>'].join('');const footer='</div></div></div></div>';return[header,cbBotConfig,cbChatWithVisitors,cbSearchEngine,cbBotConfigEcommerce,cbBotCustomActions,cbMenus,cbTranslation,cbHelp,footer].join('')}
function knowledgeBaseHTML(){return['<div class="aicb-setting" data-action="mr-chatbot-manager">','<div class="mr-main mr-shadow mr-main-full">','<div class="mr-main__header mr_t_issues">','<h2 id="cb-title"><span class="iconify" data-icon="logos:backbone-icon"></span> '+_tx('Knowledge base question answering (KBQA)','_txk1')+'</h2>','<h2 id="tIssue_btn"><span class="iconify" data-icon="whh:issueclosed"></span> '+_tx('Training Issues','_txkti1')+'</h2>','</div>','<div class="draggable_box"><div id="tIssues" draggable="true" data-action="sleep" style="display:none;">','<div id="tIssues_head">','<div class="issueHeadText"><span class="iconify" data-icon="whh:issueclosed"></span> Training Issues</div>','<div id="issueHeadConfig"><span class="iconify" data-icon="whh:dropmenu" data-inline="true"></span></div>','<div id="issueHeadClose"><span class="iconify" data-icon="emojione:cross-mark-button" data-inline="true"></span></div>','</div>','<ul id="issueHeadConfigBox" style="display:none"><li id="issuedeleteAll">Delete All Issues</li></ul>','<div class="tIssues_box">','<ul id="tIssues_body"></ul>','<div id="tIssues_footer"></div>','</div>','</div></div> ','<div class="mr-main__content mr_train_container">','<div class="mr-main__settings-form">','<div id="cbAppearance2" class="cb-setting active">','<section class="mr-setting-block">','<div id="cbKnowledgeBase">','<section class="mr-setting-block">','<div class="mr-flex-center">','<label class="mr-main__input-label">'+_tx('Search and Add Knowledge Base ','_txk2')+'</label>','<div class="mr-flex mr-relative">','<input id="mr_search_kb" class="mr-main__input" placeholder="Question.." type="text">','<button id="mr_add_kb" data-action="mr_add">Add</button>','</div>','<div class="mr-flex mr-relative">','<label class="mr-main__input-label"></label>','<ul id="mr_kb_found"></ul>','</div>','</div>','<div id="showHideKnowledge" class="mr_right_text"><i class="fa fa-angle-down"></i></div>','<div id="addKnowledge" style="display: none;"></div>','<table class="mrTable"><thead id="mrKnowledgeListHead"></thead><tbody id="mrKnowledgeList"></tbody></table>','</section>','</div>','</section>','</div>','</div>','</div>','</div>','</div>'].join('')}
function chatHistoryHTML(){return['<div class="aicb-setting" data-action="mr-chatbot-manager">','<div class="mr-main mr-shadow mr-main-full">','<div class="mr-main__header">','<h2 id="cb-title"><span class="iconify" data-icon="fa-solid:history"></span> '+_tx('Chat History','_txh1')+'</h2>','</div>','<div class="mr-main__content">','<div class="mr-main__settings-form">','<div class="mr-dash-box">','<h2 class="dash-title1"><span class="iconify" data-icon="entypo:users"></span> '+_tx('All Users Chat History on your site','_txh2')+'</h2>','<p>'+_tx('View Users previous conversation or delete users chat history.','_txh3')+'</p>','<span class="iconify visitor-img history-img" data-icon="fa:history"></span>','</div>','<div id="cbAppearance" class="cb-setting active">','<section class="mr-setting-block">','<div id="clientsSetting" >','<h2 class="table-title">'+_tx('All Users List','_txh4')+'</h2>','<div class="mrLIstPagination">','<table class="mrTable"><thead id="mrClientsListHead"></thead><tbody id="mrClientsList"></tbody></table>','</div>','</div>','</section>','</div>','</div>','</div>','</div>','</div>'].join('')}
function userProfileHTML(){return['<div class="aicb-setting" data-action="mr-chatbot-manager">','<div class="mr-main mr-shadow mr-main-full">','<div class="mr-main__header">','<h2 id="cb-title"><span class="iconify" data-icon="fa-solid:user"></span> '+_tx('My Account','_txp1')+'</h2>','</div>','<div class="mr-main__content">','<div class="mr-main__settings-form">','<div id="userProfile">','<section id="mrUpdateUserProfile" class="mr-setting-block">','<div class="s-row">','<label for="mrDisplayName">'+_tx('User Profile Url:','_txp2')+' </label>','<div class="s-action">','<input id="mrUpdatePhotoUrl" class="mrA_input mr-main__input" placeholder="Display Name" type="text" data-action="text" data-key="name">','</div>','</div>','<div class="s-row">','<label for="mrDisplayName">'+_tx('Display name: ','_txp3')+'</label>','<div class="s-action">','<input id="mrUpdateDisplayName" class="mrA_input mr-main__input" placeholder="Display Name" type="text" data-action="text" data-key="name">','</div>','</div>','<div class="s-row">','<label for="mrDisplayName">'+_tx('User Email: ','_txp4')+'</label>','<div class="s-action">','<input id="mrUpdateUserEmail" disabled class="mrA_input mr-main__input" placeholder="Display Name" type="text" data-action="text" data-key="name">','</div>','</div>','<div class="s-row">','<label for="mrPass"></label>','<div class="s-action">','<button class="btn btn-primary" id="mr_update_user_profile" data-uid="" data-type="">Update User</button>','</div>','</div>','</section>','</div>','<h2 class="table-title"><span class="iconify" data-icon="gridicons:multiple-users"></span> '+_tx('Operators List','_txp5')+'</h2>','<table class="mrTable"><thead id="mrUsersListHead"></thead><tbody id="mrUsersList"></tbody></table>','</div>','</div>','</div>','</div>'].join('')}
function execute(template){if(template==="mr-dashboard"){return dashboard()}else if(template==="mr-chatbot-console"){return chatConsole()}else if(template==="mr-index-table"){return indexTable()}else if(template==="mr-chatbot-settings"){return settingsPageHTML()}else if(template==="mr-knowledge-base"){return knowledgeBaseHTML()}else if(template==="mr-chat-history"){return chatHistoryHTML()}else if(template==="mr-user-profile"){return userProfileHTML()}}
return{execute:execute,loader:loader}})();Alc__admin.prototype.template=(function(){"use strict";let system={};function addKnowledgeBase(data){let moreAns=function(mAns){let ids=[];let head=`<div id="cbMoreKnowledge">`;let mt='';for(var prop in mAns){if(!mAns.hasOwnProperty(prop))continue;var val=mAns[prop];var id=parseInt(prop.replace(/\D/g,''));ids.push(id);mt+='<textarea class="moreAnswer mr-main__input" data-id="'+id+'" data-key="'+prop+'">'+val+'</textarea>'}
let index=(ids?(Math.max.apply(Math,ids)+1):1)|1;let footer=['</div>','<div class=" mr-btn-right">','<button id="cbAddMoreAnswer" data-id="'+(index)+'" data-key="ans'+(index)+'">Add More Answer</button>','</div>'].join('');return head+mt+footer};let addAnswers=function(answers){let ids=[];let head=`<div id="cbMoreKnowledge">`;let mt='';if(answers&&answers.constructor===Object&&Object.keys(answers).length>0){for(var prop in answers){if(!answers.hasOwnProperty(prop))continue;var val=answers[prop];var id=parseInt(prop.replace(/\D/g,''));ids.push(id);mt+='<div class="kbAnsBox" data-id="'+id+'" data-key="'+prop+'"><div class="kbAnsRows">';for(var prop2 in val){if(!val.hasOwnProperty(prop2))continue;var val2=val[prop2];mt+='<div class="kbAnsRow"><textarea class="moreAnswer mr-main__input" data-id="" data-key="'+prop2+'">'+val2+'</textarea><div class="kbRemoveAns kbRemoveBtn">&times;</div></div>'}
mt+='</div><div class="kbAddNewAns">&#43; Add New Answer</div>';mt+='<div class="kbRemoveAns kbRemoveAnsCss">&times; Remove This Block</div>';mt+='</div>'}}else{mt+='<div class="kbAnsBox" data-id="0" data-key="ans0">';mt+='<div class="kbAnsRows"><div class="kbAnsRow"><textarea class="moreAnswer mr-main__input" data-id="1" data-key="a1"></textarea><div class="kbRemoveAns kbRemoveBtn">&times;</div></div></div>';mt+='<div class="kbAddNewAns">&#43; Add New Answer</div>';mt+='<div class="kbRemoveAns kbRemoveAnsCss">&times; Remove This Block</div>';mt+='</div>'}
let index=(ids?(Math.max.apply(Math,ids)+1):1)|1;let footer=['</div>','<div class="mr-btn-right">','<button id="cbAddMoreAnswer" data-id="'+(index)+'" data-key="ans'+(index)+'">&#43; Add Next Answer Block</button>','</div>'].join('');return head+mt+footer};let related=function(mAns){let mt='';for(var prop in mAns){if(!mAns.hasOwnProperty(prop))continue;var obj=mAns[prop];mt+='<li data-key="'+obj.key+'"><span class="mr_rel_text">'+obj.val+'</span><span data-action="mr_edit">✎</span><span data-action="mr_delete">⤬</span></li>'}
return mt};let status=function(id){if(data.hasOwnProperty('status')&&parseInt(data.status)===id){return'checked="checked"'}else{if(id===2){return'checked="checked"'}}
return''};return[`<section><div id="hideKB" >⤬</div>`,`<div class="mrTheme KbStatus">`,`<label for="theme1"><input type="radio" name="KbStatus" id="theme1" value="2" ${status(2)}><p style="background: #fbc490">Search & Action</p></label>`,`<label for="theme2"><input type="radio" name="KbStatus" id="theme2" value="1" ${status(1)}><p style="background: #cd8d7b">Only Action</p></label>`,`<label for="theme3"><input type="radio" name="KbStatus" id="theme3" value="0" ${status(0)}><p style="background: #687466">Unpublished</p></label>`,`</div>`,`<div class="mr-flex">`,`<label class="mr-main__input-label">Question <div class="labelRelative"><span class="labelFaq">&#x3f;</span><div class="labelFaqAns">Training Question that will one of fact stored in the knowledge base (KB) memory. When the user will ask one Question, KB will replay the answer by using facts stored in a knowledge base (KB).</div></div>:</label>`,`<div class="mr-main__input"><input id="mr_question" value="${data.que ? data.que : ''}" class="mr-main__input" placeholder="Add Title" type="text">`,`<p class="subLine">Training Question that will one of fact stored in the knowledge base (KB) memory.</p></div>`,`</div>`,`<div class="mr-flex">`,`<label class="mr-main__input-label">Related Question <div class="labelRelative"><span class="labelFaq">&#x3f;</span><div class="labelFaqAns">Related Question are words (or combination of words) you can utilize on Guide question to improve the search experience of Knowledge base Question. Related Question are indexed for search with a little less weight as the Question, but multiple labels with similar words can outweigh the search of the Question, so use labels carefully to balance your search results.</div></div>:</label>`,`<div class="mr-main__input">`,`<div id="mr_tags_show"></div>`,`<textarea id="mr_tags" class="mr-main__input" placeholder="Add Related Label" type="text">${data.tag ? data.tag : ''}</textarea>`,`<p class="subLine">Related Labels are indexed for search with less weight as the Question, but multiple labels with similar words can outweigh the search of the Question, so use labels carefully to balance your search results.</p>`,`</div>`,`</div>`,`<div class="mr-flex">`,`<label class="mr-main__input-label">Answers <div class="labelRelative"><span class="labelFaq">&#x3f;</span><div class="labelFaqAns">Output: KB, training Question Answer that will be store relatively to this Question in the knowledge base (KB) memory. When the user will ask one Question, KB will replay this answer.</div></div>:</label>`,`<div class="mr-main__input">`,`${addAnswers(data.ans ? data.ans : {})}`,`<p class="subLine">Add Answer that will appear in the chat widget on search. You can add multiple answers by clicking on <strong>Add New Answer</strong> that will appear randomly. Also, You can add Multiple answers block by clicking on <strong>Add Next Answer Block</strong>.</p>`,`</div>`,`</div>`,`<div class="mr-flex">`,`<label class="mr-main__input-label">Next Action<div class="labelRelative"><span class="labelFaq">&#x3f;</span><div class="labelFaqAns">Next Action will be Executed automatically and simultaneously when this Knowledgebase will be finished.</div></div>:</label>`,`<div class="mr-main__input">`,`<div class="">`,`<select id="mr_action_type" class="mr-main__input">`,`<option value="">Select Action </option>`,`<option value="search" ${data.type && data.type === 'search' ? 'selected' : ''}>Search Action</option>`,`<option value="kb" ${data.type && data.type === 'kb' ? 'selected' : ''}>Knowledge Base Action</option>`,`<option value="redirect" ${data.type && data.type === 'redirect' ? 'selected' : ''}>Open URL Action</option>`,`<option value="help" ${data.type && data.type === 'help' ? 'selected' : ''}>Help Action</option>`,`<option value="menu" ${data.type && data.type === 'menu' ? 'selected' : ''}>Menu Action</option>`,`<option value="rate" ${data.type && data.type === 'rate' ? 'selected' : ''}>Ratting Action</option>`,`<option value="cart" ${data.type && data.type === 'cart' ? 'selected' : ''}>View Cart Action</option>`,`<option value="update_cart" ${data.type && data.type === 'update_cart' ? 'selected' : ''}>Update Cart Action</option>`,`<option value="checkout" ${data.type && data.type === 'checkout' ? 'selected' : ''}>Checkout Action</option>`,`</select>`,`</div>`,`<div class="">`,`<div id="mr_action_show"></div>`,`<input id="mr_action" style="display:;" value="${data.act ? data.act : ''}" class="mr-main__input" placeholder="Next Action" type="text">`,`<p class="subLine">Note: Next Action will be Executed automatically in a loop. To avoid infinitive loop or better user experience this system will block loop after 2 label deep.</p>`,`</div>`,`</div>`,`</div>`,`<div class="mr-flex">`,`<label class="mr-main__input-label">Suggestions <div class="labelRelative"><span class="labelFaq">&#x3f;</span><div class="labelFaqAns">Suggestions are another Question of KB that will be Related to this Question. This task will be executed when Answering is finished.</div></div>:</label>`,`<div class="mr-main__input">`,`<ul id="mr_related_action_results">${related(data.rel ? data.rel : '')}</ul>`,`<div class="mr-relative">`,`<input id="mr_related_action_search" class="mr-main__input" placeholder="Add Related Suggestions" type="text">`,`<ul id="mr_related_action_found"></ul>`,`</div>`,`<p class="subLine">Note: Suggestions are another Knowledgebase Question. Suggestions will be Executed when <strong>Next Action</strong> will be empty.</p>`,`</div>`,`</div>`,`<div class="mr-flex">`,`<button class="mr-button mr-shadow" data-key="${data.key !== '' ? data.key : ''}" id="saveKnowledge">Update</button>`,`</div></section>`].join('')}
function tagsListTemplate(key,data,nodeType){const container=document.getElementById('admin-messages');var div=document.getElementById('mr'+key);if(!container||div)return'';let box=document.createElement('DIV');box.setAttribute('id','mr'+key);box.setAttribute('class','mr-categories');if(data instanceof Object&&Object.keys(data).length>0){Object.keys(data).forEach(function(ele){let term=data[ele];const div=document.createElement('DIV');div.setAttribute('class','tag fade theme');div.setAttribute('data-id',ele);div.setAttribute('data-name',term.name);div.setAttribute('data-slug',term.slug);div.innerText=term.name;box.append(div)})}
if(nodeType==='prepend'){container.prepend(box)}else{container.appendChild(box)}
let cursor=(nodeType==='prepend')?'start':'end';let scroll=document.getElementById('admin-messages');if(scroll)scroll.scrollIntoView({behavior:'smooth',block:cursor})}
function getAvatar(uid){let def=mrAssistantObj.plugin_url+'assets/images/boy.svg';if(uid!==""&&Aicb.common.isset(mrUserAssets)&&mrUserAssets.hasOwnProperty(uid)){let user=mrUserAssets[uid];if(user.hasOwnProperty("avatar")&&user.avatar!==""){return user.avatar}}
return def}
function setMessage(key,data,nodeType){const node=document.createElement("DIV");const container=document.createElement("DIV");container.setAttribute('class','meg-wrapper');node.setAttribute('class','message fade '+(data.type!==''?data.type:'bot'));node.setAttribute('id','mr'+key);const text=document.createElement("span");text.setAttribute('class','message-content');text.appendChild(document.createTextNode(data.text));let nam=(data.name&&data.name!=='')?'<p class="user">'+data.name+'</p>':'',cls=(data.type==='client')?'theme':'';container.innerHTML=nam+'<span class="message-content '+cls+'">'+data.text+'</span>';if(data.type!=='bot'){const time=document.createElement("div");time.setAttribute('class','time');time.appendChild(document.createTextNode(Aicb.common.getDateTime(data.time)));if(node){container.appendChild(time)}}
node.append(container);let div=document.createElement("DIV");let img=document.createElement("IMG");img.width=25;img.height=25;div.setAttribute('class','avatar-wrapper');img.setAttribute('class','avatar');let def='';if(data.type==='bot'){img.src=(mrBot&&mrBot.hasOwnProperty('avatar'))?mrBot.avatar:def;if(node){div.append(img);node.prepend(div)}}else if(data.type==='admin'){img.src=getAvatar(data.uid||'');if(node){div.append(img);node.prepend(div)}}
let cbMessages=document.getElementById("admin-messages");if(!cbMessages){return}
if(nodeType==='prepend'){cbMessages.prepend(node);let scroll=document.getElementById('admin-messages');if(scroll){scroll.scrollIntoView({behavior:'smooth',block:'start'})}}else{cbMessages.appendChild(node);let scroll2=document.getElementById('admin-messages');if(scroll2){scroll2.scrollIntoView({behavior:'smooth',block:'end'})}}}
function productCarousel(key,data,target){try{let tmImage=mrAssistantObj.hasOwnProperty("tmImage")?mrAssistantObj.tmImage:"on";let tmTitle=mrAssistantObj.hasOwnProperty("tmTitle")?mrAssistantObj.tmTitle:"on";let tmContent=mrAssistantObj.hasOwnProperty("tmContent")?mrAssistantObj.tmContent:"on";let tmActions=mrAssistantObj.hasOwnProperty("tmActions")?mrAssistantObj.tmActions:"on";let tmBg=mrAssistantObj.hasOwnProperty("tmBg")?mrAssistantObj.tmBg:"";let tmFont=mrAssistantObj.hasOwnProperty("tmFont")?mrAssistantObj.tmFont:"";let system=mrAssets||{};const container=document.getElementById('admin-messages');var div=document.getElementById('mr'+key);if(!container||div)return'';let box=document.createElement('DIV');box.setAttribute('id','mr'+key);box.setAttribute('class','carousel mr-ani-tb');box.innerHTML=' <div class="mr-load carousel-loader"><span></span><span></span><span></span><span></span></div>';if(target==='prepend'){container.prepend(box)}else{container.appendChild(box)}
var i=1;var data1=Object.values(data);var domain=mrAssistantObj.domain,path2=mrAssistantObj.domain+'/wp-content/uploads/',path=mrAssistantObj.upload_dir?(mrAssistantObj.upload_dir+'/'):path2,def=mrAssistantObj.plugin_url+'assets/images/default.svg';let imageTemplate=function(id,title,attachment,type){let imgId=Math.floor((Math.random()*92992343)+1);if(tmImage==="off"){return}
var wrap=document.createElement('div'),src=!(attachment)?def:(path+attachment);Aicb.common.image(imgId,src,def,"img");return['<div class="product-img" data-action="asyncImg">','<span class="mr-img-'+id+'" id="mrImg-'+imgId+'"><img src="'+src+'"/></span>','<div class="cb-img-hover">','<div class="cb-img-overflow">','<a href="#" class="cb-view-btn cb_view_details theme" data-type="'+type+'" data-pid="'+id+'">View Details</a>','</div>','</div>','</div>'].join('')}
let titleContent=function(id,title,content,type){let ti=(title.length>60)?title.substring(0,60)+'...':title;let cleanText=content.replace(/<\/?[^>]+(>|$)/g,"");let co=(cleanText.length>140)?cleanText.substring(0,140)+'...':cleanText;return[(tmTitle!=="off")?'<h4 class="s-title"><a target="_blank" title="'+title+'" href="'+mrAssistantObj.domain.replace(/\/$/,"")+'?p='+id+'" style="color: '+mrAssistantObj.tmFont+'">'+ti+'</a></h4>':"",(tmContent!=="off")?'<p class="s-text" style="color: '+tmFont+'">'+co+'</p>':""].join('\n')}
let addToCart=function(id,price1,price_max1,type){if(tmActions==="off"){return}
let price=parseInt(price1),price_max=parseInt(price_max1),min=(price&&price>0)?price:0,max=(price_max&&price_max>0)?price_max:0,prices=system.woo_currency+min;if(min>0&&min===max){prices=system.woo_currency+min}else if(max>0&&min!==max){prices=system.woo_currency+min+' - '+system.woo_currency+max}
if(system.wooBot&&type==='product'){return['<div class="cb-s-footer">','<div class="e-footer theme">','<div class="s-price"><span class="mr_price">'+prices+'</span></div>',system.wooCart?'<div class="s-buy cb_view_details" data-type="'+type+'" data-pid="'+id+'">View Details</div>':'',system.wooCart?'<div class="s-buy mr-buy-now" data-action="buy" data-pid="'+id+'"><a href="'+mrAssistantObj.domain+'?p='+id+'" target="_blank">Buy Now</a></div>':'','</div></div>'].join('')}else{return['<div class="cb-s-footer">','<div class="mr-footer-center theme">','<div class="s-buy cb_view_details" data-type="'+type+'" data-pid="'+id+'">View Details</div>','</div></div>'].join('')}
return''};let setHeight=function(){let iHeight=0;if(tmImage==="on"){iHeight+=140}
if(tmTitle==="on"){iHeight+=90}
if(tmContent==="on"){iHeight+=80}
if(tmActions==="on"){iHeight+=60}
return `style="height: ${iHeight}px"`}
return[`<div class="mr_carousel" ${setHeight()}>`,'<span class="c_btn mr_c_prev theme"><span class="iconify" data-icon="mdi-light:chevron-double-left"></span></span>','<span class="c_btn mr_c_next theme"><span class="iconify" data-icon="mdi-light:chevron-double-right"></span></span>','<ul class="mr_items"">',data.map(post=>([`<li data-action="mr_carousel_item" data-type="${post.post_type}" style="background: ${tmBg || ''}">`,imageTemplate(post.id,post.post_title,post.attachment,post.post_type),titleContent(post.id,post.post_title,post.post_content,post.post_type),addToCart(post.id,post.price,post.price_max,post.post_type),'</li>'].join(''))).join(''),'</ul>','</div>'].join('')}catch(e){if(mrAssistantObj.dev==="on"){console.info(e)}}}
function chatBotReturn(key,label,type){try{let mrSystemConfig=mrAssets||{};system=Object.assign({},mrSystemConfig);if(label===undefined||label.length==0)return;var template=new Promise(function(res,rej){res(productCarousel(key,label,type))}).then(function(result){let box=document.querySelector('#admin-messages #mr'+key);if(box){box.innerHTML='';box.innerHTML+=result}}).then(function(){Aicb.carousel.execute();if(type==='prepend'){let scroll=document.getElementById('admin-messages');if(scroll)scroll.scrollIntoView({behavior:'smooth',block:'start'})}else{let scroll=document.getElementById('admin-messages');if(scroll)scroll.scrollIntoView({behavior:'smooth',block:'end'})}}).then(function(){if(!system.wooCart)return;var mr_cart=document.querySelectorAll('.mr-add-to-cart');if(mr_cart){mr_cart.forEach(ele=>{ele.addEventListener('click',function(){})})}}).then(function(){var cb_view_details=document.querySelectorAll('.cb_view_details');if(cb_view_details){cb_view_details.forEach(ele=>{ele.addEventListener('click',function(){Aicb.initializer.popMessage('View Details should execute through a chat conversational interface.','OK')})})}})}catch(e){if(mrAssistantObj.dev==="on"){console.info(e)}}}
function templateDark(key,data,type){const node=document.getElementById('mr'+key);if(!node){if(data.type==='slider'){return chatBotReturn(key,data.data,type)}if(data.type==='tags'){return tagsListTemplate(key,data.data,type)}else{return setMessage(key,data,type)}}}
return{templateDark:templateDark,getAvatar:getAvatar,addKnowledgeBase:addKnowledgeBase}})();Alc__admin.prototype.menus=(function(){function setMenu(key){if(key&&key!==''){firebase.database().ref().child('/menus/').child(key).once('value').then(function(snap){Aicb.common.setOptionConfig('#mrMenuTree .mrA_input',snap.val())})}else{Aicb.common.setOptionConfig('#mrMenuTree .mrA_input',{menuID:"",menuName:"",menuUrl:"",menuContext:"",menuAction:"",actionContext:"",status:1});const yourUl=document.getElementById("mrMenuTree"),btn=document.getElementById('mr_menu_save');yourUl.style.display='block';btn.innerText='Create New menu';btn.dataset.action='create'}
const action_type=document.getElementById('menuAction');if(action_type)action_type.addEventListener('input',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const noticeAction=document.getElementById('mr_action_show');const actionInput=document.getElementById('actionContext');if(noticeAction&&actionInput){if(this.value==='contextAction'){noticeAction.innerHTML='Add HTML content in Menu Content section.';actionInput.style.display='none'}else if(this.value==='searchAction'){noticeAction.innerHTML='Add Search here';actionInput.style.display='block'}else if(this.value==='kb'){noticeAction.innerHTML='Add Another Knowledge Base here';actionInput.style.display='block'}else if(this.value==='redirectAction'){noticeAction.innerHTML='Add Url here. ';actionInput.style.display='block'}else{noticeAction.innerHTML='This is functional action. Execute automatically.';actionInput.style.display='none'}}},!0)}
function coreAction(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();var key=e.target.dataset.key,action=e.target.dataset.action;if(action==='update'){if(key!=='')setMenu(key);const yourUl=document.getElementById("mrMenuTree"),btn=document.getElementById('mr_menu_save');yourUl.style.display='block';btn.innerText='Update menu';btn.dataset.action='update'}else if(action==='delete'){if(confirm("Are you Sure?")){if(key!==''){firebase.database().ref('menus/').child(key).remove().then(function(){let ex=document.getElementById('mu'+key);if(ex)ex.remove()})}}}}
function loadMenus(snap){const page=document.querySelector('.mr-container');if(page&&page.dataset.action==='mr-chatbot-settings'){var uTable=document.getElementById('mrMenusTable');var val=snap.val(),key=snap.key;let ex=document.getElementById('mu'+key);if(ex)ex.remove();var td=(i)=>{return['<td>'+val.menuName+'</td>','<td>'+val.menuAction+'</td>','<td>'+(val.status==1)?'Active':'Inactive'+'</td>'].join('')};var tr=document.createElement('TR');tr.setAttribute('id','mu'+key);tr.innerHTML=td();const btn1=document.createElement('SPAN');btn1.setAttribute('class','vChat btn-green');btn1.innerText='Update';btn1.setAttribute('data-action','update');btn1.setAttribute('data-key',key);btn1.addEventListener('click',coreAction,!0);const btn2=document.createElement('SPAN');btn2.setAttribute('class','vChat');btn2.innerText='Delete';btn2.setAttribute('data-action','delete');btn2.setAttribute('data-key',key);btn2.addEventListener('click',coreAction,!0);const box=document.createElement('TD');box.append(btn1);box.append(btn2);tr.append(box);if(uTable)uTable.prepend(tr)}}
function mrMenuUpdate(e){let action=e.target.dataset.action,key=e.target.dataset.key;const groups=document.querySelectorAll('#mrMenuTree .mrA_input');var data=Aicb.common.getObject('#mrMenuTree .mrA_input');if(data.menuID&&data.menuID!==''){firebase.database().ref().child('/menus/').child(data.menuID).update(data)}else{firebase.database().ref().child('/menus/').push(data).then(function(snap){const key=snap.key;e.target.dataset.action='update';e.target.innerText='Update Menu';let hId=document.getElementById('mrMenuID');if(hId)hId.value=key;firebase.database().ref().child('/menus/').child(key).update({"menuID":key})})}}
function helpMenu(){const btn=document.getElementById('mr_help_save');if(btn)btn.addEventListener('click',function(e){let data=Aicb.common.getObject('#mrHelp .mrA_input');if(data&&data.hasOwnProperty('helpContent'))firebase.database().ref().child('/help/').update(data)},!0);firebase.database().ref('help/').on('value',function(snap){let val=snap.val();const page=document.querySelector('.mr-container');if(page&&page.dataset.action==='mr-chatbot-settings'){if(val&&val.hasOwnProperty('helpContent'))
Aicb.common.setOptionConfig('#mrHelp .mrA_input',val)}})}
function execute(tId){if(tId==='#cbHelp'){return helpMenu()}
const btn=document.getElementById('mr_menu_save');if(btn)btn.addEventListener('click',mrMenuUpdate);const mr_create_menu=document.getElementById('mr_create_menu');if(mr_create_menu){mr_create_menu.addEventListener('click',function(e){var yourUl=document.getElementById("mrMenuTree");yourUl.style.display=(yourUl.style.display==='none')?'':'none';setMenu('')})}
firebase.database().ref('menus/').orderByKey().on('child_added',loadMenus);firebase.database().ref('menus/').orderByKey().on('child_changed',loadMenus);let mrMenusListHead=document.getElementById('mrMenusListHead');if(mrMenusListHead)mrMenusListHead.innerHTML='<tr class="vcHeader"><th>Menu Name</th><th>Action</th><th>Status</th><th>Action</th></tr>'}
return{execute:execute,coreAction:coreAction,}})();Alc__admin.prototype.trainingIssues=(function(){"use strict";let tIssueDB={}
function dragElement(elmnt){var pos1=0,pos2=0,pos3=0,pos4=0;if(document.getElementById(elmnt.id+"header")){document.getElementById(elmnt.id+"header").onmousedown=dragMouseDown}else{elmnt.onmousedown=dragMouseDown}
function dragMouseDown(e){e=e||window.event;e.preventDefault();pos3=e.clientX;pos4=e.clientY;document.onmouseup=closeDragElement;document.onmousemove=elementDrag}
function elementDrag(e){e=e||window.event;e.preventDefault();pos1=pos3-e.clientX;pos2=pos4-e.clientY;pos3=e.clientX;pos4=e.clientY;elmnt.style.top=(elmnt.offsetTop-pos2)+"px";elmnt.style.left=(elmnt.offsetLeft-pos1)+"px"}
function closeDragElement(){document.onmouseup=null;document.onmousemove=null}}
function loadMore(){let setLoadMore=function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let data=tIssueDB;let length=Object.keys(data).length;let start=parseInt(this.parentNode.dataset.start),end=parseInt(this.parentNode.dataset.end),step=parseInt(this.parentNode.dataset.step),type=this.dataset.type,start1,end1;if(type==='prev'){start1=start-step;end1=start}else{start1=end;end1=end+step}
let start2=(start1>0)?(start1-1):0;let end2=(end1<length)?(end1-1):(length-1);if(end2<=0||start1>=length)return;let sort=Object.entries(data).sort((a,b)=>{if(a[1].time&&b[1].time)
return b[1].time-a[1].time});let list=sort.slice(start2,end2);const mrClientsList=document.getElementById('tIssues_body');if(mrClientsList)mrClientsList.innerHTML='';for(let i=0;list.length>i;i++){if(list[i]){let key=list[i][0];if(data.hasOwnProperty(key)){add_issue(key,data[key],'append')}}}
const mrPagination=document.querySelector('.mrIsPagination');if(mrPagination){mrPagination.dataset.start=start2+1;mrPagination.dataset.end=end2+1;mrPagination.dataset.counter=length}
const mrPagiStatus=document.querySelector('.mrIsPagiStatus');if(mrPagiStatus)mrPagiStatus.innerHTML='( '+parseInt(start2+1)+' - '+parseInt(end2+1)+' ) / '+length}
firebase.database().ref('training/').orderByChild("time/").once('value',function(snap){let data=snap.val();let loadData=document.getElementById('tIssues_footer');if(data){tIssueDB=Object.assign({},data);let length2=Object.keys(data).length;if(length2>10){const container=document.createElement('DIV');container.setAttribute('class','mrIsPagination');container.setAttribute('data-start',1);container.setAttribute('data-end',11);container.setAttribute('data-counter',length2);container.setAttribute('data-step',10);const prev=document.createElement('DIV');prev.innerText='Prev';prev.setAttribute('data-type','prev');prev.addEventListener('click',setLoadMore,!0);const text=document.createElement('DIV');text.setAttribute('class','mrIsPagiStatus')
text.innerHTML='(1 - 11) / '+length2;const next=document.createElement('DIV');next.innerText='Next';next.setAttribute('data-type','next');next.addEventListener('click',setLoadMore,!0);container.append(prev);container.append(text);container.append(next);if(loadData){loadData.append(container)}}}else{if(loadData)loadData.innerHTML='No Issues'}})}
function mr_set_issue(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const action=e.target.dataset.action;const panel=e.target.parentNode;const key=panel.dataset.key;if(action==="mr_set_issue"){const text=e.target.innerText;if(text&&text!==""){const mr_search_kb=document.getElementById("mr_search_kb");if(mr_search_kb){mr_search_kb.value=text}}}else if(action==="mr_ok_issue"){firebase.database().ref("training").child(key).update({"sts":2}).then(function(){const item=document.getElementById("is"+key);if(item){item.classList.add('issue_ok')}})}else if(action==="mr_del_issue"){firebase.database().ref("training").child(key).remove().then(function(){const item=document.getElementById("is"+key);if(item){item.remove()}})}}
function add_issue(key,obj,type="prepend"){const tIssues_body=document.getElementById("tIssues_body");const li=document.createElement('LI');li.setAttribute('data-key',key);li.setAttribute('id',"is"+key);if(obj.sts&&obj.sts===2){li.setAttribute('class',"issue_ok")}
const text=document.createElement('SPAN');text.setAttribute('class','issueText ');text.innerText=obj.qs||"";text.setAttribute('data-action','mr_set_issue');text.addEventListener('click',mr_set_issue,!0);li.append(text);const ok=document.createElement('SPAN');ok.setAttribute('class','iBtn');ok.innerHTML="✓";ok.setAttribute('data-action','mr_ok_issue');ok.addEventListener('click',mr_set_issue,!0);li.append(ok);const dl=document.createElement('SPAN');dl.setAttribute('class','iBtn iBtn_del');dl.innerHTML="⤬";dl.setAttribute('data-action','mr_del_issue');dl.addEventListener('click',mr_set_issue,!0);li.append(dl);if(tIssues_body){if(type==="append"){tIssues_body.append(li)}else{tIssues_body.prepend(li)}}}
function displayIssues(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const tIssues=document.getElementById("tIssues");if(tIssues){dragElement(tIssues);let action=tIssues.dataset.action||"sleep";tIssues.style.display=tIssues.style.display==='none'?'':'none';if(action==="sleep"){tIssues.dataset.action="listening";const tIssues_body=document.getElementById("tIssues_body");firebase.database().ref("training").orderByChild("/time").limitToLast(10).on("child_added",function(snap){const tIssues2=document.getElementById("tIssues");if(!tIssues2||tIssues2.dataset.action!=="listening"){return}
let val=snap.val();if(val){add_issue(snap.key,val)}});loadMore()}}}
function execute(){const tIssue_btn=document.getElementById("tIssue_btn");if(tIssue_btn){tIssue_btn.addEventListener('click',displayIssues,!0)}
const issueHeadConfig=document.getElementById("issueHeadConfig");if(issueHeadConfig){issueHeadConfig.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const issueHeadConfigBox=document.getElementById("issueHeadConfigBox");if(issueHeadConfigBox){issueHeadConfigBox.style.display=issueHeadConfigBox.style.display==='none'?'':'none'}},!0)}
const issuedeleteAll=document.getElementById("issuedeleteAll");if(issuedeleteAll){issuedeleteAll.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();firebase.database().ref("training").set("");const tIssues_body2=document.getElementById("tIssues_body");if(tIssues_body2){tIssues_body2.innerHTML="No Issues"}
const tIssues_footer=document.getElementById("tIssues_footer");if(tIssues_footer){tIssues_footer.innerHTML=""}},!0)}
const issueHeadClose=document.getElementById("issueHeadClose");if(issueHeadClose){issueHeadClose.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const tIssues2=document.getElementById("tIssues");if(tIssues2){tIssues2.style.display='none'}},!0)}}
return{execute:execute}})();Alc__admin.prototype.knowledgeBase=(function(){"use strict";let knowledgeDB={},lastSync=Date.now();function filter(str){return str}
function saveKnowledgeButton(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let key=e.target.dataset.key;let cursor={};const know=document.getElementById('addKnowledge');let status=document.querySelector('input[name="KbStatus"]:checked');cursor.status='2';if(status){cursor.status=status.value}
const q=document.getElementById('mr_question');if(!q.value){return}
cursor.que=filter(q.value);const t=document.getElementById('mr_tags');cursor.tag=(t.value)?filter(t.value):'';let kbAnsBox=document.querySelectorAll('#cbMoreKnowledge .kbAnsBox');if(kbAnsBox){let answers={}
kbAnsBox.forEach(function(ele){let eleKey=ele.dataset.key;let rows=ele.querySelectorAll('#cbMoreKnowledge .moreAnswer');if(eleKey!==""&&rows){let ansRow={}
let i=1;rows.forEach(function(tf){if(filter(tf.value)!==""){ansRow["a"+i]=(tf.value)?filter(tf.value):'';i++}});if(Object.keys(ansRow).length>0){let obj={}
obj[eleKey]=ansRow;Object.assign({},answers,obj);answers[eleKey]=ansRow}}});if(Object.keys(answers).length>0){cursor.ans=answers}}
const mr_action_type=document.getElementById("mr_action_type");let action_type=mr_action_type.options[mr_action_type.selectedIndex].value;if(action_type&&action_type!==''){cursor.type=action_type}
const ac=document.getElementById('mr_action');if(ac.value!==''){cursor.act=(ac.value)?filter(ac.value):''}
const all_rel=document.querySelectorAll("#mr_related_action_results li");let related=[];all_rel.forEach(function(act){let related2={};const node=act.querySelector('.mr_rel_text');const key2=act.getAttribute('data-key');if(key2){related2.key=key2}
if(node){related2.val=node.innerText}
related.push(related2)});cursor.rel=related;if(key!==''){cursor.time=Date.now();cursor.key=key;firebase.database().ref().child('/knowledgeBase/'+key).set(cursor).then(function(){const hideKB=document.getElementById('hideKB');if(hideKB){hideKB.click()}})}}
function fn_mr_related_action(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const action=e.target.dataset.action;if(action==='mr_edit'){const key=e.target.parentNode.dataset.key;return KnowledgeBaseActionStart(key)}else if(action==='mr_delete'){const node=document.getElementById('mr_related_action_results');node.removeChild(e.target.parentNode)}}
function fn_mr_related_action_search(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const found=document.getElementById('mr_related_action_found');const store=document.getElementById('mr_related_action_results');let timeout=null;let str=e.target.value;if(timeout)clearTimeout(timeout);timeout=setTimeout(function(){if(str!==''){(async()=>{let results=await knowledgeBase(str);if(results&&found){let rows='';results.forEach(function(ele){rows+='<li class="mr-related-row" data-key="'+ele.doc.key+'">'+ele.doc.que+'</li>'});found.style.display='block';found.innerHTML=rows;var items=document.querySelectorAll('.mr-related-row');if(items){items.forEach(function(ele){ele.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let key=e.target.dataset.key,question=e.target.innerText;const li=document.createElement('LI');li.setAttribute('data-key',key);li.innerHTML='<span class="mr_rel_text">'+question+'</span>';let span1=document.createElement("span");span1.setAttribute('data-action','mr_edit');span1.innerHTML='&#9998;';span1.addEventListener('click',fn_mr_related_action,!0);li.appendChild(span1);let span2=document.createElement("span");span2.setAttribute('data-action','mr_delete');span2.innerHTML='&#10540;';span2.addEventListener('click',fn_mr_related_action,!0);li.appendChild(span2);let child=store.childNodes;let bol=!0;if(child){child.forEach(function(ele){if(ele.dataset.key===key){bol=!1}})}
if(bol)store.appendChild(li)},!0)})}}})()}},1000)}
function showHideKnowledgeButton(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const sh=document.getElementById('showHideKnowledge');const ak=document.getElementById('addKnowledge');if(e.target.dataset.key==='show'){sh.setAttribute('data-key','hide');sh.innerHTML='<i class="fa fa-angle-down"></i>';ak.style.display='none'}else{sh.setAttribute('data-key','show');sh.innerHTML='⤬';ak.style.display='block';knowledgeEventListener()}}
function mrActionSetEvent(value){const noticeAction=document.getElementById('mr_action_show');const actionInput=document.getElementById('mr_action');if(noticeAction&&actionInput){if(value==='search'){noticeAction.innerHTML='Add your Search string for this Action.';actionInput.style.display='block'}else if(value==='kb'){noticeAction.innerHTML='Add Another Knowledge Base name(Question) for this Action.';actionInput.style.display='block'}else if(value==='redirect'){noticeAction.innerHTML='Add a valid Url here. Also you can do this with search Action.';actionInput.style.display='block'}else{noticeAction.innerHTML='Automatically Execute this Action.';actionInput.style.display='none'}}}
function addAnsNode(){const node=document.createElement("DIV");node.setAttribute("class","kbAnsRow");const input=document.createElement("TEXTAREA");input.setAttribute("class","moreAnswer mr-main__input");const btn=document.createElement("DIV");btn.setAttribute("class","kbRemoveAns kbRemoveBtn");btn.innerHTML="&times;";btn.addEventListener("click",fnKbRemoveAns,!0);node.append(input);node.append(btn);return node}
function fnKbRemoveAns(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();if(e.target.parentNode&&e.target.parentNode.parentNode.childNodes.length>1){e.target.parentNode.remove()}}
function fbKbAddNewAns(e){let kbAnsRows=document.querySelector('#cbMoreKnowledge .kbAnsRows');if(kbAnsRows){if(kbAnsRows.lastChild){let container=e.target.parentNode.firstChild;if(container&&container.className==="kbAnsRows"){container.appendChild(addAnsNode())}}}}
function addMoreAnswer(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let next=parseInt(e.target.dataset.id)+1;const node=document.createElement("DIV");node.setAttribute("class","kbAnsBox moreAnswer");node.setAttribute('data-id',e.target.dataset.id);node.setAttribute('data-key',e.target.dataset.key);const node2=document.createElement("DIV");node2.setAttribute("class","kbAnsRows");node2.append(addAnsNode());node.append(node2);const btn=document.createElement("DIV");btn.setAttribute("class","kbAddNewAns");btn.innerHTML=`&#43; Add New Answer`;btn.addEventListener("click",fbKbAddNewAns,!0);node.append(btn);const btn2=document.createElement("DIV");btn2.setAttribute("class","kbRemoveAns kbRemoveAnsCss");btn2.innerHTML=`&times; Remove This Block`;btn2.addEventListener("click",fnKbRemoveAns,!0);node.append(btn2);const more=document.getElementById('cbMoreKnowledge');more.appendChild(node);e.target.setAttribute('data-id',next);e.target.setAttribute('data-key','ans'+next);e.target.innerHTML='&#43; Add Next Answer Block'}
function knowledgeEventListener(){setTimeout(function(){const hideKB=document.getElementById('hideKB');const know=document.getElementById('addKnowledge');const more=document.getElementById('cbMoreKnowledge');const tags=document.getElementById('cbKnowledgeTags');const mKnowBtn=document.getElementById('cbAddMoreAnswer');const mr_tags=document.getElementById('mr_tags');const action_type=document.getElementById('mr_action_type');const mr_related_action=document.querySelectorAll('#mr_related_action_results li');const mr_related_action_results=document.querySelectorAll('#mr_related_action_results li');mKnowBtn.addEventListener("click",addMoreAnswer,!0);mKnowBtn.innerHTML='&#43; Add Next Answer Block';let kbRemoveAns=document.querySelectorAll('#addKnowledge .kbRemoveAns');if(kbRemoveAns){kbRemoveAns.forEach(function(ele){ele.addEventListener("click",fnKbRemoveAns,!0)})}
let kbAddNewAns=document.querySelectorAll('#addKnowledge .kbAddNewAns');if(kbAddNewAns){kbAddNewAns.forEach(function(ele){ele.addEventListener("click",fbKbAddNewAns,!0)})}
if(mr_related_action_search){mr_related_action_search.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();if(e.target.value.length>0){document.getElementById('mr_related_action_found').style.display='block'}},!0);mr_related_action_search.addEventListener('input',fn_mr_related_action_search,!0)}
if(mr_related_action){mr_related_action.forEach(ele=>{let span=ele.querySelectorAll('span');if(span){span.forEach(sp=>{let ac=sp.dataset.action;if(['mr_edit','mr_delete'].includes(ac)){sp.addEventListener('click',fn_mr_related_action,!0)}})}})}
const s2=document.querySelector('#saveKnowledge');s2.addEventListener("click",saveKnowledgeButton,!0);var ac=document.querySelectorAll('.mr_base_action');if(ac)ac.forEach(ele=>ele.addEventListener('click',mr_base_action,!0));if(hideKB){hideKB.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();if(know)know.style.display='none'},!0)}
if(action_type)action_type.addEventListener('input',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let val=this.value;mrActionSetEvent(val)},!0)},1000)}
async function knowledgeBase(str){let mrKnowledge=elasticlunr(function(){this.addField('que');this.addField('tag');this.setRef('key')});Object.keys(knowledgeDB).map(function(key){var childData=knowledgeDB[key];mrKnowledge.addDoc({"key":key,"que":childData.que,"tag":childData.tag})});let label=mrKnowledge.search(str,{fields:{que:{boost:2},tag:{boost:1}}});return label}
function KnowledgeBaseActionStart(key){var t=function templateObj(data={}){return new Promise(resolve=>resolve(1)).then(()=>{let template=Aicb.template.addKnowledgeBase(data);const addKnowledge=document.getElementById('addKnowledge');if(addKnowledge){addKnowledge.innerHTML=template;addKnowledge.style.display='block'}}).then(function(){setTimeout(function(){knowledgeEventListener()},1000)})};if(key){firebase.database().ref('/knowledgeBase/'+key).once('value').then(function(snapshot){var data=snapshot.val();data.key=snapshot.key;return t(data)})}else{return t({})}}
function cbKnowledgeBase(){var i=1;var find=document.getElementById('mr_search_kb');var found=document.getElementById('mr_kb_found');var add=document.getElementById('mr_add_kb');if(find){let timeout=null;let used='';find.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();if(e.target.value.length>0){var fa=document.getElementById('mr_kb_found');if(fa)fa.style.display='block'}},!0);find.addEventListener('input',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let str=e.target.value;if(timeout)clearTimeout(timeout);timeout=setTimeout(function(){if(str!==''&&used!==str){used=str;(async()=>{let results=await knowledgeBase(str);if(results&&found){var rows='';var bol=0;results.forEach(function(ele){rows+='<li class="mr-kb-row" data-key="'+ele.doc.key+'">'+ele.doc.que+'</li>';if(str.toLowerCase().trim()==ele.doc.que.toLowerCase().trim()){bol+=1;add.setAttribute('data-key',ele.doc.key);add.setAttribute('data-action','mr_update');add.innerText='Update'}});if(bol<1){add.removeAttribute('data-key');add.setAttribute('data-action','mr_add');add.innerText='Add'}
found.style.display='block';found.innerHTML=rows;var items=document.querySelectorAll('.mr-kb-row');if(items){items.forEach(function(ele){ele.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();return KnowledgeBaseActionStart(e.target.dataset.key)},!0)})}}})()}},1000)},!0)}
if(add){add.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();var action=e.target.dataset.action;if(action&&action==='mr_update'){var key=e.target.dataset.key;if(key!=='')return KnowledgeBaseActionStart(key)}else{if(find.value!==''){var data={"que":filter(find.value),'ans':'','tag':'',"time":Date.now()};let postRef=firebase.database().ref('/knowledgeBase/');postRef.push(data).then(res=>{data.key=res.getKey();postRef.child(res.getKey()).set(data);if(res.getKey()!=='')return KnowledgeBaseActionStart(res.getKey())}).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}}
find.value=''},!0)}
var s=document.querySelector('#showHideKnowledge');if(s){s.addEventListener("click",showHideKnowledgeButton,!0);outsideClick()}
Aicb.common.mrLoader('body',!1)}
function mr_base_action(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const action=e.target.dataset.action;const key=e.target.dataset.key;if(action==='mr_list_edit'){if(key)return KnowledgeBaseActionStart(key)}else if(action==='mr_list_delete'){if(confirm("Are you Sure?")&&key){firebase.database().ref('knowledgeBase/').child(key).remove().then(function(){let ele22=document.getElementById('kb'+key);if(ele22){ele22.remove()}})}}}
function outsideClick(){const box=document.querySelector("#mr_kb_found");document.addEventListener("click",function(event){let mr_kb_found=0;['#mr_kb_found','#mr_search_kb'].forEach(ele=>{if(event.target.closest(ele))mr_kb_found+=1});if(!mr_kb_found)box.style.display='none';let mr_related_action_found=0;['#mr_related_action_found','#mr_related_action_search'].forEach(ele=>{if(event.target.closest(ele))mr_kb_found+=1});if(!mr_kb_found){const style=document.querySelector("#mr_related_action_found");if(style)style.style.display='none'}},!0)}
function loadMore(){let setLoadMore=function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let data=knowledgeDB;let length=Object.keys(data).length;let start=parseInt(this.parentNode.dataset.start),end=parseInt(this.parentNode.dataset.end),step=parseInt(this.parentNode.dataset.step),type=this.dataset.type,start1,end1;if(type==='prev'){start1=start-step;end1=start}else{start1=end;end1=end+step}
let start2=(start1>0)?(start1-1):0;let end2=(end1<length)?(end1-1):(length-1);if(end2<=0||start1>=length)return;let sort=Object.entries(data).sort((a,b)=>{if(a[1].time&&b[1].time)
return b[1].time-a[1].time});let list=sort.slice(start2,end2);const mrClientsList=document.getElementById('mrKnowledgeList');if(mrClientsList)mrClientsList.innerHTML='';for(let i=0;list.length>i;i++){if(list[i]){let key=list[i][0];if(data.hasOwnProperty(key)){loadKnowledgeBase(key,data[key],'append')}}}
const mrPagination=document.querySelector('.mrPagination');if(mrPagination){mrPagination.dataset.start=start2+1;mrPagination.dataset.end=end2+1;mrPagination.dataset.counter=length}
const mrPagiStatus=document.querySelector('.mrPagiStatus');if(mrPagiStatus)mrPagiStatus.innerHTML='( '+parseInt(start2+1)+' - '+parseInt(end2+1)+' ) / '+length}
firebase.database().ref('knowledgeBase/').orderByChild("time/").once('value',function(snap){let data=snap.val();let loadData=document.getElementById('mrKnowledgeList');let header=document.getElementById('mrKnowledgeListHead');if(header)header.innerHTML='<tr class="vcHeader"></tr><th>Question</th><th>Answer</th><th>More Answer</th><th>Suggestion</th><th>Next Action</th><th>Updated At</th><th>Action</th></tr>';if(data){knowledgeDB=Object.assign({},data);let length2=Object.keys(data).length;if(length2>10){const container=document.createElement('DIV');container.setAttribute('class','mrPagination');container.setAttribute('data-start',1);container.setAttribute('data-end',11);container.setAttribute('data-counter',length2);container.setAttribute('data-step',10);const prev=document.createElement('DIV');prev.innerText='Prev';prev.setAttribute('data-type','prev');prev.addEventListener('click',setLoadMore,!0);const text=document.createElement('DIV');text.setAttribute('class','mrPagiStatus')
text.innerHTML='(1 - 11) / '+length2;const next=document.createElement('DIV');next.innerText='Next';next.setAttribute('data-type','next');next.addEventListener('click',setLoadMore,!0);container.append(prev);container.append(text);container.append(next);if(loadData){loadData.parentNode.append(container)}}}else{if(loadData)loadData.innerHTML='No Knowledge Base'}})}
function loadKnowledgeBase(key,data,type){const uTable=document.getElementById('mrKnowledgeList');var val=data;let ex=document.getElementById('kb'+key);if(ex)ex.remove();let ans="";if(val.ans&&val.ans.constructor===Object&&Object.keys(val.ans).length>0){let ansVal=Object.values(val.ans);if(ansVal[0]){let ansVal2=Object.values(ansVal[0]);ans=ansVal2[0]?ansVal2[0]:""}}else if(val.ans&&val.ans.constructor===String){ans=val.ans}
let td=[`<td>${(val.que && val.que.length > 20) ? val.que.substring(0, 20) + '..' : val.que}</td>`,`<td>${(ans.length > 20) ? ans.substring(0, 20) + '..' : ans}</td> `,`<td>${(val.man && val.man.length > 0) ? val.man.length : '0'}</td>`,`<td>${(val.rel && val.rel.length > 0) ? val.rel.length : '0'}</td>`,`<td>${val.type || ''}</td>`,`<td>${Aicb.common.getLocalTime(val.time)}</td>`].join('');var tr=document.createElement('TR');tr.setAttribute('id','kb'+key);tr.innerHTML=td;const btn1=document.createElement('SPAN');btn1.setAttribute('class','vChat btn-green');btn1.innerText='✎ Edit';btn1.setAttribute('data-action','mr_list_edit');btn1.setAttribute('data-key',key);btn1.addEventListener('click',mr_base_action,!0);const btn2=document.createElement('SPAN');btn2.setAttribute('class','vChat');btn2.innerText='⤬ Delete';btn2.setAttribute('data-action','mr_list_delete');btn2.setAttribute('data-key',key);btn2.addEventListener('click',mr_base_action,!0);const box=document.createElement('TD');box.append(btn1);box.append(btn2);tr.append(box);if(type==='append'){uTable.append(tr)}else{uTable.prepend(tr)}}
function onlineSync(){if((Date.now()-lastSync)>60000){lastSync=Date.now();firebase.database().ref('actions').child("onlineVisitors").update({"lastSync":Date.now(),"status":'Knowledge Base'})}}
function execute(){let loadFromSnap=function(snap){const page=document.querySelector('.mr-container');if(page&&page.dataset.action==='mr-knowledge-base'){if(snap.key&&snap.val()){loadKnowledgeBase(snap.key,snap.val(),'prepend')}}}
firebase.database().ref('knowledgeBase/').orderByChild("/time").limitToLast(10).on('child_added',loadFromSnap);firebase.database().ref('knowledgeBase/').orderByChild("/time/").limitToLast(10).on('child_changed',loadFromSnap);firebase.database().ref("knowledgeBase/").orderByChild("/time/").on('value',function(snap){let obj=snap.val();const page=document.querySelector('.mr-container');if(page&&page.dataset.action==='mr-knowledge-base'){knowledgeDB=Object.assign({},obj);cbKnowledgeBase();Aicb.common.mrLoader('body',!1);onlineSync()}});loadMore();Aicb.trainingIssues.execute();Aicb.translate.execute()}
return{execute:execute,coreAction:mr_base_action}})();Alc__admin.prototype.settings=(function(){"use strict";let cbTabs=document.querySelectorAll("ul#cb-settings-actions > li");function mobileMenuEvent(){const mSettingsMenu=document.querySelector('.mSettingsMenu');if(mSettingsMenu){mSettingsMenu.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const mobileMenuBar=document.querySelector('.mobile .aicb-setting ul');if(mobileMenuBar){mobileMenuBar.style.display=(mobileMenuBar.style.display==='block')?'none':'block'}},!0)}}
function cbMrAssistant(target){let node=target+' .mrA_input';let cursor='mr-assistant';firebase.database().ref().child(cursor).once('value').then(function(snap){if(snap.val()){Aicb.common.setOptionConfig(node,snap.val())}}).then(function(){const groups=document.querySelectorAll(node);groups.forEach(function(ele){ele.addEventListener('input',function(e){let data=Aicb.common.getObject(node);firebase.database().ref().child(cursor).update(data)})})})}
function settingsExecute(target){let node=target+' .mrA_input';let cursor=(target&&target==='#cbAppearance')?'appearance':'configuration';firebase.database().ref().child('settings').child(cursor).once('value').then(function(snap){if(snap.val())Aicb.common.setOptionConfig(node,snap.val())}).then(function(){const groups=document.querySelectorAll(node);groups.forEach(function(ele){ele.addEventListener('input',function(e){var data=Aicb.common.getObject(node);firebase.database().ref().child('settings').child(cursor).update(data)})})})}
function tabAction(activePaneId){let title=document.getElementById('cb-title'),menus=['#cbAppearance','#cbBotConfig'];if(activePaneId==='#cbAppearance'){title.innerText="Appearance ";settingsExecute(activePaneId)}else if(activePaneId==='#cbBotConfig'||activePaneId==='#cbBotConfigEcommerce'){title.innerText="Configuration ";settingsExecute(activePaneId)}else if(activePaneId==='#cbSearchEngine'){title.innerText="Search Engine Configuration ";settingsExecute(activePaneId)}else if(activePaneId==='#cbBotConfigEcommerce'){title.innerText="eCommerce Configuration ";settingsExecute(activePaneId)}else if(activePaneId==='#cbBotCustomActions'){title.innerText="Custom Actions ";settingsExecute(activePaneId)}else if(activePaneId==='#cbChatWithVisitors'){title.innerText="Chat With Visitors ";settingsExecute(activePaneId)}else if(activePaneId==='#cbIntroMessages'){title.innerText="Intro Messages ";settingsExecute(activePaneId)}else if(activePaneId==='#cbMenus'){title.innerText="Menus ";Aicb.menus.execute(activePaneId)}else if(activePaneId==='#cbTranslation'){title.innerText="Translation ";Aicb.translate.settingInit(activePaneId)}else if(activePaneId==='#cbHelp'){title.innerText="Help  ";Aicb.menus.execute(activePaneId)}else if(activePaneId==='#cbMrAssistant'){title.innerText="Mr. Assistant  ";cbMrAssistant(activePaneId)}}
function cbTabClicks(tabClickEvent){tabClickEvent.preventDefault();for(var i=0;i<cbTabs.length;i++){cbTabs[i].classList.remove("sidebar__menu-item--active")}
var clickedTab=tabClickEvent.currentTarget;clickedTab.classList.add("sidebar__menu-item--active");tabClickEvent.preventDefault();var myContentPanes=document.querySelectorAll(".cb-setting");for(i=0;i<myContentPanes.length;i++){myContentPanes[i].classList.remove("active")}
var activePaneId=tabClickEvent.target.dataset.id;if(!activePaneId){activePaneId=tabClickEvent.target.parentNode.dataset.id}
var activePane=document.querySelector(activePaneId);if(activePane){activePane.classList.add("active")}
tabAction(activePaneId)}
function tabExecute(){cbTabs=document.querySelectorAll("ul#cb-settings-actions > li");for(var i=0;i<cbTabs.length;i++){cbTabs[i].addEventListener("click",cbTabClicks)}}
function execute(){const mrSettingAuthCheck=document.querySelector(".mrSettingAuthCheck");const aicb_setting=document.querySelector(".aicb-setting");firebase.auth().onAuthStateChanged(function(user){if(user){tabExecute();mobileMenuEvent();settingsExecute('#cbBotConfig');firebase.database().ref('actions').child("onlineVisitors").update({"lastSync":Date.now(),"status":'Setting'});Aicb.translate.execute()}});setTimeout(function(){Aicb.common.mrLoader('body',!1)},1000)}
return{execute:execute}})();Alc__admin.prototype.initializer=(function(){"use strict";let settings={};const actions=['mr-dashboard','mr-chatbot-settings','mr-index-table','mr-knowledge-base','mr-user-profile','mr-chat-history','mr-chatbot-console'];function menuDom(){const target=document.querySelector('.mr-container');const logo=mrAssistantObj.plugin_url+'assets/images/mr-logo.png';let menu=['<div class="logo"><div class="mobile-menu"><span class="iconify" data-icon="entypo:menu"></span></div><img width="200px" src="'+logo+'"/></div>','<ul>','<li data-inset="mr-dashboard" class="menu-active"><span class="iconify" data-icon="dashicons:dashboard"></span>'+Aicb.translate.menuTx('Dashboard','_txmenu1')+'</li>','<li data-inset="mr-chatbot-console"><span class="iconify" data-icon="mdi:view-dashboard-variant"></span> '+Aicb.translate.menuTx('Chat Console','_txmenu2')+'</li>','<li data-inset="mr-index-table"><span class="iconify" data-icon="whh:indexmanager"></span> '+Aicb.translate.menuTx('Indexing','_txmenu3')+'</li>','<li data-inset="mr-knowledge-base"><span class="iconify" data-icon="bx:bxs-bot"></span>'+Aicb.translate.menuTx('Train BOT','_txmenu4')+'</li>','<li data-inset="mr-chatbot-settings"><span class="iconify" data-icon="dashicons:admin-settings"></span> '+Aicb.translate.menuTx('Settings','_txmenu5')+'</li>','<li data-inset="mr-chat-history"><span class="iconify" data-icon="fa-solid:history"></span> '+Aicb.translate.menuTx('Chat History','_txmenu6')+'</li>','<li data-inset="mr-user-profile"><span class="iconify" data-icon="gridicons:multiple-users"></span> '+Aicb.translate.menuTx('Operators','_txmenu7')+'</li></ul>','<div class="mr-log-out theme"></div><div class="user-pop" style="display: none;">'+Aicb.translate.menuTx('Howdy Admin','_txmenu8')+'</div>'].join('');let node=document.createElement('DIV');node.setAttribute('class','mr-menu theme');node.innerHTML=menu;document.body.prepend(node)}
function logOut(){firebase.auth().onAuthStateChanged(function(user){const dom=document.querySelector('.user-pop');const box=document.querySelector('.mr-log-out');if(box)box.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();if(dom)dom.style.display=dom.style.display==='none'?'flex':'none'},!0);if(user){let asset=mrAssistantObj.plugin_url+'assets/images/boy.svg';let imgId=Math.floor((Math.random()*92344567)+6);if(box){box.innerHTML=`<img id="mrImg-${imgId}" src="${user.photoURL}"/>`;Aicb.common.image(imgId,user.photoURL,asset)}
if(dom){dom.innerHTML=`<img id="mrImg-${imgId + 9}" src="${user.photoURL}"/>`;Aicb.common.image(imgId+9,user.photoURL,asset);let h2=document.createElement('H2');h2.innerText=user.displayName||'Admin';dom.appendChild(h2);let btn=document.createElement('BUTTON');btn.innerText='Sign Out';btn.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();firebase.auth().signOut()},!0);dom.appendChild(btn)}}else{if(dom)dom.innerHTML='';multiAgentsSignInForm()}})}
function mobileMenuEvent(){const mobileMenu=document.querySelector('.mobile-menu');if(mobileMenu){mobileMenu.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const mobileMenuBar=document.querySelector('.mobile .mr-menu ul');if(mobileMenuBar){mobileMenuBar.style.display=(mobileMenuBar.style.display==='flex')?'none':'flex'}},!0)}}
function menuDomInit(){menuDom();const container=document.querySelector('.mr-container');const menu=document.querySelectorAll('.mr-menu ul li');if(menu){menu.forEach(function(ele){ele.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let inset=e.target.dataset.inset;menu.forEach(function(ele2){ele2.classList.remove('menu-active')});e.target.classList.add('menu-active');if(inset!==''&&actions.includes(inset)){container.dataset.action=inset;container.innerHTML='';Aicb.common.mrLoader('.mr-container','append');menuExecute()}},!0)})}
logOut();mobileMenuEvent()}
function menuInit(menuName=''){const container=document.querySelector('.mr-container');if(container){if(menuName!==''&&actions.includes(menuName)){container.dataset.action=menuName;const menu=document.querySelectorAll('.mr-menu ul li');if(menu)menu.forEach(ele2=>{ele2.classList.remove('menu-active');if(ele2.dataset.inset===menuName){ele2.classList.add('menu-active')}});return menuExecute()}}}
function menuExecute(){const container=document.querySelector('.mr-container');if(container){const setting_action=container.dataset.action;if(setting_action!==''&&actions.includes(setting_action)){container.innerHTML=Aicb.templateDom.execute(setting_action);Aicb.common.mrLoader('.mr-container','append');if(setting_action==='mr-dashboard'){setTimeout(Aicb.dashboard.execute(),1000)}
if(setting_action==='mr-chatbot-console'){Aicb.livechat_admin.execute()}
if(setting_action==='mr-index-table'){setTimeout(Aicb.aisb_indexing.execute(),1000)}
if(setting_action==='mr-chatbot-settings'){setTimeout(Aicb.settings.execute(),1000)}
if(setting_action==='mr-knowledge-base'){setTimeout(Aicb.knowledgeBase.execute(),1000)}
if(setting_action==='mr-user-profile'){setTimeout(Aicb.userProfile.execute(),1000)}
if(setting_action==='mr-chat-history'){setTimeout(Aicb.chat_history.execute(),1000)}}}}
function popMessage(message,btnText='OK'){const container=document.querySelector('.mr-container');const mrPopBox=document.querySelectorAll('.mrPopBox');if(mrPopBox)mrPopBox.forEach(ele=>ele.remove());let node=document.createElement('DIV');let p=document.createElement('P');p.innerHTML=message;let btn=document.createElement('SPAN');btn.innerText=btnText;btn.addEventListener('click',function(e){const mrPopBox=document.querySelectorAll('.mrPopBox');if(mrPopBox)mrPopBox.forEach(ele=>ele.remove())},!0)
node.setAttribute('class','mrPopBox theme');node.append(p);node.append(btn);if(container)container.prepend(node)}
function chatItself(user){if(!user.email||user.isAnonymous){let mr=firebase.database().ref('clients').child(user.uid);mr.child('info').child('name').once('value',function(snap){let name=snap.val();mr.child('info').update({"isAdminUser":!0,"name":(name||'')+' (Admin)',"lastSeen":Date.now(),"session":'Session Destroy by Admin',}).then(function(){var user=firebase.auth().currentUser;if(user.isAnonymous){localStorage.setItem("mrAssistantChatItself",!0);user.delete().then(function(){return multiAgentsSignInForm()})}
popMessage('Hey!! It\'s Admin Section. Your Current Chat session have been deleted. Now you need to login as Admin.')
return multiAgentsSignInForm()})})}else{localStorage.setItem("mrAssistantChatItself",!1)}}
function googleLoginFunc(){const provider=new firebase.auth.GoogleAuthProvider();firebase.auth().signInWithPopup(provider).then(function(result){if(mrAssistantObj.dev==="on"){console.log(result)}
const user=result.user;const email=user.email;if(user.uid&&email){let info={"uid":user.uid,"name":user.displayName||"Admin","email":email,"avatar":user.photoURL,"creationTime":Date.now(),"lastSignInTime":Date.now(),};return firebase.database().ref('users').child(user.uid).once('value',function(snap){let val=snap.val();if(mrAssistantObj.dev==="on"){console.log("Mr Users -> ",val)}
if(!!val){firebase.database().ref('users').child(user.uid).update({"lastSignInTime":Date.now()});if(!val.access){firebase.auth().signOut().then(function(){popMessage('Sorry!! You have been blocked by Admin. Please contact Admin.')},function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}else{popMessage('Thank You!!')}}else{info.access=!0;firebase.database().ref('users').child(user.uid).update(info).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}})}}).catch(function(error){let mrError=document.querySelector('.mrError');if(mrError){let eMessage="Ooops! Something was Wrong. Please try again.";if(typeof error.message!=="undefined"){if(typeof error.message==="string"){eMessage=error.message}else if(typeof error.message==='object'){let message=JSON.parse(error.message);if(message.error&&message.error.message){eMessage=message.error.message}}}
mrError.style.display='block';mrError.innerHTML=eMessage;popMessage(eMessage);if(mrAssistantObj.dev==="on"){console.info(error)}}})}
function multiAgentsSignInForm(){let menu=document.querySelector('.mr-menu');if(menu)menu.remove();var form=['<div class=" mr-pre-chat wrapper" >','<div class=" container">','<div class="mr-center-box"> ','<div class="mr-login-form cb-column">','<h4>Mr. Assistant</h4>','<button id="googleLogin" class="btn"><span class="iconify" data-icon="logos:google-icon"></span> Sign in with Google</button>','<div class="mrError"></div>','</div>','</div>','</div>','</div>'].join('');const target=document.querySelector('.mr-container');target.innerHTML=form;Aicb.common.mrLoader('body',!1);setTimeout(function(){let googleLogin=document.querySelector('#googleLogin');if(googleLogin)googleLogin.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();const ak=mrAssistantObj.application_key;const l=!!ak?ak.split(''):[];if(l.length===36&&l[10]==='M'&&l[34]==='R'){return googleLoginFunc()}
return popMessage('Need Application Key!')},!0)},1000)}
function preConfiguration(){let menu=document.querySelector('.mr-menu');if(menu)menu.remove();const form=['<div class=" mr-pre-chat wrapper" >','<div class=" container"> ','<div class="mr-center-box">','<div class="mr-login-form cb-column">','<h4>Firebase Configuration</h4>','<p>Need to Configuration Firebase realtime Database to use Mr. Assistant Control panel App.</p>','<button type="button" id="superLogin" class="btn">Configure here</button>','<p></p>','</div>','</div>','</div>','</div>'].join('');const target=document.querySelector('.mr-container');target.innerHTML=form;Aicb.common.mrLoader('body',!1);setTimeout(function(){let superLogin=document.querySelector('#superLogin');if(superLogin)superLogin.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();let url=new URL(window.location.href);let params=new window.URLSearchParams(window.location.search);params.set("page","mr-assistant-setting");url.search=params;localStorage.setItem("activetab","#mr_assistant_realtime_database");window.open(url.toString())},!0)},1000)}
function detectMobile(){var bot=document.querySelector('body');let mobile=['Android','webOS','iPhone','iPad','iPod','BlackBerry','Windows Phone'];if(mobile.some(mob=>navigator.userAgent.match(new RegExp(mob,"i")))){bot.classList.add('mobile');bot.classList.remove('desktop');var iframe=window.frameElement;iframe.style.width='100%'}else{bot.classList.remove('mobile');bot.classList.add('desktop')}}
function setDefaultConfiguration(){let plugin_url=mrAssistantObj.plugin_url;firebase.database().ref('knowledgeBase').once('value',function(snap){let val=snap.val();if(!val){axios.get(plugin_url+'assets/database/knowledgeBase.json').then(function(response){let data=response.data;if(data){firebase.database().ref('knowledgeBase').update(data).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}})}}).then(function(){axios.get(plugin_url+'assets/database/settings.json').then(function(response){let data=response.data;try{if(data){addObjToScript(data);addUserToScript();firebase.database().ref('settings').update(data.settings);firebase.database().ref('menus').update(data.menus);firebase.database().ref('help').update(data.help);firebase.database().ref('translation').update(data.translation).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}}catch(e){if(mrAssistantObj.dev==="on"){console.info(e)}}})})}
function addObjToScript(srt){const sc=document.getElementById('mr_config_script');let obj={};if(sc&&srt){let configuration=(srt.hasOwnProperty('configuration'))?srt.configuration:{};sc.innerHTML='let mrAssets ='+JSON.stringify(configuration)}}
function addUserToScript(){firebase.database().ref('users').once('value',function(snap){let val=snap.val();const sc=document.getElementById('mr_user_config');if(!!val&&sc){let mrUsersList={};Object.keys(val).forEach(function(ele){let userDB=val[ele];let mrUser={};mrUser.uid=ele;mrUser.name=userDB.hasOwnProperty("name")?userDB.name:"Admin";mrUser.avatar=userDB.hasOwnProperty("avatar")?userDB.avatar:"";mrUsersList[ele]=mrUser});sc.innerHTML='let mrUserAssets ='+JSON.stringify(mrUsersList)}}).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}
function mrBotConfigScriptLoad(botConfig){const bot=document.getElementById('mr_bot_config');let obj={};if(!!bot&&botConfig){bot.innerHTML='let mrBot ='+JSON.stringify(botConfig)}}
function firebaseInitPublic(){try{settings=Object.assign({},mrAssistantObj);mrBotConfigScriptLoad(settings);if(firebase.apps.length===0){const config={apiKey:mrAssistantObj.web_api_key,authDomain:mrAssistantObj.project_id+'.firebaseapp.com',databaseURL:'https://'+mrAssistantObj.project_id+'.firebaseio.com',storageBucket:mrAssistantObj.project_id+'.appspot.com',};firebase.initializeApp(config)}
if(firebase.apps.length>0){firebase.auth().onAuthStateChanged(function(user){if(user){let online=firebase.database().ref('actions').child("online");online.update({"lastSeen":Date.now(),"status":"online",});chatItself(user);detectMobile();menuDomInit();menuExecute();firebase.database().ref('settings').once('value',function(snap){let val=snap.val();if(!!val&&val.hasOwnProperty('configuration')){addObjToScript(val);addUserToScript()}else{setDefaultConfiguration()}}).catch(function(e){if(mrAssistantObj.dev==="on"){console.info(e)}})}else{multiAgentsSignInForm()}})}else{preConfiguration()}}catch(e){preConfiguration()}}
return{execute:firebaseInitPublic,settings:settings,menuInit:menuInit,menuExecute:menuExecute,addUserToScript:addUserToScript,popMessage:popMessage}})();Alc__admin.prototype.connector=(function(){'use strict';function execute(){try{let mr=document.body.dataset.action,token=document.body.dataset.token
if('mr-assistant-chatbot'===mr){Aicb.initializer.execute()}else{return 0}}catch(e){if(mrAssistantObj.dev==="on"){console.info(e)}}}
return{execute:execute}})();document.addEventListener('readystatechange',event=>{if(event.target.readyState==="complete"){let mr_a=new Alc__admin();mr_a.connector.execute()}});})()